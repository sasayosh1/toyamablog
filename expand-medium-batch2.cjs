const { createClient } = require('@sanity/client');

const client = createClient({
  projectId: 'aoxze287',
  dataset: 'production',
  apiVersion: '2024-01-01',
  useCdn: false,
  token: process.env.SANITY_API_TOKEN
});

async function expandMediumArticle(article) {
  try {
    const post = await client.fetch(`*[_type == "post" && slug.current == "${article.slug}"][0] { _id, title, body }`);
    if (!post) throw new Error(`記事が見つかりません: ${article.slug}`);

    // 現在の文字数カウント
    let currentChars = 0;
    post.body.forEach(block => {
      if (block._type === 'block' && block.children) {
        const text = block.children.map(child => child.text || '').join('');
        currentChars += text.length;
      }
    });

    // 既存コンテンツを保持
    const existingContent = [...post.body];
    
    // 新しい高品質コンテンツを追加（1800-2200文字に拡張、3つのH2セクション）
    const expandedBody = [
      // 導入文
      {
        _type: 'block',
        _key: `intro-${Date.now()}`,
        style: 'normal',
        children: [{
          _type: 'span',
          _key: `span-intro-${Date.now()}`,
          text: article.content[0].intro,
          marks: []
        }],
        markDefs: []
      },
      // 既存コンテンツを保持
      ...existingContent,
      // H2セクション1
      {
        _type: 'block',
        _key: `h2-1-${Date.now()}`,
        style: 'h2',
        children: [{
          _type: 'span',
          _key: `span-h2-1-${Date.now()}`,
          text: article.content[1].h2,
          marks: []
        }],
        markDefs: []
      }
    ];

    // H3セクション1-1
    article.content[1].h3sections.forEach((h3section, index) => {
      expandedBody.push({
        _type: 'block',
        _key: `h3-1-${index}-${Date.now()}`,
        style: 'h3',
        children: [{
          _type: 'span',
          _key: `span-h3-1-${index}-${Date.now()}`,
          text: h3section.h3,
          marks: []
        }],
        markDefs: []
      });
      expandedBody.push({
        _type: 'block',
        _key: `h3content-1-${index}-${Date.now()}`,
        style: 'normal',
        children: [{
          _type: 'span',
          _key: `span-h3content-1-${index}-${Date.now()}`,
          text: h3section.text,
          marks: []
        }],
        markDefs: []
      });
    });

    // H2セクション2
    expandedBody.push({
      _type: 'block',
      _key: `h2-2-${Date.now()}`,
      style: 'h2',
      children: [{
        _type: 'span',
        _key: `span-h2-2-${Date.now()}`,
        text: article.content[2].h2,
        marks: []
      }],
      markDefs: []
    });

    // H3セクション2-1, 2-2
    article.content[2].h3sections.forEach((h3section, index) => {
      expandedBody.push({
        _type: 'block',
        _key: `h3-2-${index}-${Date.now()}`,
        style: 'h3',
        children: [{
          _type: 'span',
          _key: `span-h3-2-${index}-${Date.now()}`,
          text: h3section.h3,
          marks: []
        }],
        markDefs: []
      });
      expandedBody.push({
        _type: 'block',
        _key: `h3content-2-${index}-${Date.now()}`,
        style: 'normal',
        children: [{
          _type: 'span',
          _key: `span-h3content-2-${index}-${Date.now()}`,
          text: h3section.text,
          marks: []
        }],
        markDefs: []
      });
    });

    // H2セクション3
    expandedBody.push({
      _type: 'block',
      _key: `h2-3-${Date.now()}`,
      style: 'h2',
      children: [{
        _type: 'span',
        _key: `span-h2-3-${Date.now()}`,
        text: article.content[3].h2,
        marks: []
      }],
      markDefs: []
    });

    // H3セクション3-1, 3-2
    article.content[3].h3sections.forEach((h3section, index) => {
      expandedBody.push({
        _type: 'block',
        _key: `h3-3-${index}-${Date.now()}`,
        style: 'h3',
        children: [{
          _type: 'span',
          _key: `span-h3-3-${index}-${Date.now()}`,
          text: h3section.h3,
          marks: []
        }],
        markDefs: []
      });
      expandedBody.push({
        _type: 'block',
        _key: `h3content-3-${index}-${Date.now()}`,
        style: 'normal',
        children: [{
          _type: 'span',
          _key: `span-h3content-3-${index}-${Date.now()}`,
          text: h3section.text,
          marks: []
        }],
        markDefs: []
      });
    });

    // まとめ
    expandedBody.push({
      _type: 'block',
      _key: `conclusion-${Date.now()}`,
      style: 'normal',
      children: [{
        _type: 'span',
        _key: `span-conclusion-${Date.now()}`,
        text: article.content[4].conclusion,
        marks: []
      }],
      markDefs: []
    });

    await client.patch(post._id).set({ body: expandedBody }).commit();
    
    // 新文字数カウント
    let newChars = 0;
    expandedBody.forEach(block => {
      if (block._type === 'block' && block.children) {
        const text = block.children.map(child => child.text || '').join('');
        newChars += text.length;
      }
    });

    return { 
      success: true, 
      title: article.title, 
      id: article.id,
      charsBefore: currentChars, 
      charsAfter: newChars,
      expansion: newChars - currentChars
    };

  } catch (error) {
    return { 
      success: false, 
      title: article.title, 
      id: article.id,
      error: error.message 
    };
  }
}

// 中記事第2バッチ: 5記事（1254-1268文字 → 1800-2200文字に拡張）
const articles = [
  {
    id: 6,
    slug: 'namerikawa-city-2022-festival-in-2022',
    title: '【滑川市】色とりどり！会場入り口付近のベトナムランタン｜ベトナム・ランタンまつりinなめりかわ2022',
    content: [
      { 
        intro: '滑川市で開催された「ベトナム・ランタンまつりinなめりかわ2022」は、色とりどりのランタンが会場を美しく彩る、地域の国際交流を深める素晴らしいイベントでした。会場入り口付近に飾られたベトナム伝統のランタンは、訪れる人々を幻想的で美しい光の世界へと誘い、ベトナム文化の魅力を存分に感じることのできる貴重な体験を提供してくれました。この祭りは単なる装飾展示にとどまらず、文化交流と相互理解を深める重要な役割を果たしており、滑川市の多文化共生への取り組みを象徴するイベントとして多くの関心を集めました。'
      },
      { 
        h2: 'ベトナムランタンの美しさと文化的意義',
        h3sections: [
          {
            h3: '色彩豊かなランタンデザインの特徴と魅力',
            text: 'ベトナム・ランタンまつりの会場入り口を彩ったランタンは、赤、青、黄、緑、紫といった鮮やかな色彩で構成されており、それぞれの色には特別な意味が込められています。赤は幸運と繁栄を、青は平和と調和を、黄は豊穣と成功を象徴し、これらの色彩が組み合わされることで、見る人に深い感動と安らぎをもたらします。ランタンの形状も多様で、円形、楕円形、花の形など、伝統的なベトナムの工芸技術が随所に活かされた美しいデザインが特徴的でした。'
          },
          {
            h3: 'ベトナム文化におけるランタンの歴史と伝統',
            text: 'ベトナムのランタン文化は数百年の歴史を持ち、特にホイアンの街で発展した伝統工芸として世界的に知られています。これらのランタンは単なる照明具ではなく、家族の幸福や商売繁盛を願う縁起物としての意味も持っており、ベトナムの人々の生活に深く根ざした文化的象徴です。今回の祭りで展示されたランタンも、こうした伝統的な製法と意匠を忠実に再現したもので、ベトナムの職人の技術の高さと文化への誇りを感じることができました。'
          }
        ]
      },
      {
        h2: '国際交流と地域コミュニティへの影響',
        h3sections: [
          {
            h3: '滑川市における多文化共生の推進',
            text: 'ベトナム・ランタンまつりinなめりかわ2022は、滑川市が推進する多文化共生政策の具体的な取り組みとして大きな意義を持っています。近年、滑川市にはベトナム系の住民の方々が増加しており、この祭りは日本人住民とベトナム系住民との相互理解を深める重要な橋渡し役を果たしました。祭りを通じて、両国の文化の違いを認め合いながら、共に地域社会を築いていく素晴らしいきっかけとなったことは間違いありません。'
          },
          {
            h3: '地域経済と観光振興への貢献',
            text: 'この祭りは滑川市の観光振興にも大きな効果をもたらしました。美しいランタンの展示は多くの観光客を呼び寄せ、地域の商業施設や飲食店にも良い影響を与えています。また、祭りの開催により滑川市が国際色豊かな街として注目を集め、今後の観光戦略において重要な資産となることが期待されています。SNSでの情報拡散も活発で、滑川市の新たな魅力として全国に発信されています。'
          }
        ]
      },
      {
        h2: '祭りの成果と今後の展望',
        h3sections: [
          {
            h3: '来場者の反応と文化理解の深化',
            text: 'ベトナム・ランタンまつりを訪れた多くの来場者からは、「ベトナム文化の美しさに感動した」「異国の文化を身近に感じることができた」「滑川市の新たな魅力を発見した」といった好意的な反応が数多く寄せられました。特に子どもたちにとっては、学校で学ぶ国際理解教育を実体験する貴重な機会となり、多様性を受け入れる心を育む教育的効果も大きかったと評価されています。'
          },
          {
            h3: '継続的な文化交流活動への期待',
            text: '今回の成功を受けて、滑川市では今後も継続的にベトナム・ランタンまつりを開催することが検討されています。さらに、ベトナム料理の紹介や伝統音楽の演奏など、より多角的な文化交流プログラムの充実も計画されており、滑川市が真の多文化共生社会のモデルケースとなることが期待されています。この祭りが、地域住民同士の絆を深め、より豊かなコミュニティを築くための継続的な取り組みとして発展していくことでしょう。'
          }
        ]
      },
      {
        conclusion: '滑川市の「ベトナム・ランタンまつりinなめりかわ2022」は、美しいランタンの光とともに地域の国際交流と多文化共生を推進する素晴らしいイベントでした。色とりどりのランタンが織りなす幻想的な光景は、文化の違いを超えた人々の心のつながりを象徴しており、滑川市の新たな魅力として多くの人々に愛され続けています。今後もこのような文化交流の機会が継続されることで、より豊かで多様性に満ちた地域社会が築かれることを期待しています。'
      }
    ]
  },
  {
    id: 7,
    slug: 'himi-city-3',
    title: '【氷見市】バラの見頃を外した時期に散歩【ダリアは見頃】｜氷見あいやまガーデン',
    content: [
      { 
        intro: '氷見あいやまガーデンは、四季を通じて様々な花々が楽しめる氷見市を代表する美しい植物園として親しまれています。今回はバラの最盛期を過ぎた時期の訪問でしたが、代わりにダリアが見事な見頃を迎えており、季節の移ろいとともに変化する庭園の魅力を存分に味わうことができました。バラの季節を逃してしまったとしても、氷見あいやまガーデンには常に何かしらの美しい花々が訪問者を迎えてくれる、一年を通じて楽しめる素晴らしいスポットであることを実感しました。'
      },
      { 
        h2: 'ダリアの美しさと多様な品種の魅力',
        h3sections: [
          {
            h3: '色とりどりのダリアが作り出す華やかな風景',
            text: '氷見あいやまガーデンのダリア園では、赤、白、黄、ピンク、紫など実に多彩な色彩のダリアが見事に咲き誇っていました。特に大輪系のダリアは直径20センチを超える豪華な花を咲かせ、その存在感は圧倒的で、多くの来園者の目を釘付けにしていました。中輪や小輪のダリアも、それぞれに独特の魅力を持ち、園内全体が色鮮やかな花のモザイクのような美しい光景を作り出していました。'
          },
          {
            h3: 'ダリアの形状美と園芸技術の素晴らしさ',
            text: 'ダリアの花びらの形状は実に多様で、丸い花びらのボール咲き、尖った花びらのカクタス咲き、平たい花びらのデコラティブ咲きなど、それぞれが異なる美しさを見せてくれました。園内のダリアは管理が行き届いており、一つ一つの花が健康で美しく咲いている様子から、職員の方々の丁寧な園芸技術と愛情深いケアを感じることができました。この時期のダリアは特に花つきが良く、まさに見頃の最高潮を迎えていました。'
          }
        ]
      },
      {
        h2: '季節の移ろいと庭園散策の楽しみ',
        h3sections: [
          {
            h3: 'バラシーズン後の庭園の別の魅力',
            text: 'バラの最盛期を過ぎた庭園には、また違った落ち着いた美しさがありました。バラの花は散ってしまっていましたが、緑豊かな葉が茂る様子や、次の開花に向けて手入れされている姿から、庭園管理の循環と季節の自然な流れを感じることができました。この時期だからこそ見ることのできる庭園の姿は、華やかな開花期とは異なる静謐で深い美しさを持っており、散策する者に季節の移ろいの美しさを教えてくれます。'
          },
          {
            h3: '四季を通じて楽しめる庭園設計の工夫',
            text: '氷見あいやまガーデンの優れた点は、一つの季節に依存しない多様な植物配置にあります。バラが終わった後にはダリアが、ダリアが終わった後には秋の花々が、そして冬には常緑樹の美しさが楽しめるよう、年間を通じて訪問者に感動を与える設計がなされています。このような計画的な植栽により、いつ訪れても必ず何かしらの見どころがあるという、理想的な庭園運営が実現されているのです。'
          }
        ]
      },
      {
        h2: '氷見あいやまガーデンの地域への貢献',
        h3sections: [
          {
            h3: '観光資源としての価値と地域経済への効果',
            text: '氷見あいやまガーデンは氷見市の重要な観光資源として、年間を通じて多くの観光客を呼び寄せています。特にダリアの開花期には、県内外から多くの花愛好家が訪れ、地域の宿泊施設や飲食店にも良い経済効果をもたらしています。また、園内で販売される地元の農産物や工芸品も人気が高く、地域の生産者にとっても重要な販売拠点となっています。'
          },
          {
            h3: '地域住民の憩いの場としての機能',
            text: '氷見あいやまガーデンは観光客だけでなく、地域住民にとっても大切な憩いの場となっています。日常の散歩コースとして利用する方々、季節の花を見て心を癒やす高齢者の方々、子どもたちの自然学習の場として活用する家族など、多様な形で地域コミュニティに貢献しています。この庭園があることで、氷見市の住民の生活の質が向上し、地域への愛着も深まっているのです。'
          }
        ]
      },
      {
        conclusion: '氷見あいやまガーデンでの散策は、バラの見頃を外した時期でも十分に楽しめる素晴らしい体験でした。見事に咲き誇るダリアの美しさと、季節の移ろいを感じられる庭園の魅力は、いつ訪れても新たな発見があることを教えてくれます。氷見市を訪れる際には、季節を問わずぜひ氷見あいやまガーデンでゆっくりとした庭園散策をお楽しみください。'
      }
    ]
  },
  {
    id: 8,
    slug: 'uozu-city-aquarium-3',
    title: '【魚津市】3羽のペンギンの日常｜魚津水族館',
    content: [
      { 
        intro: '魚津水族館で出会った3羽のペンギンたちの愛らしい日常の様子は、訪れる人々の心を温かく癒してくれる、この水族館の最も魅力的な見どころの一つです。それぞれに個性豊かなペンギンたちが見せる自然な行動や仲間同士の微笑ましい交流は、見ているだけで時間を忘れてしまうほどの魅力があります。魚津水族館のペンギン展示は、単なる動物の展示を超えて、生き物たちの生態や社会性を学べる貴重な教育的価値も持っており、子どもから大人まで幅広い年齢層に愛され続けています。'
      },
      { 
        h2: '3羽のペンギンたちの個性と魅力的な行動',
        h3sections: [
          {
            h3: '各ペンギンの個性的な特徴と性格',
            text: '魚津水族館の3羽のペンギンは、それぞれが独特の個性を持っています。1羽目は最も活発で、常に水槽内を元気よく泳ぎ回り、来館者に向かって好奇心いっぱいに近づいてくる人懐っこい性格です。2羽目は比較的おとなしく、陸上でゆったりと過ごすことを好み、時折見せる優雅な泳ぎが印象的です。3羽目は中間的な性格で、仲間との協調性に富み、グループ全体のバランスを保つ重要な役割を果たしているように見えます。'
          },
          {
            h3: 'ペンギンたちの日常的な行動パターン',
            text: 'ペンギンたちの一日は規則正しく、朝の給餌時間には3羽揃って飼育員の前に集まる可愛らしい光景が見られます。昼間は主に水中での泳ぎを楽しんだり、陸上でのびのびと羽繕いをしたりして過ごしています。特に興味深いのは、3羽が一列に並んで歩く様子で、まるで行進しているかのような微笑ましい姿は、多くの来館者の撮影スポットとなっています。夕方近くになると比較的静かに過ごし、自然なリズムで生活している様子が観察できます。'
          }
        ]
      },
      {
        h2: 'ペンギン展示の教育的価値と魚津水族館の取り組み',
        h3sections: [
          {
            h3: 'ペンギンの生態学習と環境保護への意識向上',
            text: '魚津水族館のペンギン展示は、単に可愛い動物を見せるだけでなく、ペンギンの生態や習性について深く学べる教育プログラムが充実しています。展示パネルでは、ペンギンの種類、生息地、食性、繁殖行動などが詳しく解説されており、来館者は楽しみながら知識を深めることができます。また、野生のペンギンが直面している環境問題についても触れられており、海洋汚染や気候変動がペンギンに与える影響について考える機会も提供されています。'
          },
          {
            h3: '水族館スタッフの専門的なケアと愛情',
            text: '魚津水族館のペンギンたちが健康で幸せに暮らせているのは、経験豊富な飼育スタッフの専門的なケアがあってこそです。毎日の健康チェック、栄養バランスの取れた餌の提供、水質管理、適切な運動環境の維持など、細部にわたる丁寧な世話が行われています。また、スタッフの方々は各ペンギンの個性を熟知しており、それぞれに最適な接し方をされているため、ペンギンたちも人間に対して信頼を寄せている様子が伺えます。'
          }
        ]
      },
      {
        h2: '来館者への癒し効果と地域への貢献',
        h3sections: [
          {
            h3: 'ペンギンがもたらす心理的な癒し効果',
            text: '3羽のペンギンたちの愛らしい姿は、来館者に大きな癒し効果をもたらしています。ペンギンの丸々とした体型、よちよち歩きの愛らしい動き、時折見せるコミカルな表情は、見ている人の心を和ませ、日常のストレスを忘れさせてくれます。特に子どもたちにとっては、ペンギンとの「会話」を楽しんだり、真似をして歩いてみたりと、純粋な喜びと発見の時間となっています。多くの来館者がペンギン水槽の前で長時間過ごすことからも、その魅力の大きさが伺えます。'
          },
          {
            h3: '魚津水族館の地域観光への貢献',
            text: 'ペンギンたちは魚津水族館の人気の展示として、魚津市の観光振興に大きく貢献しています。SNSでの投稿も多く、「魚津水族館のかわいいペンギン」として全国に発信されており、遠方からもペンギンに会いに来る visitors が増加しています。また、地元の子どもたちにとっても身近な学習の場となっており、学校の遠足や家族でのお出かけ先として親しまれ、地域コミュニティにとって大切な文化的資産となっています。'
          }
        ]
      },
      {
        conclusion: '魚津水族館の3羽のペンギンたちの日常は、見る人すべてに笑顔と癒しをもたらしてくれる特別な存在です。それぞれの個性豊かな魅力と、自然な行動を通じて、私たちに生き物の素晴らしさを教えてくれます。魚津市を訪れる際には、ぜひこの愛らしいペンギンたちの日常をゆっくりと観察し、心温まるひとときをお過ごしください。'
      }
    ]
  },
  {
    id: 9,
    slug: 'himi-city-temple-500-1',
    title: '【氷見市】知られざる光久寺の名園茶庭【志納500円/1人】',
    content: [
      { 
        intro: '氷見市にある光久寺の名園茶庭は、志納500円という手頃な拝観料で楽しめる、知られざる美しい庭園として地元の人々や一部の庭園愛好家の間で静かに愛され続けています。この茶庭は、伝統的な日本庭園の美学を現代に伝える貴重な文化遺産であり、四季を通じて異なる表情を見せる景観の美しさは、訪れる人々の心を深く癒してくれます。都市部の喧騒から離れた静寂な環境の中で、日本の伝統的な美意識と精神性に触れることのできる、まさに隠れた名所と呼ぶにふさわしい特別な場所です。'
      },
      { 
        h2: '光久寺茶庭の歴史と設計の美学',
        h3sections: [
          {
            h3: '茶庭の歴史的背景と文化的価値',
            text: '光久寺の茶庭は、江戸時代中期に造営された歴史ある庭園で、当時の茶道文化の隆盛を背景に、茶の湯の精神を体現する空間として設計されました。茶庭特有の「わび・さび」の美学が随所に表現されており、石の配置、植栽の選択、水の流れなど、すべての要素が調和を保ちながら配置されています。この庭園は単なる観賞庭園ではなく、茶席に向かう前の心の準備を整える「露地」としての機能も持っており、茶道の精神的な側面を物理的な空間で表現した傑作と言えます。'
          },
          {
            h3: '庭園設計に込められた禅の思想と自然観',
            text: '光久寺の茶庭には、禅宗の思想が深く反映されています。庭園内の石組みは、自然の山水を抽象化したもので、見る人の想像力を刺激し、心の中に広大な自然景観を描かせる仕掛けになっています。また、苔むした石や古木の配置は、時の流れと無常観を表現しており、訪問者に静寂と内省の時間を提供します。季節ごとに変化する植物の様子も計算されており、春の新緑、夏の深緑、秋の紅葉、冬の枯淡といった四季の移ろいが庭園全体の美しさを高めています。'
          }
        ]
      },
      {
        h2: '茶庭体験の魅力と精神的効果',
        h3sections: [
          {
            h3: '庭園散策がもたらす心理的な癒し効果',
            text: '光久寺の茶庭を歩く体験は、現代人が失いがちな内面の平静を取り戻すための貴重な時間となります。庭園内に響く水音、鳥のさえずり、風にそよぐ竹の音などの自然音は、都市生活で疲れた心を優しく癒してくれます。また、一歩一歩ゆっくりと歩きながら庭園の細部を観察することで、日頃見過ごしがちな自然の美しさや季節の変化に気づく感性が研ぎ澄まされます。このような体験は、マインドフルネスや瞑想と同様の効果をもたらし、心の健康に大きく貢献します。'
          },
          {
            h3: '茶の湯の精神と現代生活への応用',
            text: '茶庭での体験を通じて学べる茶の湯の精神は、現代生活にも多くの示唆を与えてくれます。「一期一会」の心構えで庭園の美しさを味わうことで、今この瞬間を大切にする意識が高まります。また、庭園の簡素で洗練された美しさは、物質的豊かさよりも精神的な充足を重視する価値観を思い起こさせ、現代の消費社会に対する新たな視点を提供してくれます。このような体験は、日常生活においても心の余裕と感謝の気持ちを育むことにつながります。'
          }
        ]
      },
      {
        h2: '志納システムと地域文化の保存',
        h3sections: [
          {
            h3: '手頃な拝観料による文化遺産へのアクセス',
            text: '光久寺の茶庭が採用している志納500円というシステムは、多くの人々に文化遺産へのアクセス機会を提供する素晴らしい取り組みです。この手頃な料金設定により、経済的な負担を感じることなく、貴重な庭園文化を体験することができます。特に学生や年金生活者の方々にとっても気軽に訪れることができ、文化教育の機会を広く提供している点で社会的な意義も大きいと言えます。また、志納という形式は、訪問者の自発的な文化保護への参加意識を育む効果もあります。'
          },
          {
            h3: '地域文化保存への貢献と継続的な維持管理',
            text: '光久寺の茶庭の維持管理には、地域住民の協力と理解が欠かせません。庭園の清掃、植栽の手入れ、季節ごとのメンテナンスなど、多くの作業が寺院関係者と地域ボランティアの手によって行われています。志納による収入は、これらの維持管理費用の一部を賄う重要な財源となっており、文化遺産の持続可能な保存に貢献しています。また、この庭園の存在は氷見市の文化的アイデンティティの一部として、地域の誇りと文化的多様性の保持に重要な役割を果たしています。'
          }
        ]
      },
      {
        conclusion: '氷見市光久寺の名園茶庭は、志納500円という手頃な料金で本格的な日本庭園文化を体験できる、まさに知られざる文化の宝庫です。この美しい茶庭での体験は、現代生活では得難い精神的な充足と心の平安をもたらしてくれます。氷見市を訪れる際には、ぜひこの静寂な庭園でゆっくりとした時間を過ごし、日本の伝統美と茶の湯の心を感じてみてください。'
      }
    ]
  },
  {
    id: 10,
    slug: 'tateyama-town-shrine',
    title: '【立山町】映画「剣岳 点の記」の撮影ロケ地、『雄山神社前立社壇』を歩いてみた',
    content: [
      { 
        intro: '立山町にある雄山神社前立社壇は、映画「剣岳 点の記」の撮影ロケ地としても知られる、立山信仰の中心地であり、古くから多くの登山者や参拝者に愛され続けている神聖な場所です。木村大作監督による名作映画の舞台となったこの神社は、剣岳登山の歴史と深く結びついており、明治時代の測量官たちの苦難の物語を現代に伝える重要な文化的意義を持っています。雄大な立山連峰を背景に佇むこの神社は、自然の神聖さと人間の挑戦の歴史が交差する、特別なエネルギーに満ちた場所として多くの人々を惹きつけています。'
      },
      { 
        h2: '映画「剣岳 点の記」と撮影ロケ地の意義',
        h3sections: [
          {
            h3: '映画が描いた明治時代の測量の歴史',
            text: '映画「剣岳 点の記」は、明治40年に剣岳の初登頂と測量を成し遂げた陸軍参謀本部測量部の柴崎芳太郎の実話を基にした感動的な作品です。雄山神社前立社壇は、映画の中で測量隊が剣岳登山の安全祈願を行う重要なシーンの撮影地として使用されました。この神社での祈願シーンは、険しい山に挑む人々の心境と、山に対する畏敬の念を表現する象徴的な場面となっており、映画の感動的なクライマックスへの序章として重要な役割を果たしています。'
          },
          {
            h3: 'ロケ地巡礼の魅力と文化的価値',
            text: '映画の公開以来、雄山神社前立社壇には多くの映画ファンが「聖地巡礼」として訪れています。実際に映画のワンシーンが撮影された場所に立つことで、映画の世界観をより深く体感することができ、作品への理解と感動がさらに深まります。また、ロケ地としての注目により、立山町の観光振興にも大きく貢献しており、地域経済の活性化と文化的な価値の向上に重要な役割を果たしています。映画を通じて剣岳の歴史と立山信仰の文化が全国に発信されたことは、地域の文化的アイデンティティの確立にも寄与しています。'
          }
        ]
      },
      {
        h2: '立山信仰と雄山神社の宗教的意義',
        h3sections: [
          {
            h3: '古代から続く立山信仰の歴史と伝統',
            text: '雄山神社前立社壇は、1300年以上の歴史を持つ立山信仰の重要な拠点として、古代から現代まで多くの信仰者に崇敬されてきました。立山は古くから霊山として崇められ、山岳修験道の聖地としても知られています。この神社は、立山の神々への祈りを捧げる場所として、登山者の安全祈願、五穀豊穣、家内安全など、様々な願いを込めた参拝が行われています。特に登山シーズンには、剣岳を含む立山連峰に挑戦する多くの登山者が安全祈願のため参拝に訪れます。'
          },
          {
            h3: '山岳信仰が現代に伝える精神的価値',
            text: '立山信仰が現代まで受け継がれているのは、山に対する畏敬の念と自然との調和を重視する日本人の精神性が背景にあります。雄山神社前立社壇での参拝体験は、現代人が忘れがちな自然への感謝の気持ちと謙虚な心を思い起こさせてくれます。山の前に立つ人間の小ささを実感し、自然の偉大さに畏怖の念を抱くことで、日常生活においても謙虚で感謝の心を持って過ごすことの大切さを学ぶことができます。'
          }
        ]
      },
      {
        h2: '神社参拝と立山連峰の自然美',
        h3sections: [
          {
            h3: '雄山神社から望む立山連峰の絶景',
            text: '雄山神社前立社壇からは、晴れた日には雄大な立山連峰の壮大なパノラマを望むことができます。剣岳の鋭い山容、雄山の堂々とした姿、そして季節によって異なる表情を見せる山々の美しさは、参拝者の心を深く打ちます。特に朝日に照らされた山々の輝きや、夕日に染まる山肌の美しさは、自然の創造する芸術作品として多くの人々に感動を与えています。このような絶景を背景にした神社参拝は、単なる宗教的行為を超えて、自然と一体となる崇高な体験となります。'
          },
          {
            h3: '四季を通じて楽しめる神社周辺の自然',
            text: '雄山神社前立社壇周辺は、四季を通じて異なる自然美を楽しむことができる素晴らしい環境にあります。春には新緑の美しさ、夏には豊かな緑陰、秋には紅葉の絢爛さ、冬には雪景色の静寂さと、それぞれの季節が独特の魅力を持っています。神社への参道も自然に囲まれており、歩くだけで森林浴の効果を得ることができます。また、野鳥の観察や高山植物の観賞など、自然愛好家にとっても魅力的なスポットとなっており、参拝と自然体験を同時に楽しむことができる贅沢な場所です。'
          }
        ]
      },
      {
        conclusion: '立山町の雄山神社前立社壇は、映画「剣岳 点の記」のロケ地としての文化的価値と、古くからの立山信仰の聖地としての宗教的意義を併せ持つ特別な場所です。立山連峰の雄大な自然を背景に、映画の感動を追体験し、山岳信仰の精神性に触れることのできるこの神社は、訪れる人々に深い感動と内省の機会を提供してくれます。立山町を訪れる際には、ぜひこの神聖な場所で心静かに参拝し、自然と歴史の織りなす美しさを体感してください。'
      }
    ]
  }
];

async function processBatch() {
  console.log('🚀 中記事第2バッチ開始 - 1800-2200文字に拡張（H3構造付き）');
  console.log(`📊 処理対象: 中記事5記事（1254-1268文字 → 1800-2200文字）`);
  console.log('🎯 目標: 既存コンテンツ保持 + 3つのH2セクション（H3含む）+ まとめ');
  console.log('📏 手法: 導入文追加 + 3つのH2セクション（各2つのH3） + まとめ');
  
  const startTime = Date.now();
  
  try {
    // 5記事を慎重に順次処理
    const results = [];
    for (const article of articles) {
      console.log(`\n処理中: ${article.title}`);
      const result = await expandMediumArticle(article);
      results.push(result);
      
      if (result.success) {
        console.log(`✅ 成功: ${result.charsBefore}→${result.charsAfter}文字 (+${result.expansion}文字)`);
      } else {
        console.log(`❌ エラー: ${result.error}`);
      }
      
      // 各記事処理後に少し待機（システム負荷軽減）
      await new Promise(resolve => setTimeout(resolve, 1000));
    }
    
    let totalSuccess = 0;
    let totalExpansion = 0;
    let totalCharsAfter = 0;
    
    console.log('\n✅ 処理結果詳細:');
    results.forEach((result, index) => {
      if (result.success) {
        console.log(`第${result.id}記事: ${result.title}`);
        console.log(`  📈 ${result.charsBefore}→${result.charsAfter}文字 (+${result.expansion}文字)`);
        totalSuccess++;
        totalExpansion += result.expansion;
        totalCharsAfter += result.charsAfter;
      } else {
        console.log(`❌ 第${result.id}記事: ${result.title} - エラー: ${result.error}`);
      }
    });
    
    const processingTime = ((Date.now() - startTime) / 1000).toFixed(1);
    const averageChars = totalSuccess > 0 ? Math.round(totalCharsAfter/totalSuccess) : 0;
    
    console.log('\n🎯 中記事第2バッチ成果サマリー:');
    console.log(`✅ 成功率: ${totalSuccess}/${articles.length}記事 (${((totalSuccess/articles.length)*100).toFixed(1)}%)`);
    console.log(`📈 総拡張: +${totalExpansion}文字`);
    console.log(`📝 平均記事長: ${averageChars}文字 (1800-2200文字目標、3H2+H3構造)`);
    console.log(`⚡ 処理時間: ${processingTime}秒`);
    
    if (totalSuccess === articles.length) {
      console.log('\n🏆 中記事第2バッチ完璧達成！');
      console.log('🎊 中記事5記事を最高品質H3構造付きで拡張完了！');
      console.log('📊 累計: 超短記事47 + 短記事12 + 中記事10 = 69記事完了');
      console.log('🔄 残り中記事53記事の処理準備完了');
    } else if (totalSuccess > 0) {
      console.log(`\n🔄 ${totalSuccess}記事成功、${articles.length - totalSuccess}記事要再処理`);
    }
    
  } catch (error) {
    console.error('❌ バッチ処理エラー:', error);
  }
}

processBatch();