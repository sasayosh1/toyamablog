<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🔍 ページビュー送信確認</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #28a745, #20c997);
            min-height: 100vh;
        }
        .container {
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        .header {
            text-align: center;
            background: #28a745;
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
        }
        .step {
            background: #f8f9fa;
            margin: 20px 0;
            padding: 25px;
            border-radius: 15px;
            border-left: 5px solid #28a745;
        }
        .step h3 {
            margin: 0 0 15px 0;
            color: #2c3e50;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .step-number {
            background: #28a745;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        .instruction {
            background: #e7f3ff;
            border: 2px solid #0066cc;
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
        }
        .success {
            background: #d4edda;
            border: 2px solid #c3e6cb;
            color: #155724;
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
        }
        .warning {
            background: #fff3cd;
            border: 2px solid #ffeaa7;
            color: #856404;
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
        }
        .code-block {
            background: #2d3748;
            color: #e2e8f0;
            padding: 20px;
            border-radius: 10px;
            font-family: 'SF Mono', Monaco, monospace;
            font-size: 14px;
            overflow-x: auto;
            margin: 15px 0;
            white-space: pre-wrap;
        }
        button {
            background: #28a745;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            cursor: pointer;
            margin: 10px;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        button:hover {
            background: #218838;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        .btn-primary { background: #007bff; }
        .btn-primary:hover { background: #0056b3; }
        .large-button {
            font-size: 18px;
            padding: 20px 40px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🔍 ページビュー送信確認</h1>
            <p><strong>目的:</strong> collect リクエストでページビュー送信を確認</p>
            <p><strong>時刻:</strong> <span id="timestamp"></span></p>
        </div>

        <div class="step">
            <h3><span class="step-number">1</span>🌐 TOYAMA BLOGを新しいタブで開く</h3>
            <p>DevToolsでページビューを監視するため、新しいタブでサイトを開きます。</p>
            
            <button class="large-button" onclick="openSiteForNetworkTest()">
                🚀 TOYAMA BLOGを開く
            </button>
            
            <div class="warning">
                <strong>⚠️ 重要:</strong> 新しいタブが開いたら、そのタブでDevToolsを開いてください。
            </div>
        </div>

        <div class="step">
            <h3><span class="step-number">2</span>🔧 DevTools設定</h3>
            <p>新しく開いたタブで以下の設定を行ってください。</p>
            
            <div class="instruction">
                <strong>設定手順:</strong>
                <ol>
                    <li>新しいタブで <strong>F12</strong> を押してDevToolsを開く</li>
                    <li><strong>Network</strong> タブを選択</li>
                    <li>フィルター欄に「<strong>collect</strong>」と入力</li>
                    <li><strong>Preserve log</strong> にチェックを入れる（ページ遷移後もログを保持）</li>
                </ol>
            </div>
            
            <button onclick="copyToClipboard('collect')">📋 「collect」をコピー</button>
        </div>

        <div class="step">
            <h3><span class="step-number">3</span>🔄 ページ遷移テスト</h3>
            <p>サイト内でページ遷移を行い、collectリクエストが発生することを確認します。</p>
            
            <div class="instruction">
                <strong>テスト手順:</strong>
                <ol>
                    <li>メインページから任意の記事をクリック</li>
                    <li>記事ページから別の記事またはカテゴリーページへ</li>
                    <li>戻るボタンまたはメインページへ戻る</li>
                    <li>各ページ遷移でNetworkタブを確認</li>
                </ol>
            </div>
            
            <div class="success">
                <strong>✅ 期待される結果:</strong><br>
                <code>collect?v=2&tid=G-5VS8BF91VH</code> のリクエストが表示<br>
                • <strong>ステータス:</strong> 200 OK<br>
                • <strong>メソッド:</strong> GET または POST<br>
                • <strong>頻度:</strong> ページ遷移ごとに1回のみ
            </div>
        </div>

        <div class="step">
            <h3><span class="step-number">4</span>📊 リクエスト詳細確認</h3>
            <p>collectリクエストの内容を詳しく確認します。</p>
            
            <div class="instruction">
                <strong>確認項目:</strong>
                <ul>
                    <li><strong>URL構造:</strong> collect?v=2&tid=G-5VS8BF91VH&...</li>
                    <li><strong>パラメータ:</strong> 
                        <ul>
                            <li>v=2 (GA4プロトコル)</li>
                            <li>tid=G-5VS8BF91VH (測定ID)</li>
                            <li>en=page_view (イベント名)</li>
                            <li>dl=<現在のURL> (ページURL)</li>
                            <li>dt=<ページタイトル> (ページタイトル)</li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>

        <div class="step">
            <h3><span class="step-number">5</span>🚀 手動pageview送信テスト</h3>
            <p>Consoleから手動でpageviewを送信して、即座にcollectリクエストが発生することを確認します。</p>
            
            <div class="code-block">// Console で実行
if (typeof window.gtag === 'function') {
    console.log('🎯 手動pageviewテスト開始');
    
    // 手動pageview送信
    window.gtag('config', 'G-5VS8BF91VH', {
        page_path: '/manual-test-' + Date.now(),
        page_title: 'Manual PageView Test',
        custom_parameter: 'collect_verification'
    });
    
    console.log('✅ 手動pageview送信完了');
    console.log('💡 Networkタブでcollectリクエストを即座に確認してください');
} else {
    console.log('❌ gtag関数が利用できません');
}</div>
            
            <button onclick="copyToClipboard(getManualTestScript())">📋 手動送信スクリプトをコピー</button>
        </div>

        <div class="step">
            <h3><span class="step-number">6</span>📈 結果記録</h3>
            <p>確認結果を記録します。</p>
            
            <div class="success">
                <strong>✅ 成功基準:</strong><br>
                □ collectリクエストが発生<br>
                □ ステータス200 OK<br>
                □ 正しい測定ID (G-5VS8BF91VH)<br>
                □ ページ遷移ごとに1回のみ送信<br>
                □ 手動送信で即座にリクエスト発生
            </div>
            
            <button onclick="generateCollectReport()">📋 確認レポートを生成</button>
        </div>

        <div id="report" style="display: none;">
            <div class="step">
                <h2>📊 ページビュー送信確認レポート</h2>
                <div id="reportContent"></div>
            </div>
        </div>
    </div>

    <script>
        // タイムスタンプ表示
        document.getElementById('timestamp').textContent = new Date().toLocaleString('ja-JP');

        function openSiteForNetworkTest() {
            console.log('🌐 TOYAMA BLOGを新しいタブで開いています...');
            const siteWindow = window.open('https://sasakiyoshimasa.com', '_blank', 'width=1200,height=800');
            
            if (siteWindow) {
                alert('✅ TOYAMA BLOGを新しいタブで開きました！\n\n次の手順:\n1. 新しいタブでF12を押してDevToolsを開く\n2. Networkタブでフィルターを「collect」に設定\n3. Preserve logにチェック\n4. サイト内でページ遷移を実行\n5. collectリクエストの発生を確認');
            } else {
                alert('❌ ポップアップがブロックされました。\nブラウザの設定でポップアップを許可してください。');
            }
        }

        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                const originalText = event.target.textContent;
                event.target.textContent = '✅ コピー完了!';
                event.target.style.background = '#28a745';
                
                setTimeout(() => {
                    event.target.textContent = originalText;
                    event.target.style.background = '#007bff';
                }, 2000);
            }).catch(err => {
                console.error('コピーに失敗:', err);
                alert('クリップボードへのコピーに失敗しました。手動でコピーしてください。');
            });
        }

        function getManualTestScript() {
            return `// Console で実行
if (typeof window.gtag === 'function') {
    console.log('🎯 手動pageviewテスト開始');
    
    // 手動pageview送信
    window.gtag('config', 'G-5VS8BF91VH', {
        page_path: '/manual-test-' + Date.now(),
        page_title: 'Manual PageView Test',
        custom_parameter: 'collect_verification'
    });
    
    console.log('✅ 手動pageview送信完了');
    console.log('💡 Networkタブでcollectリクエストを即座に確認してください');
} else {
    console.log('❌ gtag関数が利用できません');
}`;
        }

        function generateCollectReport() {
            const now = new Date().toLocaleString('ja-JP');
            const reportContent = `
                <div class="success">
                    <h3>🎯 ページビュー送信確認レポート</h3>
                    <p><strong>確認日時:</strong> ${now}</p>
                    <p><strong>測定ID:</strong> G-5VS8BF91VH</p>
                    <p><strong>対象サイト:</strong> https://sasakiyoshimasa.com</p>
                    
                    <h4>📋 確認項目</h4>
                    <p>□ DevToolsでNetworkタブを「collect」フィルターで確認</p>
                    <p>□ ページ遷移時のcollectリクエスト発生確認</p>
                    <p>□ リクエストURL: collect?v=2&tid=G-5VS8BF91VH</p>
                    <p>□ ステータス: 200 OK</p>
                    <p>□ ページ遷移ごとに1回のみ送信</p>
                    <p>□ 手動送信テストでの即座のリクエスト発生</p>
                    
                    <h4>🎉 次のステップ</h4>
                    <p>collectリクエストが確認できたら、GA4リアルタイムレポートでの計測確認に進んでください。</p>
                    
                    <h4>🔗 リンク</h4>
                    <p><a href="https://analytics.google.com/analytics/web/#/p498053318/realtime/overview" target="_blank">GA4リアルタイムレポートを開く</a></p>
                </div>
            `;
            
            document.getElementById('reportContent').innerHTML = reportContent;
            document.getElementById('report').style.display = 'block';
            document.getElementById('report').scrollIntoView({ behavior: 'smooth' });
        }

        // ページ読み込み時の案内
        window.onload = () => {
            console.log('🔍 ページビュー送信確認ツールを開始しました');
            console.log('手順に従ってcollectリクエストの確認を行ってください');
        };
    </script>
</body>
</html>