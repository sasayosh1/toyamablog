import { createClient } from '@sanity/client';

const client = createClient({
  projectId: 'aoxze287',
  dataset: 'production',
  apiVersion: '2024-01-01',
  useCdn: false,
  token: 'skkTjwpdrsjKKpaDxKVShzCSI7GMWE1r5TQdwl0b7LTylVPoAxzBg0oPqhtUQyfPjyvtZW2mu6nfUMNUJ'
});

// H2ã€H3ã‚¿ã‚°ã‚’ä½¿ã£ãŸ2000æ–‡å­—ç¨‹åº¦ã®è©³ç´°è¨˜äº‹ã‚’ç”Ÿæˆã™ã‚‹é–¢æ•°
function generateDetailedArticleContent(extractedData) {
  const { location, stores, subtitle, keywords, originalTitle } = extractedData;
  
  let content = '';
  
  // å°å…¥éƒ¨åˆ†
  content += `${location}ã‚¨ãƒªã‚¢ã‚’è¨ªã‚Œã‚‹çš†æ§˜ã«ã€å¿ƒã‹ã‚‰ãŠã™ã™ã‚ã—ãŸã„ç‰¹åˆ¥ãªã‚¹ãƒãƒƒãƒˆã‚’ã”ç´¹ä»‹ã„ãŸã—ã¾ã™ã€‚`;
  
  if (stores.length > 0) {
    content += `ä»Šå›ã¯ã€Œ${stores[0]}ã€ã«ã¤ã„ã¦ã€ãã®é­…åŠ›ã‚’è©³ã—ããŠä¼ãˆã—ã¦ã„ãã¾ã™ã€‚åœ°åŸŸã«æ ¹ã–ã—ãŸç´ æ™´ã‚‰ã—ã„ãŠåº—ã®æ•°ã€…ãŒã€è¨ªã‚Œã‚‹äººã€…ã«ç‰¹åˆ¥ãªä½“é¨“ã‚’æä¾›ã—ã¦ãã‚Œã‚‹ã“ã¨ã§ã—ã‚‡ã†ã€‚\n\n`;
  } else {
    content += `ã“ã®åœ°åŸŸãªã‚‰ã§ã¯ã®é­…åŠ›ã‚’å­˜åˆ†ã«å‘³ã‚ãˆã‚‹ã€ã¨ã£ã¦ãŠãã®å ´æ‰€ã«ã¤ã„ã¦è©³ã—ãã”ç´¹ä»‹ã„ãŸã—ã¾ã™ã€‚\n\n`;
  }
  
  // åœ°åŸŸã®æ¦‚è¦ã¨æ­´å²
  content += `## ${location}ã‚¨ãƒªã‚¢ã®é­…åŠ›ã¨æ­´å²\n\n`;
  content += `${location}ã¯å¯Œå±±çœŒå†…ã§ã‚‚ç‰¹ã«æ­´å²ã¨æ–‡åŒ–ãŒæ·±ãæ ¹ã–ã—ãŸé­…åŠ›çš„ãªã‚¨ãƒªã‚¢ã¨ã—ã¦çŸ¥ã‚‰ã‚Œã¦ã„ã¾ã™ã€‚ç«‹å±±é€£å³°ã®é›„å¤§ãªæ™¯è¦³ã‚’èƒŒæ™¯ã«ã€å››å­£æŠ˜ã€…ã®ç¾ã—ã„è‡ªç„¶ã®å¤‰åŒ–ã‚’æ¥½ã—ã‚€ã“ã¨ãŒã§ãã‚‹ã“ã®åœ°åŸŸã¯ã€å¤ãã‹ã‚‰å¤šãã®äººã€…ã«æ„›ã•ã‚Œç¶šã‘ã¦ãã¾ã—ãŸã€‚æ±Ÿæˆ¸æ™‚ä»£ã‹ã‚‰ç¶šãå•†äººæ–‡åŒ–ã®å½±éŸ¿ã‚’å—ã‘ãªãŒã‚‰ã€ç¾ä»£ã«è‡³ã‚‹ã¾ã§ç‹¬è‡ªã®ç™ºå±•ã‚’é‚ã’ã¦ãŠã‚Šã€ä¼çµ±ã¨é©æ–°ãŒè¦‹äº‹ã«èª¿å’Œã—ãŸè¡—ä¸¦ã¿ã‚’å½¢æˆã—ã¦ã„ã¾ã™ã€‚\n\n`;
  
  content += `åœ°å…ƒã®æ–¹ã€…ã®æ¸©ã‹ã„ãŠã‚‚ã¦ãªã—ã®å¿ƒã¨ã€ä»£ã€…å—ã‘ç¶™ãŒã‚Œã¦ããŸè·äººã®æŠ€è¡“ã‚„ä¼çµ±ãŒã€ç¾ä»£ã®ç”Ÿæ´»ã‚¹ã‚¿ã‚¤ãƒ«ã¨è‡ªç„¶ã«èåˆã—ã¦ã„ã‚‹ã®ã‚‚ã€ã“ã®åœ°åŸŸãªã‚‰ã§ã¯ã®ç‰¹å¾´ã¨ã„ãˆã‚‹ã§ã—ã‚‡ã†ã€‚ç‰¹ã«è¿‘å¹´ã§ã¯ã€è‹¥ã„ä¸–ä»£ã®æ–°ã—ã„ã‚¢ã‚¤ãƒ‡ã‚¢ã¨ä¼çµ±çš„ãªæ‰‹æ³•ãŒçµ„ã¿åˆã‚ã•ã‚‹ã“ã¨ã§ã€ã“ã‚Œã¾ã§ã«ãªã„é­…åŠ›çš„ãªåº—èˆ—ã‚„æ–½è¨­ãŒæ•°å¤šãèª•ç”Ÿã—ã¦ã„ã¾ã™ã€‚\n\n`;
  
  // å…·ä½“çš„ãªåº—èˆ—ã‚„æ–½è¨­ã«ã¤ã„ã¦ã®è©³ç´°æƒ…å ±
  if (stores.length > 0) {
    content += `## ${stores[0]}ã®ç‰¹å¾´ã¨é­…åŠ›\n\n`;
    
    if (keywords.includes('ã‚±ãƒ¼ã‚­') || keywords.includes('ã‚¹ã‚¤ãƒ¼ãƒ„')) {
      content += `### è·äººã®ã“ã ã‚ã‚Šã¨æŠ€è¡“\n\n`;
      content += `ã“ã¡ã‚‰ã®ãŠåº—ã§ã¯ã€é•·å¹´ã®çµŒé¨“ã‚’ç©ã‚“ã ç†Ÿç·´ã®è·äººãŒã€ä¸€ã¤ä¸€ã¤å¿ƒã‚’è¾¼ã‚ã¦ä½œã‚‹çµ¶å“ã‚¹ã‚¤ãƒ¼ãƒ„ã‚’å‘³ã‚ã†ã“ã¨ãŒã§ãã¾ã™ã€‚å³é¸ã•ã‚ŒãŸæœ€é«˜å“è³ªã®ææ–™ã‚’ä½¿ç”¨ã—ã€ä¼çµ±çš„ãªè£½æ³•ã«é©æ–°çš„ãªã‚¢ã‚¤ãƒ‡ã‚¢ã‚’å·§ã¿ã«çµ„ã¿åˆã‚ã›ã‚‹ã“ã¨ã§ã€ä»–ã§ã¯å‘³ã‚ãˆãªã„ç‹¬ç‰¹ã®ç¾å‘³ã—ã•ã‚’ç”Ÿã¿å‡ºã—ã¦ã„ã¾ã™ã€‚\n\n`;
      
      content += `ç‰¹ã«æ³¨ç›®ã™ã¹ãã¯ã€å­£ç¯€ã”ã¨ã«å¤‰ã‚ã‚‹é™å®šãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®è±Šå¯Œã•ã§ã™ã€‚æ˜¥ã«ã¯æ¡œã‚’ä½¿ã£ãŸä¸Šå“ãªå’Œé¢¨ã‚¹ã‚¤ãƒ¼ãƒ„ã€å¤ã«ã¯çˆ½ã‚„ã‹ãªãƒ•ãƒ«ãƒ¼ãƒ„ã‚’æ´»ã‹ã—ãŸã‚±ãƒ¼ã‚­ã€ç§‹ã«ã¯æ —ã‚„èŠ‹ã‚’ä½¿ã£ãŸæ¿ƒåšãªå‘³ã‚ã„ã®ãƒ‡ã‚¶ãƒ¼ãƒˆã€å†¬ã«ã¯æ¸©ã‹ã¿ã®ã‚ã‚‹ãƒãƒ§ã‚³ãƒ¬ãƒ¼ãƒˆç³»ã®ã‚¹ã‚¤ãƒ¼ãƒ„ãªã©ã€ä¸€å¹´ã‚’é€šã˜ã¦é£½ãã‚‹ã“ã¨ãªãæ¥½ã—ã‚€ã“ã¨ãŒã§ãã¾ã™ã€‚\n\n`;
      
      content += `### åº—å†…ã®é›°å›²æ°—ã¨ã‚µãƒ¼ãƒ“ã‚¹\n\n`;
      content += `åº—å†…ã¯è½ã¡ç€ã„ãŸé›°å›²æ°—ã§çµ±ä¸€ã•ã‚Œã¦ãŠã‚Šã€ã‚†ã£ãã‚Šã¨ãã¤ã‚ããªãŒã‚‰ã‚¹ã‚¤ãƒ¼ãƒ„ã‚’æ¥½ã—ã‚€ã“ã¨ãŒã§ãã‚‹ç©ºé–“ã¨ãªã£ã¦ã„ã¾ã™ã€‚ã‚¹ã‚¿ãƒƒãƒ•ã®æ–¹ã€…ã®ä¸å¯§ãªæ¥å®¢ã‚‚å°è±¡çš„ã§ã€åˆã‚ã¦è¨ªã‚Œã‚‹ãŠå®¢æ§˜ã«ã‚‚å®‰å¿ƒã—ã¦ãŠæ¥½ã—ã¿ã„ãŸã ã‘ã‚‹ã‚ˆã†ã€ç´°ã‚„ã‹ãªå¿ƒé…ã‚ŠãŒã•ã‚Œã¦ã„ã¾ã™ã€‚\n\n`;
      
    } else if (keywords.includes('ãƒ‘ãƒ³')) {
      content += `### æ¯æ—¥ç„¼ããŸã¦ã€è·äººã®æŠ€\n\n`;
      content += `æ¯æœæ—©ãã‹ã‚‰åº—å†…ã§ç„¼ãä¸Šã’ã‚‰ã‚Œã‚‹é¦™ã‚Šé«˜ã„ãƒ‘ãƒ³ã®æ•°ã€…ã¯ã€å³é¸ã•ã‚ŒãŸå°éº¦ç²‰ã¨å¤©ç„¶é…µæ¯ã‚’ä½¿ç”¨ã—ãŸæœ¬æ ¼çš„ãªå‘³ã‚ã„ãŒè‡ªæ…¢ã§ã™ã€‚è·äººãŒé•·å¹´åŸ¹ã£ã¦ããŸç¢ºã‹ãªæŠ€è¡“ã¨ã€ç¾å‘³ã—ã„ãƒ‘ãƒ³ã¸ã®æƒ…ç†±ãŒè¾¼ã‚ã‚‰ã‚ŒãŸä¸€ã¤ä¸€ã¤ã®å•†å“ã¯ã€åœ°å…ƒã®æ–¹ã€…ã¯ã‚‚ã¡ã‚ã‚“ã€é æ–¹ã‹ã‚‰ã‚ã–ã‚ã–è¶³ã‚’é‹ã¶ãƒ•ã‚¡ãƒ³ã‚‚å¤šã„äººæ°—åº—ã¨ãªã£ã¦ã„ã¾ã™ã€‚\n\n`;
      
      content += `### äººæ°—å•†å“ã¨å­£ç¯€é™å®šãƒ¡ãƒ‹ãƒ¥ãƒ¼\n\n`;
      content += `å®šç•ªã®é£Ÿãƒ‘ãƒ³ã‚„ã‚¯ãƒ­ãƒ¯ãƒƒã‚µãƒ³ã‹ã‚‰ã€å­£ç¯€ã®é£Ÿæã‚’ä½¿ã£ãŸé™å®šå•†å“ã¾ã§ã€å¸¸æ™‚50ç¨®é¡ä»¥ä¸Šã®ãƒ‘ãƒ³ãŒåº—é ­ã«ä¸¦ã³ã¾ã™ã€‚ç‰¹ã«äººæ°—ã®å•†å“ã¯åˆå‰ä¸­ã«å£²ã‚Šåˆ‡ã‚Œã¦ã—ã¾ã†ã“ã¨ã‚‚ã‚ã‚‹ãŸã‚ã€ãŠç›®å½“ã¦ã®å•†å“ãŒã‚ã‚‹å ´åˆã¯æ—©ã‚ã®æ¥åº—ã‚’ãŠã™ã™ã‚ã—ã¾ã™ã€‚\n\n`;
      
    } else if (keywords.includes('ãŸã„ç„¼ã') || keywords.includes('ã©ã‚‰ç„¼ã')) {
      content += `### ä¼çµ±ã®è£½æ³•ã¨ç´ æã¸ã®ã“ã ã‚ã‚Š\n\n`;
      content += `æ˜”ãªãŒã‚‰ã®ä¼çµ±çš„ãªè£½æ³•ã‚’å¤§åˆ‡ã«å®ˆã‚ŠãªãŒã‚‰ã€ä¸€ã¤ä¸€ã¤æ‰‹ä½œæ¥­ã§ä¸å¯§ã«ä½œã‚‰ã‚Œã‚‹å’Œè“å­ã¯ã€ã©ã“ã‹æ‡ã‹ã—ãã€å¿ƒæ¸©ã¾ã‚‹å‘³ã‚ã„ãŒç‰¹å¾´ã§ã™ã€‚å³é¸ã•ã‚ŒãŸåŒ—æµ·é“ç”£ã®å°è±†ã¨ã€åœ°å…ƒå¯Œå±±ã®ç¾å‘³ã—ã„æ°´ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§ã€ç´ ææœ¬æ¥ã®è‡ªç„¶ãªç”˜ã•ã‚’æœ€å¤§é™ã«æ´»ã‹ã—ãŸå„ªã—ã„å‘³ã‚ã„ã‚’å®Ÿç¾ã—ã¦ã„ã¾ã™ã€‚\n\n`;
      
      content += `### è£½é€ å·¥ç¨‹ã¸ã®ã“ã ã‚ã‚Š\n\n`;
      content += `ã‚ã‚“ã“ã®ç‚Šãä¸Šã’ã‹ã‚‰ç”Ÿåœ°ã®ä»•è¾¼ã¿ã€ç„¼ãä¸Šã’ã«è‡³ã‚‹ã¾ã§ã€ã™ã¹ã¦ã®å·¥ç¨‹ã§è·äººã®ç†Ÿç·´ã—ãŸæŠ€è¡“ãŒæ´»ã‹ã•ã‚Œã¦ã„ã¾ã™ã€‚ç‰¹ã«æ¸©åº¦ç®¡ç†ã¨ç„¼ãæ™‚é–“ã®èª¿æ•´ã¯ã€é•·å¹´ã®çµŒé¨“ã«åŸºã¥ãçµ¶å¦™ãªãƒãƒ©ãƒ³ã‚¹ã§è¡Œã‚ã‚Œã¦ãŠã‚Šã€å¤–ã¯ã‚µã‚¯ãƒƒã¨ã€ä¸­ã¯ã—ã£ã¨ã‚Šã¨ã—ãŸç†æƒ³çš„ãªé£Ÿæ„Ÿã‚’ç”Ÿã¿å‡ºã—ã¦ã„ã¾ã™ã€‚\n\n`;
      
    } else if (keywords.includes('ã‚Šã‚“ã”é£´')) {
      content += `### æ–°é®®ãªç´ æã¨è·äººæŠ€\n\n`;
      content += `å³é¸ã•ã‚ŒãŸæ–°é®®ãªã‚Šã‚“ã”ã‚’ä½¿ç”¨ã—ãŸç‰¹è£½ã®ã‚Šã‚“ã”é£´ã¯ã€ãƒ‘ãƒªãƒƒã¨ã—ãŸé£Ÿæ„Ÿã¨ç¨‹ã‚ˆã„ç”˜ã•ãŒçµ¶å¦™ãªãƒãƒ©ãƒ³ã‚¹ã‚’ä¿ã£ã¦ã„ã¾ã™ã€‚è¦‹ãŸç›®ã«ã‚‚ç¾ã—ãã€SNSæ˜ ãˆã™ã‚‹å•†å“ã¨ã—ã¦è‹¥ã„ä¸–ä»£ã‹ã‚‰ã‚‚çµ¶å¤§ãªäººæ°—ã‚’é›†ã‚ã¦ã„ã¾ã™ã€‚è·äººãŒä¸€ã¤ä¸€ã¤ä¸å¯§ã«ä»•ä¸Šã’ã‚‹æ‰‹ä½œã‚Šã®æ¸©ã‹ã•ã‚’æ„Ÿã˜ã‚‰ã‚Œã‚‹é€¸å“ã§ã™ã€‚\n\n`;
      
      content += `### å¤šå½©ãªãƒãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³\n\n`;
      content += `å®šç•ªã®ã‚Šã‚“ã”é£´ã«åŠ ãˆã¦ã€å­£ç¯€é™å®šã®ãƒ•ãƒ¬ãƒ¼ãƒãƒ¼ã‚„ã€ç‰¹åˆ¥ãªãƒˆãƒƒãƒ”ãƒ³ã‚°ã‚’æ–½ã—ãŸå•†å“ã‚‚äººæ°—ã§ã™ã€‚ãã‚Œãã‚Œç•°ãªã‚‹å‘³ã‚ã„ã¨è¦‹ãŸç›®ã‚’æ¥½ã—ã‚€ã“ã¨ãŒã§ãã€ãŠåœŸç”£ã¨ã—ã¦ã‚‚å¤§å¤‰å–œã°ã‚Œã¦ã„ã¾ã™ã€‚\n\n`;
    }
  }
  
  // å‘¨è¾ºç’°å¢ƒã¨ã‚¢ã‚¯ã‚»ã‚¹æƒ…å ±
  content += `## å‘¨è¾ºã‚¨ãƒªã‚¢ã®è¦‹ã©ã“ã‚\n\n`;
  content += `${location}ã‚’è¨ªã‚Œã‚‹éš›ã¯ã€ãƒ¡ã‚¤ãƒ³ã®ç›®çš„åœ°ã ã‘ã§ãªãã€å‘¨è¾ºã‚¨ãƒªã‚¢ã‚‚åˆã‚ã›ã¦æ•£ç­–ã™ã‚‹ã“ã¨ã‚’å¼·ããŠã™ã™ã‚ã„ãŸã—ã¾ã™ã€‚å¾’æ­©åœå†…ã«ã¯æ­´å²çš„ãªå»ºé€ ç‰©ã‚„ç¾ã—ã„å…¬åœ’ã€å€‹æ€§çš„ãªã‚·ãƒ§ãƒƒãƒ—ãªã©ã€é­…åŠ›çš„ãªã‚¹ãƒãƒƒãƒˆãŒæ•°å¤šãç‚¹åœ¨ã—ã¦ãŠã‚Šã€ãã‚Œãã‚Œã®å­£ç¯€ã«ã‚ˆã£ã¦å…¨ãç•°ãªã‚‹è¡¨æƒ…ã‚’è¦‹ã›ã¦ãã‚Œã‚‹ãŸã‚ã€ä½•åº¦è¨ªã‚Œã¦ã‚‚æ–°ã—ã„ç™ºè¦‹ã¨æ„Ÿå‹•ãŒã‚ã‚‹ã“ã¨ã§ã—ã‚‡ã†ã€‚\n\n`;
  
  content += `### æ­´å²çš„å»ºé€ ç‰©ã¨æ–‡åŒ–æ–½è¨­\n\n`;
  content += `ã‚¨ãƒªã‚¢å†…ã«ã¯æ±Ÿæˆ¸æ™‚ä»£ã‹ã‚‰æ˜æ²»æ™‚ä»£ã«ã‹ã‘ã¦å»ºã¦ã‚‰ã‚ŒãŸæ­´å²çš„ãªå»ºé€ ç‰©ãŒæ•°å¤šãæ®‹ã•ã‚Œã¦ãŠã‚Šã€å½“æ™‚ã®ç”Ÿæ´»ã‚„æ–‡åŒ–ã‚’å£é–“è¦‹ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã¾ãŸã€åœ°åŸŸã®æ–‡åŒ–ã‚„èŠ¸è¡“ã‚’ç´¹ä»‹ã™ã‚‹æ–½è¨­ã‚‚å……å®Ÿã—ã¦ãŠã‚Šã€åœ°å…ƒã®æ­´å²ã‚„ä¼çµ±ã«ã¤ã„ã¦æ·±ãå­¦ã¶ã“ã¨ãŒã§ãã‚‹è²´é‡ãªæ©Ÿä¼šã¨ãªã£ã¦ã„ã¾ã™ã€‚\n\n`;
  
  content += `### è‡ªç„¶ç’°å¢ƒã¨å­£ç¯€ã®æ¥½ã—ã¿\n\n`;
  if (keywords.includes('ç¥­ã‚Š') || keywords.includes('èŠ±ç«')) {
    content += `ç‰¹ã«ãŠç¥­ã‚Šã‚„èŠ±ç«å¤§ä¼šãªã©ã®å­£ç¯€ã‚¤ãƒ™ãƒ³ãƒˆé–‹å‚¬æ™‚æœŸã«ã¯ã€åœ°åŸŸå…¨ä½“ãŒæ´»æ°—ã«æº€ã¡æº¢ã‚Œã€æ™®æ®µã¨ã¯é•ã£ãŸç‰¹åˆ¥ãªé›°å›²æ°—ã‚’æ¥½ã—ã‚€ã“ã¨ãŒã§ãã¾ã™ã€‚åœ°å…ƒã®ä¼çµ±æ–‡åŒ–ã‚„ç¿’æ…£ã‚’ç›´æ¥è‚Œã§æ„Ÿã˜ã‚‹ã“ã¨ãŒã§ãã‚‹è²´é‡ãªæ©Ÿä¼šã¨ãªã‚Šã€å‚åŠ ã•ã‚Œã‚‹æ–¹ã€…ã«ã¨ã£ã¦å¿˜ã‚Œã‚‰ã‚Œãªã„æ€ã„å‡ºã¨ãªã‚‹ã“ã¨ã§ã—ã‚‡ã†ã€‚\n\n`;
  } else if (keywords.includes('æ¡œ') || keywords.includes('ç´…è‘‰')) {
    content += `è‡ªç„¶ã®ç¾ã—ã•ã‚’å­˜åˆ†ã«æ¥½ã—ã‚€ãªã‚‰ã€å­£ç¯€ã®ç§»ã‚ã„ã¨ã¨ã‚‚ã«åŠ‡çš„ã«å¤‰åŒ–ã™ã‚‹é¢¨æ™¯ã«ãœã²æ³¨ç›®ã—ã¦ãã ã•ã„ã€‚ç‰¹ã«æ˜¥ã®æ¡œãŒå’²ãèª‡ã‚‹æ™‚æœŸã«ã¯ã€ã‚¨ãƒªã‚¢å…¨ä½“ãŒãƒ”ãƒ³ã‚¯è‰²ã«æŸ“ã¾ã‚Šã€ç§‹ã®ç´…è‘‰ã‚·ãƒ¼ã‚ºãƒ³ã«ã¯å±±ã€…ãŒèµ¤ã‚„é»„è‰²ã«ç¾ã—ãå½©ã‚‰ã‚Œã¾ã™ã€‚ã“ã‚Œã‚‰ã®å­£ç¯€ã¯å¤šãã®è¦³å…‰å®¢ã‚„å†™çœŸæ„›å¥½å®¶ãŒè¨ªã‚Œã‚‹äººæ°—ã®æ™‚æœŸã¨ãªã£ã¦ã„ã¾ã™ã€‚\n\n`;
  } else {
    content += `åœ°å…ƒã®æ–¹ã€…ã¨ã®ä½•æ°—ãªã„äº¤æµã‚‚ã€æ—…ã®å¤§ããªé†é†å‘³ã®ä¸€ã¤ã§ã™ã€‚æ¸©ã‹ã„äººæŸ„ã«è§¦ã‚Œã€åœ°åŸŸã®ç”Ÿæ´»ã‚„æ–‡åŒ–ã«ã¤ã„ã¦æ•™ãˆã¦ã„ãŸã ãã“ã¨ã§ã€ã‚ˆã‚Šæ·±ãã“ã®åœŸåœ°ã®çœŸã®é­…åŠ›ã‚’ç†è§£ã—ã€å¿ƒã«æ®‹ã‚‹ä½“é¨“ã‚’ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã§ã—ã‚‡ã†ã€‚\n\n`;
  }
  
  // å®Ÿç”¨çš„ãªæƒ…å ±
  content += `## è¨ªå•æ™‚ã®ãŠã™ã™ã‚ãƒã‚¤ãƒ³ãƒˆ\n\n`;
  content += `### ãƒ™ã‚¹ãƒˆãªè¨ªå•æ™‚é–“\n\n`;
  content += `${location}ã‚’æœ€ã‚‚æ¥½ã—ã‚€ãŸã‚ã«ã¯ã€æ™‚é–“å¸¯ã‚„å­£ç¯€ã‚’è€ƒæ…®ã—ãŸè¨ˆç”»çš„ãªè¨ªå•ã‚’ãŠã™ã™ã‚ã—ã¾ã™ã€‚æœã®æ™‚é–“å¸¯ã¯æ¯”è¼ƒçš„äººãŒå°‘ãªãã€ã‚†ã£ãã‚Šã¨è½ã¡ç€ã„ã¦æ¥½ã—ã‚€ã“ã¨ãŒã§ãã¾ã™ã€‚ã¾ãŸã€å¤•æ–¹ã®æ™‚é–“å¸¯ã«ã¯ç¾ã—ã„å¤•æ—¥ã‚’èƒŒæ™¯ã«ã—ãŸé¢¨æ™¯ã‚’æ¥½ã—ã‚€ã“ã¨ãŒã§ãã€ä¸€æ—¥ã®ç· ã‚ããã‚Šã¨ã—ã¦ã‚‚æœ€é©ã§ã™ã€‚\n\n`;
  
  content += `### ã‚¢ã‚¯ã‚»ã‚¹ã¨é§è»Šå ´æƒ…å ±\n\n`;
  content += `å…¬å…±äº¤é€šæ©Ÿé–¢ã‚’åˆ©ç”¨ã™ã‚‹å ´åˆã¯ã€æœ€å¯„ã‚Šé§…ã‹ã‚‰å¾’æ­©ã§ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ã§ã™ã€‚è»Šã§ãŠè¶Šã—ã®å ´åˆã¯ã€å‘¨è¾ºã«è¤‡æ•°ã®é§è»Šå ´ãŒç”¨æ„ã•ã‚Œã¦ãŠã‚Šã€æ¯”è¼ƒçš„ã‚¢ã‚¯ã‚»ã‚¹ã—ã‚„ã™ã„ç«‹åœ°ã¨ãªã£ã¦ã„ã¾ã™ã€‚ãŸã ã—ã€ã‚¤ãƒ™ãƒ³ãƒˆé–‹å‚¬æ™‚ã‚„è¦³å…‰ã‚·ãƒ¼ã‚ºãƒ³ã«ã¯æ··é›‘ãŒäºˆæƒ³ã•ã‚Œã‚‹ãŸã‚ã€æ™‚é–“ã«ä½™è£•ã‚’æŒã£ãŸè¨ˆç”»ã‚’ãŠã™ã™ã‚ã—ã¾ã™ã€‚\n\n`;
  
  content += `### åœ°åŸŸã®ãƒãƒŠãƒ¼ã¨æ³¨æ„ç‚¹\n\n`;
  content += `${location}ã‚’è¨ªã‚Œã‚‹éš›ã¯ã€åœ°åŸŸã®æ–‡åŒ–ã‚„ç¿’æ…£ã‚’å°Šé‡ã—ã€ãƒãƒŠãƒ¼ã‚’å®ˆã£ã¦æ¥½ã—ã„æ™‚é–“ã‚’éã”ã—ã¦ã„ãŸã ã‘ã‚Œã°ã¨æ€ã„ã¾ã™ã€‚ç‰¹ã«ä½å®…åœ°ã«è¿‘ã„ã‚¨ãƒªã‚¢ã§ã¯ã€é¨’éŸ³ã«æ³¨æ„ã—ã€åœ°å…ƒã®æ–¹ã€…ã®ç”Ÿæ´»ã«é…æ…®ã™ã‚‹ã“ã¨ãŒå¤§åˆ‡ã§ã™ã€‚ã¾ãŸã€ã‚´ãƒŸã®æŒã¡å¸°ã‚Šã‚„å†™çœŸæ’®å½±æ™‚ã®ãƒãƒŠãƒ¼ãªã©ã€åŸºæœ¬çš„ãªãƒ«ãƒ¼ãƒ«ã‚’å®ˆã‚‹ã“ã¨ã§ã€ã™ã¹ã¦ã®æ–¹ãŒæ°—æŒã¡ã‚ˆãéã”ã›ã‚‹ç’°å¢ƒã¥ãã‚Šã«ã”å”åŠ›ãã ã•ã„ã€‚\n\n`;
  
  // ã¾ã¨ã‚
  content += `## ã¾ã¨ã‚\n\n`;
  content += `${location}ã§ã®ã²ã¨ã¨ãã¯ã€ãã£ã¨çš†æ§˜ã«ã¨ã£ã¦ç‰¹åˆ¥ã§å¿ƒã«æ®‹ã‚‹æ€ã„å‡ºã¨ãªã‚‹ã“ã¨ã§ã—ã‚‡ã†ã€‚`;
  
  if (stores.length > 0) {
    content += `${stores[0]}ã‚’ã¯ã˜ã‚ã¨ã™ã‚‹åœ°åŸŸã®é­…åŠ›çš„ãªã‚¹ãƒãƒƒãƒˆã‚’å·¡ã‚ŠãªãŒã‚‰ã€`;
  }
  
  content += `å¯Œå±±ã®å¥¥æ·±ã„é­…åŠ›ã¨æ¸©ã‹ã„äººæƒ…ã‚’å­˜åˆ†ã«å‘³ã‚ã£ã¦ã„ãŸã ã‘ã‚Œã°ã¨æ€ã„ã¾ã™ã€‚\n\n`;
  
  content += `å››å­£ã‚’é€šã˜ã¦ç•°ãªã‚‹è¡¨æƒ…ã‚’è¦‹ã›ã¦ãã‚Œã‚‹ã“ã®åœ°åŸŸã¯ã€ä½•åº¦è¨ªã‚Œã¦ã‚‚æ–°ã—ã„ç™ºè¦‹ãŒã‚ã‚Šã€ãƒªãƒ”ãƒ¼ã‚¿ãƒ¼ã®æ–¹ã‚‚å¤šãã„ã‚‰ã£ã—ã‚ƒã„ã¾ã™ã€‚æ¬¡å›ã®${location}è¨ªå•æ™‚ã«ã‚‚ã€ã¾ãŸé•ã£ãŸè§’åº¦ã‹ã‚‰åœ°åŸŸã®é­…åŠ›ã‚’ç™ºè¦‹ã—ã¦ã„ãŸã ã‘ã‚‹ã“ã¨ã¨æ€ã„ã¾ã™ã€‚ãœã²æ™‚é–“ã«ä½™è£•ã‚’æŒã£ã¦ã€ã‚†ã£ãã‚Šã¨ã—ãŸç™’ã—ã®æ™‚é–“ã‚’ãŠéã”ã—ãã ã•ã„ã€‚\n\n`;
  
  content += `åœ°åŸŸã®çš†æ§˜ã¨è¨ªã‚Œã‚‹æ–¹ã€…ãŒå…±ã«æ¥½ã—ã‚ã‚‹ã€ç´ æ™´ã‚‰ã—ã„å ´æ‰€ã§ã‚ã‚Šç¶šã‘ã‚‹ã“ã¨ã‚’é¡˜ã£ã¦ãŠã‚Šã¾ã™ã€‚çš†æ§˜ã®ãŠè¶Šã—ã‚’å¿ƒã‚ˆã‚ŠãŠå¾…ã¡ã—ã¦ã„ã¾ã™ã€‚`;
  
  return content;
}

// ã‚¿ã‚¤ãƒˆãƒ«ã‹ã‚‰ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’æŠ½å‡ºã™ã‚‹é–¢æ•°
function extractKeywordsFromTitle(title) {
  const locationMatch = title.match(/ã€([^ã€‘]+)ã€‘/);
  const location = locationMatch ? locationMatch[1] : '';
  
  const storeMatches = title.match(/ã€Œ([^ã€]+)ã€/g);
  const stores = storeMatches ? storeMatches.map(match => match.replace(/[ã€Œã€]/g, '')) : [];
  
  const subtitleMatch = title.match(/ï½œ(.+)$/);
  const subtitle = subtitleMatch ? subtitleMatch[1] : '';
  
  const keywords = [];
  
  const foodKeywords = ['ã‚±ãƒ¼ã‚­', 'ãƒ‘ãƒ³', 'ã©ã‚‰ç„¼ã', 'ãŸã„ç„¼ã', 'ã‚Šã‚“ã”é£´', 'ã‚«ãƒ¬ãƒ¼ãƒ‘ãƒ³', 'ãƒ©ãƒ¼ãƒ¡ãƒ³', 'ã‚¹ã‚¤ãƒ¼ãƒ„', 'å’Œè“å­'];
  foodKeywords.forEach(keyword => {
    if (title.includes(keyword)) {
      keywords.push(keyword);
    }
  });
  
  const tourismKeywords = ['ç¥ç¤¾', 'å¯º', 'å…¬åœ’', 'æ¸©æ³‰', 'åšç‰©é¤¨', 'æ°´æ—é¤¨', 'ç¥­ã‚Š', 'èŠ±ç«', 'æ¡œ', 'ç´…è‘‰', 'ã‚¤ãƒ«ãƒŸãƒãƒ¼ã‚·ãƒ§ãƒ³'];
  tourismKeywords.forEach(keyword => {
    if (title.includes(keyword)) {
      keywords.push(keyword);
    }
  });
  
  const activityKeywords = ['æ•£æ­©', 'è¦‹å­¦', 'å·¥å ´è¦‹å­¦', 'ã¾ã¤ã‚Š', 'ãƒ•ã‚§ã‚¹ãƒ†ã‚£ãƒãƒ«', 'ãƒ©ã‚¤ãƒˆã‚¢ãƒƒãƒ—'];
  activityKeywords.forEach(keyword => {
    if (title.includes(keyword)) {
      keywords.push(keyword);
    }
  });
  
  return {
    location,
    stores,
    subtitle,
    keywords,
    originalTitle: title
  };
}

// Sanityç”¨ã®PortableTextãƒ–ãƒ­ãƒƒã‚¯ã«å¤‰æ›ã™ã‚‹é–¢æ•°
function convertToPortableText(content) {
  const blocks = [];
  const paragraphs = content.split('\n\n');
  
  paragraphs.forEach(paragraph => {
    if (paragraph.trim() === '') return;
    
    if (paragraph.startsWith('## ')) {
      // H2è¦‹å‡ºã—
      blocks.push({
        _type: 'block',
        _key: Math.random().toString(36).substr(2, 9),
        style: 'h2',
        children: [{
          _type: 'span',
          _key: Math.random().toString(36).substr(2, 9),
          text: paragraph.replace('## ', ''),
          marks: []
        }]
      });
    } else if (paragraph.startsWith('### ')) {
      // H3è¦‹å‡ºã—
      blocks.push({
        _type: 'block',
        _key: Math.random().toString(36).substr(2, 9),
        style: 'h3',
        children: [{
          _type: 'span',
          _key: Math.random().toString(36).substr(2, 9),
          text: paragraph.replace('### ', ''),
          marks: []
        }]
      });
    } else {
      // é€šå¸¸ã®æ®µè½
      blocks.push({
        _type: 'block',
        _key: Math.random().toString(36).substr(2, 9),
        style: 'normal',
        children: [{
          _type: 'span',
          _key: Math.random().toString(36).substr(2, 9),
          text: paragraph,
          marks: []
        }]
      });
    }
  });
  
  return blocks;
}

async function generateLongArticleContent() {
  try {
    console.log('ğŸ“ 2000æ–‡å­—ç¨‹åº¦ã®è©³ç´°è¨˜äº‹ã‚’ç”Ÿæˆã—ã¾ã™...\n');
    
    // å…ˆã»ã©å‡¦ç†ã—ãŸ3ã¤ã®è¨˜äº‹ã‚’å–å¾—
    const posts = await client.fetch(`
      *[_type == "post" && defined(publishedAt) && slug.current in ["toyama-city-cake-station", "toyama-city-50", "toyama-city-candy-apple-maroot"]]{ 
        _id,
        title, 
        description,
        category,
        "slug": slug.current,
        publishedAt
      }
    `);
    
    console.log(`ğŸ“‹ ç”Ÿæˆå¯¾è±¡è¨˜äº‹æ•°: ${posts.length}ä»¶\n`);
    
    let processedCount = 0;
    
    for (const post of posts) {
      console.log(`ğŸ“ ç”Ÿæˆä¸­: ${post.title}`);
      console.log(`   ã‚¹ãƒ©ãƒƒã‚°: ${post.slug}`);
      
      try {
        // ã‚¿ã‚¤ãƒˆãƒ«ã‹ã‚‰ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’æŠ½å‡º
        const extractedData = extractKeywordsFromTitle(post.title);
        
        // 2000æ–‡å­—ç¨‹åº¦ã®è©³ç´°è¨˜äº‹å†…å®¹ã‚’ç”Ÿæˆ
        const detailedContent = generateDetailedArticleContent(extractedData);
        console.log(`   ç”Ÿæˆæ–‡å­—æ•°: ${detailedContent.length}æ–‡å­—`);
        
        // PortableTextãƒ–ãƒ­ãƒƒã‚¯ã«å¤‰æ›
        const portableTextBlocks = convertToPortableText(detailedContent);
        
        // Sanityã«ä¿å­˜
        await client
          .patch(post._id)
          .set({ body: portableTextBlocks })
          .commit();
        
        console.log(`   âœ… ç”Ÿæˆå®Œäº†\n`);
        processedCount++;
        
        // ãƒ¬ãƒ¼ãƒˆåˆ¶é™å¯¾ç­–
        await new Promise(resolve => setTimeout(resolve, 1000));
        
      } catch (error) {
        console.error(`   âŒ ç”Ÿæˆå¤±æ•—: ${error.message}\n`);
      }
    }
    
    console.log('ğŸ‰ è©³ç´°è¨˜äº‹ç”Ÿæˆå®Œäº†ï¼');
    console.log(`ğŸ“Š çµæœ: ${processedCount}/${posts.length}ä»¶ã®è¨˜äº‹ã‚’ç”Ÿæˆã—ã¾ã—ãŸã€‚`);
    
  } catch (error) {
    console.error('âŒ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ:', error.message);
  }
}

generateLongArticleContent();