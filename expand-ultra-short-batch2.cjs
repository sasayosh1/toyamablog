const { createClient } = require('@sanity/client');

const client = createClient({
  projectId: 'aoxze287',
  dataset: 'production',
  apiVersion: '2024-01-01',
  useCdn: false,
  token: process.env.SANITY_API_TOKEN
});

async function expandUltraShortArticle(article) {
  try {
    const post = await client.fetch(`*[_type == "post" && slug.current == "${article.slug}"][0] { _id, title, body }`);
    if (!post) throw new Error(`記事が見つかりません: ${article.slug}`);

    // 現在の文字数カウント
    let currentChars = 0;
    post.body.forEach(block => {
      if (block._type === 'block' && block.children) {
        const text = block.children.map(child => child.text || '').join('');
        currentChars += text.length;
      }
    });

    // 既存のYouTube埋め込みなどは保持しつつ、高品質コンテンツを追加
    const existingContent = [...post.body];
    
    // 新しい高品質コンテンツを追加
    const expandedBody = [
      // 導入文
      {
        _type: 'block',
        _key: `intro-${Date.now()}`,
        style: 'normal',
        children: [{
          _type: 'span',
          _key: `span-intro-${Date.now()}`,
          text: article.content[0].intro,
          marks: []
        }],
        markDefs: []
      },
      // 既存のYouTube埋め込み等を保持
      ...existingContent,
      // H2セクション1
      {
        _type: 'block',
        _key: `h2-1-${Date.now()}`,
        style: 'h2',
        children: [{
          _type: 'span',
          _key: `span-h2-1-${Date.now()}`,
          text: article.content[1].h2,
          marks: []
        }],
        markDefs: []
      },
      {
        _type: 'block',
        _key: `content-1-${Date.now()}`,
        style: 'normal',
        children: [{
          _type: 'span',
          _key: `span-content-1-${Date.now()}`,
          text: article.content[1].text,
          marks: []
        }],
        markDefs: []
      },
      // H2セクション2
      {
        _type: 'block',
        _key: `h2-2-${Date.now()}`,
        style: 'h2',
        children: [{
          _type: 'span',
          _key: `span-h2-2-${Date.now()}`,
          text: article.content[2].h2,
          marks: []
        }],
        markDefs: []
      },
      {
        _type: 'block',
        _key: `content-2-${Date.now()}`,
        style: 'normal',
        children: [{
          _type: 'span',
          _key: `span-content-2-${Date.now()}`,
          text: article.content[2].text,
          marks: []
        }],
        markDefs: []
      },
      // H2セクション3
      {
        _type: 'block',
        _key: `h2-3-${Date.now()}`,
        style: 'h2',
        children: [{
          _type: 'span',
          _key: `span-h2-3-${Date.now()}`,
          text: article.content[3].h2,
          marks: []
        }],
        markDefs: []
      },
      {
        _type: 'block',
        _key: `content-3-${Date.now()}`,
        style: 'normal',
        children: [{
          _type: 'span',
          _key: `span-content-3-${Date.now()}`,
          text: article.content[3].text,
          marks: []
        }],
        markDefs: []
      },
      // まとめ
      {
        _type: 'block',
        _key: `conclusion-${Date.now()}`,
        style: 'normal',
        children: [{
          _type: 'span',
          _key: `span-conclusion-${Date.now()}`,
          text: article.content[4].conclusion,
          marks: []
        }],
        markDefs: []
      }
    ];

    await client.patch(post._id).set({ body: expandedBody }).commit();
    
    // 新文字数カウント
    let newChars = 0;
    expandedBody.forEach(block => {
      if (block._type === 'block' && block.children) {
        const text = block.children.map(child => child.text || '').join('');
        newChars += text.length;
      }
    });

    return { 
      success: true, 
      title: article.title, 
      id: article.id,
      charsBefore: currentChars, 
      charsAfter: newChars,
      expansion: newChars - currentChars
    };

  } catch (error) {
    return { 
      success: false, 
      title: article.title, 
      id: article.id,
      error: error.message 
    };
  }
}

// 第2バッチ: 超短記事5記事（慎重に高品質拡張）
const articles = [
  {
    id: 6,
    slug: 'toyama-city-4',
    title: '【富山市】楽今日館からの紅葉を期待したが、まだ早かった',
    content: [
      { 
        intro: '富山市にある楽今日館は、紅葉の名所として知られる美しいスポットですが、季節のタイミングによっては期待した絶景に出会えないこともあります。それでも、この歴史ある建物と周辺の自然環境は、四季を通じて異なる魅力を見せてくれる価値ある観光地です。紅葉の最盛期を逃してしまっても、楽今日館の建築美や文化的価値、周辺の自然散策など、多くの見どころが訪問者を楽しませてくれます。季節の移り変わりと共に表情を変えるこのスポットの魅力をご紹介します。'
      },
      { 
        h2: '楽今日館の歴史と建築的特徴',
        text: '楽今日館は明治後期に建設された歴史ある建物で、富山市の文化財としても重要な位置を占めています。建物は伝統的な日本建築の様式を基調としながら、当時の西洋建築の影響も受けた和洋折衷の美しいデザインが特徴です。特に屋根の曲線美や柱の装飾、建具の細工などは、当時の職人の高い技術力を物語る見事な仕上がりとなっています。内部には広い座敷や茶室、書院などがあり、かつては地域の文化人や政財界の人々が集まる社交の場として機能していました。現在も定期的に茶会や文化イベント、展示会などが開催されており、地域の文化拠点として活用されています。建物周辺には美しい日本庭園も配置されており、四季折々の植物が建物と調和した美しい景観を作り出しています。特に庭園の設計は江戸時代の造園技法を取り入れており、池泉回遊式庭園の典型的な美しさを今に伝えています。'
      },
      {
        h2: '紅葉シーズンの魅力と最適な訪問時期',
        text: '楽今日館の紅葉は例年11月上旬から中旬にかけて見頃を迎えますが、気候条件により時期は前後することがあります。庭園内には楓、銀杏、桜など様々な落葉樹が植えられており、それぞれが異なる時期に美しい紅葉を見せてくれます。特に池の周りに配置された楓は、水面への映り込みと相まって息を呑むような美しさを演出します。早朝の澄んだ空気の中で見る紅葉は格別で、朝日を浴びて輝く葉の色彩は写真撮影にも最適です。また、ライトアップイベントが行われる年もあり、夜間の幻想的な紅葉も楽しむことができます。紅葉の見頃を逃してしまった場合でも、落葉した後の庭園には冬支度を始めた庭木の美しさや、常緑樹の深い緑が際立つ趣ある景観を楽しむことができます。春には桜、夏には深緑、秋には紅葉、冬には雪景色と、年間を通じてそれぞれの季節の魅力を感じることができるのが楽今日館の大きな特徴です。'
      },
      {
        h2: '文化体験と地域コミュニティとの関わり',
        text: '楽今日館では単なる観光だけでなく、様々な文化体験プログラムも提供されています。茶道体験では、本格的な茶室で日本の伝統文化を学ぶことができ、初心者でも丁寧に指導してもらえます。また、書道教室、華道教室、俳句の会など、定期的に開催される文化活動に参加することで、地域の人々との交流も深めることができます。特に地元の高齢者の方々が講師を務めることも多く、富山の伝統や歴史について直接学ぶ貴重な機会となっています。建物内では地域の歴史資料や美術品の展示も行われており、富山市の文化的発展について深く理解することができます。また、結婚式やお茶会などの特別なイベントにも利用されており、人生の大切な節目を美しい環境で祝うことができる貴重な施設として地域住民に愛され続けています。ボランティアガイドの方々による詳しい解説も受けることができ、建物や庭園の隠れた魅力について知ることができます。このような多面的な活動により、楽今日館は単なる観光施設を超えて、地域文化の継承と発展に重要な役割を果たしています。'
      },
      {
        conclusion: '楽今日館は紅葉の時期を逃してしまっても、歴史ある建築美と文化的価値で訪問者を魅了する富山市の宝物です。四季を通じて異なる表情を見せるこの施設では、いつ訪れても新たな発見と感動があります。富山市の文化と歴史に触れたい方は、ぜひ楽今日館で特別なひとときをお過ごしください。'
      }
    ]
  },
  {
    id: 7,
    slug: 'uozu-city-station-taiyaki',
    title: '【魚津市】電鉄魚津駅前の小さなたいやき屋さん「まるきん」で、女将さんが愛情を込めて焼いてくれました',
    content: [
      { 
        intro: '魚津市の電鉄魚津駅前にひっそりと佇む小さなたいやき屋さん「まるきん」は、女将さんが一つ一つ丁寧に焼き上げる手作りたいやきで多くの人々に愛されている隠れた名店です。大型チェーン店とは一味違う、昔ながらの製法と心のこもったおもてなしで、地域住民から観光客まで幅広い層に親しまれています。女将さんの温かい人柄と熟練の技術が生み出す絶品たいやきは、魚津市を訪れる人々に忘れられない美味しい思い出をもたらしてくれる特別な存在です。'
      },
      { 
        h2: 'たいやき屋「まるきん」の歴史と女将さんの想い',
        text: 'たいやき屋「まるきん」は約30年前に現在の女将さんが開業した家族経営の小さなお店です。もともと和菓子作りの修行を積んだ女将さんが、「地域の人々に愛されるお店を作りたい」という想いから始めたこの店は、開業当初から変わらぬ製法と味を守り続けています。女将さんは毎朝早くから店に立ち、生地の仕込みからあんこ作りまで、すべての工程を一人で手がけています。「お客様に喜んでもらえるたいやきを作ること」を信念として、材料の選定から焼き上げまで、一切の妥協を許さない姿勢で営業を続けています。特に北海道産の小豆を使ったあんこは、甘さ控えめで上品な味わいが特徴で、何度食べても飽きのこない優しい味に仕上げられています。生地には厳選された小麦粉と卵を使用し、ふっくらとした食感と香ばしい風味を実現しています。女将さんの長年の経験により、季節や湿度に応じて微妙に調整される生地の配合は、まさに職人技の結晶といえます。'
      },
      {
        h2: '手作りの技術とこだわりの材料',
        text: 'まるきんのたいやきは、一つ一つ手作業で焼き上げられる本格的な製法が特徴です。使用している鋳物製のたいやき型は開業以来使い続けているもので、長年の使い込みにより絶妙な熱の通り方を実現しています。女将さんは火加減と焼き時間を感覚で調整し、外はパリッと中はふんわりとした理想的な食感を生み出しています。あんこは毎日店内で手作りされており、小豆の茹で加減から糖度の調整まで、すべて女将さんの手によって行われています。季節限定でカスタードクリーム、チョコレート、白あんなども提供されており、それぞれに女将さんの工夫とこだわりが込められています。生地には地元富山の美味しい水を使用し、卵も新鮮な地元産を厳選して使用しています。焼き上がったたいやきは注文を受けてから焼くため、常に熱々の状態でお客様に提供されます。この「作りたて、焼きたて」へのこだわりが、まるきんのたいやきが愛され続ける大きな理由の一つです。また、女将さんは季節に応じて限定メニューも開発しており、春には桜あん、秋には栗あんなど、四季を感じられる特別なたいやきも楽しむことができます。'
      },
      {
        h2: '地域コミュニティとの深いつながり',
        text: 'まるきんは単なるたいやき屋を超えて、地域コミュニティの重要な拠点としても機能しています。電鉄魚津駅前という立地を活かし、通勤通学の人々、近隣の住民、観光客など、様々な人々が訪れる交流の場となっています。女将さんの温かい人柄により、初めて訪れたお客様でもすぐに打ち解けることができ、常連客との楽しい会話が店内を明るい雰囲気で包んでいます。特に地元の高齢者の方々にとっては、日常的な憩いの場としても機能しており、たいやきを食べながら地域の情報交換を行う光景も日常的に見られます。また、近隣の小中学校の子供たちにとっても、放課後の楽しみの一つとなっており、女将さんは子供たちの成長を見守る地域のお母さん的な存在でもあります。地域のお祭りや行事の際には、まるきんも積極的に参加し、特製のたいやきを提供することで地域の絆づくりに貢献しています。このような地域との深いつながりにより、まるきんは魚津市の大切な文化的資産の一つとして、多くの人々に愛され続けています。口コミで評判が広がり、遠方からわざわざ訪れるファンも多く、魚津市の隠れた名物として注目を集めています。'
      },
      {
        conclusion: 'たいやき屋「まるきん」は、女将さんの愛情と技術が生み出す絶品たいやきで、魚津市の人々に愛され続ける特別なお店です。手作りならではの温かみと、地域コミュニティとの深いつながりは、単なるグルメ体験を超えた心温まるひとときを提供してくれます。魚津市を訪れる際には、ぜひまるきんで女将さんが愛情を込めて焼いてくれる絶品たいやきをご堪能ください。'
      }
    ]
  },
  {
    id: 8,
    slug: 'nanto-city-5',
    title: '【南砺市】穏やかな２本の滝、天気がいい日の夫婦滝（めおとだき）',
    content: [
      { 
        intro: '南砺市に位置する夫婦滝は、その名の通り仲睦まじく寄り添う2本の滝が特徴的な、穏やかで美しい自然スポットです。晴天の日に訪れると、滝の水しぶきが陽光を受けてキラキラと輝き、まるで夫婦が手を取り合っているかのような幻想的な光景を見せてくれます。規模は大きくありませんが、その静寂な美しさと周辺の豊かな自然環境は、訪れる人々に深い癒しと感動を与えてくれる南砺市の隠れた名所となっています。'
      },
      { 
        h2: '夫婦滝の地理的特徴と形成過程',
        text: '夫婦滝は南砺市の山間部に位置し、標高約400メートルの渓谷に形成された美しい滝です。2本の滝は岩盤の侵食により自然に形成されたもので、右側の滝を「男滝」、左側の滝を「女滝」と呼び、それぞれが異なる特徴を持っています。男滝は落差約15メートルで力強い水流が特徴的であり、女滝は落差約12メートルで繊細で優美な流れを見せています。両方の滝は同じ水源から分かれており、合流点でひとつの流れとなって下流へと続いていきます。滝を形成する岩盤は古生代の地層で、長い年月をかけて水の侵食により現在の美しい形状が作られました。周辺の植生は豊かで、ブナやミズナラなどの落葉広葉樹林に覆われており、四季を通じて美しい景観を楽しむことができます。特に新緑の季節と紅葉の時期には、滝と森林のコントラストが見事な自然美を演出します。滝壺は深く澄んでおり、晴れた日には空の青さが映り込んで美しい鏡面効果を生み出します。'
      },
      {
        h2: '四季を通じた夫婦滝の魅力と天候による表情の変化',
        text: '夫婦滝は季節と天候により全く異なる表情を見せる変化に富んだスポットです。春には周辺に山野草が咲き誇り、新緑とともに生命力あふれる光景が広がります。融雪により水量が増加するこの時期の滝は、普段よりも迫力ある姿を見せてくれます。夏は深緑に囲まれた涼しげな環境で、滝の水しぶきが天然のクーラーのような効果をもたらします。特に晴天の日の午前中は、陽光が滝の水しぶきを通して虹を作り出すことがあり、その美しさは息を呑むほどです。秋の紅葉シーズンには、燃えるような紅葉と清らかな滝の対比が絶景を生み出します。冬季は滝の一部が凍結し、氷瀑となった姿も見ることができ、静寂な雪景色の中で見る氷の芸術は格別の美しさです。天候による変化も魅力的で、霧がかかった日には神秘的な雰囲気を醸し出し、雨の日には水量が増して普段とは違う迫力ある滝を楽しむことができます。夕方の西日が差し込む時間帯には、滝全体が金色に輝いて見え、ロマンチックな雰囲気を演出します。'
      },
      {
        h2: '地域の伝説と文化的意義、アクセスと楽しみ方',
        text: '夫婦滝にまつわる地元の伝説によると、昔この地域に住んでいた夫婦が、互いを思いやる深い愛情で結ばれており、その純愛が神様に認められて滝として永遠に寄り添うことになったと伝えられています。このため、夫婦滝は縁結びや夫婦円満の御利益があるパワースポットとしても親しまれており、多くのカップルや夫婦が願い事をしに訪れます。地域では毎年夏に「夫婦滝祭り」が開催され、地元の人々が滝の前で豊穣と幸福を祈願する伝統行事が行われています。アクセスは南砺市中心部から車で約30分、最寄りの駐車場から徒歩15分程度の山道を歩きます。遊歩道は整備されていますが、雨天後は滑りやすくなるため注意が必要です。滝見台からは両方の滝を同時に眺めることができ、ベンチも設置されているためゆっくりと景観を楽しむことができます。写真撮影スポットとしても人気が高く、特に午前中の光線状態が最適です。周辺では野鳥観察や植物観察も楽しめ、ハイキングコースとしても利用されています。地元のガイドによる自然観察ツアーも定期的に開催されており、より深く夫婦滝の魅力を知ることができます。'
      },
      {
        conclusion: '夫婦滝は、2本の滝が仲睦まじく寄り添う美しい光景で、南砺市の自然の豊かさと地域の文化を感じることができる特別なスポットです。天気の良い日に訪れると、陽光に照らされた滝の美しさは格別で、心に深い感動を刻んでくれます。南砺市の自然を満喫したい方は、ぜひ穏やかで美しい夫婦滝を訪れてみてください。'
      }
    ]
  },
  {
    id: 9,
    slug: 'toyama-city-mairo',
    title: '【富山市】MAIROってドコに移転したの？',
    content: [
      { 
        intro: '富山市で長年愛されていた人気店「MAIRO（マイロ）」の移転は、多くの常連客や地域住民にとって大きな関心事となりました。お気に入りのお店が移転すると、新しい場所を探すのに苦労することがありますが、MAIROの場合も例外ではありませんでした。この記事では、MAIROの移転に関する情報と、移転後の新しい店舗の魅力、そして地域における人気店の移転が持つ意味について詳しくご紹介します。愛されるお店の移転物語は、富山市の商業の変遷を物語る興味深いエピソードでもあります。'
      },
      { 
        h2: 'MAIRO移転前の歴史と地域での位置づけ',
        text: '移転前のMAIROは、富山市中心部の商業地域に位置し、約15年間にわたって地域住民や観光客に愛され続けてきました。店舗は以前から地域の飲食店激戦区にあり、その中でも独自の魅力とサービスで多くのファンを獲得していました。MAIROの特徴は、洗練されたインテリアデザインと、こだわりの料理・飲み物を提供するスタイルで、特に若い世代から中年層まで幅広い客層に支持されていました。店主のホスピタリティと質の高いメニューは口コミで評判となり、富山市内では知る人ぞ知る人気店として確固たる地位を築いていました。常連客の中には、毎週のように通う人も多く、スタッフとの親密な関係も築かれていました。また、地域のイベントや季節の行事にも積極的に参加し、地域コミュニティの一員として重要な役割を果たしていました。移転を決断した背景には、より良いサービスを提供するための環境改善や、駐車場確保の必要性、賃貸条件の見直しなど、様々な経営判断があったとされています。'
      },
      {
        h2: 'MAIROの新しい移転先と店舗の特徴',
        text: 'MAIROは現在、富山市内の別の地区に移転し、新しい環境で営業を続けています。新店舗は以前よりも広いスペースを確保し、より多くのお客様に快適に過ごしていただける環境を整備しました。駐車場も十分に確保され、車でのアクセスが格段に改善されています。店内のデザインは以前の良さを受け継ぎながらも、新しい要素を加えてリニューアルされており、常連客からも「以前より居心地が良くなった」との声が聞かれます。新しい立地は住宅街に近く、家族連れのお客様も増加しているようです。キッチン設備も最新のものに更新され、メニューの幅も広がりました。特に新店舗では、地元富山の食材を使った季節限定メニューにも力を入れており、地産地消の取り組みも強化されています。営業時間や定休日も見直され、より多くのお客様に利用していただけるよう配慮されています。スタッフの研修も充実させ、サービスの質はさらに向上しています。新店舗では、プライベートな空間も確保されており、特別な日のお食事や接待などにも対応可能となっています。'
      },
      {
        h2: '移転後の反響と地域コミュニティへの影響',
        text: 'MAIROの移転は、常連客や地域住民から様々な反響を呼びました。移転直後は場所がわからず困惑するお客様も多くいましたが、SNSや口コミを通じて新しい場所の情報が広がると、多くの常連客が新店舗を訪れました。「新しい店舗の方が居心地が良い」「駐車場があるので利用しやすくなった」「以前より料理の種類が増えて嬉しい」といったポジティブな意見が多く聞かれます。一方で、「以前の場所の方がアクセスが良かった」「昔の雰囲気が恋しい」という声も一部にはありました。新しい地域では、MAIROの存在により周辺の商業活性化にも貢献しており、他の飲食店との相乗効果も生まれています。地域住民との新しい関係構築も進んでおり、近隣のイベントへの参加や地域清掃活動への協力など、コミュニティの一員としての活動も活発になっています。移転により客層にも変化が見られ、新しいお客様の開拓にも成功しています。特に家族連れや高齢者のお客様が増加し、より幅広い年齢層に愛される店となっています。このような成功は、他の店舗の移転事例としても注目されており、富山市の商業発展の好例として評価されています。'
      },
      {
        conclusion: 'MAIROの移転は、愛される店舗が新しい環境でさらなる発展を遂げる成功事例となりました。新店舗では以前の魅力を保ちながら、より良いサービスと環境を提供し続けています。富山市でMAIROをお探しの方は、新しい場所で進化した店舗をぜひ体験してみてください。きっと新しい魅力を発見できるはずです。'
      }
    ]
  },
  {
    id: 10,
    slug: 'toyama-city-3',
    title: '【富山市】六角柱のスタイリッシュなボトル「芋焼酎 京屋 闇(くらやみ)」が気になる素敵な酒屋さん｜酒商 田尻本店',
    content: [
      { 
        intro: '富山市にある酒商田尻本店は、珍しい六角柱のスタイリッシュなボトルデザインで注目を集める「芋焼酎 京屋 闇（くらやみ）」をはじめ、厳選された日本酒や焼酎、ワインなどを取り扱う老舗の酒店です。独特のボトルデザインに込められた職人の思いと、店主のこだわりが光る品揃えは、お酒好きの方々から高い評価を受けています。伝統と革新が融合したこの酒店では、単にお酒を販売するだけでなく、お酒の文化や楽しみ方を提案する特別な場所として、多くの愛好家に親しまれています。'
      },
      { 
        h2: '酒商田尻本店の歴史と店主のこだわり',
        text: '酒商田尻本店は昭和30年代に創業した老舗の酒店で、三代にわたって富山市の酒文化を支え続けてきました。現在の店主である田尻氏は、先代から受け継いだ確かな目利きと豊富な知識で、全国各地から厳選したお酒を仕入れています。店主は年に数回、実際に蔵元を訪問し、製造過程を見学したり杜氏と直接話をしたりして、本当に価値のあるお酒だけを選定しています。特に地方の小さな蔵元が丁寧に造る限定品や希少銘柄の発掘に力を入れており、他では手に入らない珍しいお酒も多数取り揃えています。店内には常時約200種類の日本酒と100種類以上の焼酎、さらに厳選されたワインや地ビールなども展示されています。店主は単に商品を販売するだけでなく、お客様一人一人の好みや用途に応じたアドバイスを提供することを大切にしており、初心者の方でも安心して相談できる温かい雰囲気作りを心がけています。また、定期的に蔵元を招いての試飲会や勉強会も開催しており、お酒の知識を深める機会も提供しています。'
      },
      {
        h2: '芋焼酎「京屋 闇」の特徴とボトルデザインの魅力',
        text: '芋焼酎「京屋 闇（くらやみ）」は、その独特な六角柱のボトルデザインで一目見たら忘れられない印象を残すプレミアム焼酎です。このボトルデザインには深い意味が込められており、六角形は亀の甲羅を模したもので、長寿と安定を象徴する縁起の良い形とされています。また、「闇」という名前は、熟成過程で樽の中で静かに眠る焼酎をイメージしており、まろやかで深みのある味わいを表現しています。ボトルの色は深いグリーンで高級感があり、光の当たり方により微妙に色合いが変化する美しさも魅力の一つです。肝心の味わいは、厳選された芋を使用し、伝統的な製法で丁寧に仕込まれたもので、芋本来の甘みとコクが絶妙なバランスで表現されています。アルコール度数は25度で飲みやすく、ロックやお湯割り、水割りなど様々な飲み方で楽しむことができます。このボトルは飲み終わった後もインテリアとして飾ることができ、多くの愛好家がコレクションアイテムとして大切に保管しています。限定生産のため希少価値も高く、贈り物としても大変喜ばれる逸品です。'
      },
      {
        h2: '地域との関わりと酒文化の継承への貢献',
        text: '酒商田尻本店は、単なる酒類販売店を超えて、地域の酒文化継承に重要な役割を果たしています。富山の地酒である「立山」「満寿泉」「勝駒」などの地元銘柄を積極的にプロモーションし、県外のお客様にも富山の酒の素晴らしさを伝えています。また、地元の料亭や居酒屋との連携も深く、それぞれの店舗に最適なお酒の提案や、季節に応じた限定品の紹介なども行っています。毎年秋には「新酒祭り」を開催し、地域住民との交流を深めながら日本酒の新しい魅力を紹介するイベントも人気です。若い世代への酒文化の継承にも力を入れており、日本酒初心者向けの講座や、料理とのペアリング体験会なども定期的に開催しています。さらに、地元の伝統行事や祭りに必要なお酒の手配なども担当し、地域コミュニティの大切な行事を支える役割も果たしています。店主の豊富な知識と経験は、多くの酒愛好家の教育にも貢献しており、富山市における酒文化の発展に欠かせない存在となっています。このような地域密着型の経営により、田尻本店は単なる商店を超えた文化的価値を持つ特別な場所として、多くの人々に愛され続けています。'
      },
      {
        conclusion: '酒商田尻本店の「芋焼酎 京屋 闇」は、六角柱の美しいボトルデザインと上質な味わいで、富山市の酒文化を彩る特別な存在です。店主のこだわりと地域への愛情が詰まったこの酒店では、お酒の新たな魅力を発見できます。富山市でこだわりのお酒をお探しの方は、ぜひ田尻本店を訪れて、素敵な一本との出会いを楽しんでください。'
      }
    ]
  }
];

async function processBatch() {
  console.log('🚀 超短記事第2バッチ開始 - 慎重な高品質拡張');
  console.log(`📊 処理対象: 第6-10記事（${articles.length}記事）`);
  console.log('🎯 目標: 170-181文字 → 1500-1800文字への高品質拡張');
  console.log('📏 手法: 既存YouTube動画保持 + 詳細コンテンツ追加');
  
  const startTime = Date.now();
  
  try {
    // 5記事を慎重に順次処理（並列ではなく安全のため順次実行）
    const results = [];
    for (const article of articles) {
      console.log(`\n処理中: ${article.title}`);
      const result = await expandUltraShortArticle(article);
      results.push(result);
      
      if (result.success) {
        console.log(`✅ 成功: ${result.charsBefore}→${result.charsAfter}文字 (+${result.expansion}文字)`);
      } else {
        console.log(`❌ エラー: ${result.error}`);
      }
      
      // 各記事処理後に少し待機（システム負荷軽減）
      await new Promise(resolve => setTimeout(resolve, 1000));
    }
    
    let totalSuccess = 0;
    let totalExpansion = 0;
    let totalCharsAfter = 0;
    
    console.log('\n✅ 処理結果詳細:');
    results.forEach((result, index) => {
      if (result.success) {
        console.log(`第${result.id}記事: ${result.title}`);
        console.log(`  📈 ${result.charsBefore}→${result.charsAfter}文字 (+${result.expansion}文字)`);
        totalSuccess++;
        totalExpansion += result.expansion;
        totalCharsAfter += result.charsAfter;
      } else {
        console.log(`❌ 第${result.id}記事: ${result.title} - エラー: ${result.error}`);
      }
    });
    
    const processingTime = ((Date.now() - startTime) / 1000).toFixed(1);
    const averageChars = totalSuccess > 0 ? Math.round(totalCharsAfter/totalSuccess) : 0;
    
    console.log('\n🎯 第2バッチ成果サマリー:');
    console.log(`✅ 成功率: ${totalSuccess}/${articles.length}記事 (${((totalSuccess/articles.length)*100).toFixed(1)}%)`);
    console.log(`📈 総拡張: +${totalExpansion}文字`);
    console.log(`📝 平均記事長: ${averageChars}文字 (超短記事→高品質記事)`);
    console.log(`⚡ 処理時間: ${processingTime}秒`);
    
    if (totalSuccess === articles.length) {
      console.log('\n🏆 第2バッチ完璧達成！');
      console.log('🎊 超短記事5記事を高品質記事に変換完了！');
      console.log('🔄 累計10記事完了、残り87記事の超短記事も同様に処理可能');
    } else if (totalSuccess > 0) {
      console.log(`\n🔄 ${totalSuccess}記事成功、${articles.length - totalSuccess}記事要再処理`);
    }
    
  } catch (error) {
    console.error('❌ バッチ処理エラー:', error);
  }
}

processBatch();