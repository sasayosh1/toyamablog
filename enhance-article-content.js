import { createClient } from '@sanity/client';

const client = createClient({
  projectId: 'aoxze287',
  dataset: 'production',
  apiVersion: '2024-01-01',
  useCdn: false,
  token: 'skkTjwpdrsjKKpaDxKVShzCSI7GMWE1r5TQdwl0b7LTylVPoAxzBg0oPqhtUQyfPjyvtZW2mu6nfUMNUJ'
});

// æ‹¡å¼µã•ã‚ŒãŸè¨˜äº‹å†…å®¹ã‚’ç”Ÿæˆã™ã‚‹é–¢æ•°ï¼ˆ1000æ–‡å­—ç›®æ¨™ï¼‰
function generateEnhancedArticleContent(extractedData) {
  const { location, stores, subtitle, keywords, originalTitle } = extractedData;
  
  let content = '';
  
  // å°å…¥éƒ¨åˆ†ï¼ˆã‚ˆã‚Šè©³ç´°ã«ï¼‰
  content += `${location}ã‚’è¨ªã‚Œã‚‹çš†æ§˜ã«ã¨ã£ã¦ã€ãã£ã¨ç‰¹åˆ¥ãªä½“é¨“ã¨ãªã‚‹ã‚¹ãƒãƒƒãƒˆã‚’ã”ç´¹ä»‹ã•ã›ã¦ã„ãŸã ãã¾ã™ã€‚`;
  
  if (stores.length > 0) {
    content += `ä»Šå›ã¯ã€Œ${stores[0]}ã€ã«ã¤ã„ã¦ã€ãã®é­…åŠ›ã‚’ä½™ã™ã“ã¨ãªããŠä¼ãˆã—ã¦ã„ããŸã„ã¨æ€ã„ã¾ã™ã€‚\n\n`;
  } else {
    content += `åœ°åŸŸã®é­…åŠ›ã‚’å­˜åˆ†ã«å‘³ã‚ãˆã‚‹ã€ã¨ã£ã¦ãŠãã®å ´æ‰€ã«ã¤ã„ã¦ã”ç´¹ä»‹ã„ãŸã—ã¾ã™ã€‚\n\n`;
  }
  
  // åœ°åŸŸã®èƒŒæ™¯ã¨ç‰¹è‰²
  content += `## ${location}ã®é­…åŠ›ã¨ç‰¹è‰²\n\n`;
  content += `${location}ã¯å¯Œå±±çœŒå†…ã§ã‚‚ç‰¹ã«é­…åŠ›çš„ãªã‚¨ãƒªã‚¢ã¨ã—ã¦çŸ¥ã‚‰ã‚Œã¦ãŠã‚Šã€é•·ã„æ­´å²ã¨è±Šã‹ãªæ–‡åŒ–ã‚’èª‡ã£ã¦ã„ã¾ã™ã€‚ç«‹å±±é€£å³°ã‚’æœ›ã‚€ç¾ã—ã„æ™¯è¦³ã¨ã€å››å­£æŠ˜ã€…ã®è‡ªç„¶ã®å¤‰åŒ–ãŒæ¥½ã—ã‚ã‚‹ã“ã®åœ°åŸŸã§ã¯ã€è¨ªã‚Œã‚‹åº¦ã«æ–°ã—ã„ç™ºè¦‹ãŒã‚ã‚Šã¾ã™ã€‚åœ°å…ƒã®æ–¹ã€…ã®æ¸©ã‹ã„ãŠã‚‚ã¦ãªã—ã®å¿ƒã¨ã€ä»£ã€…å—ã‘ç¶™ãŒã‚Œã¦ããŸä¼çµ±ãŒã€ç¾ä»£ã®ç”Ÿæ´»ã¨è¦‹äº‹ã«èª¿å’Œã—ã¦ã„ã‚‹ã®ã‚‚ã€ã“ã®åœ°åŸŸãªã‚‰ã§ã¯ã®ç‰¹å¾´ã¨ã„ãˆã‚‹ã§ã—ã‚‡ã†ã€‚\n\n`;
  
  // å…·ä½“çš„ãªåº—èˆ—ã‚„æ–½è¨­ã«ã¤ã„ã¦ã®è©³ç´°
  if (stores.length > 0) {
    content += `## ${stores[0]}ã®é­…åŠ›\n\n`;
    
    if (keywords.includes('ã‚±ãƒ¼ã‚­') || keywords.includes('ã‚¹ã‚¤ãƒ¼ãƒ„')) {
      content += `ã“ã¡ã‚‰ã®ãŠåº—ã§ã¯ã€ç†Ÿç·´ã®è·äººãŒå¿ƒã‚’è¾¼ã‚ã¦ä½œã‚‹çµ¶å“ã‚¹ã‚¤ãƒ¼ãƒ„ã‚’å‘³ã‚ã†ã“ã¨ãŒã§ãã¾ã™ã€‚å³é¸ã•ã‚ŒãŸä¸Šè³ªãªææ–™ã‚’ä½¿ç”¨ã—ã€ä¼çµ±çš„ãªè£½æ³•ã¨é©æ–°çš„ãªã‚¢ã‚¤ãƒ‡ã‚¢ã‚’å·§ã¿ã«çµ„ã¿åˆã‚ã›ã¦ä½œã‚‰ã‚Œã‚‹ãŠè“å­ã¯ã€è¦‹ãŸç›®ã®ç¾ã—ã•ã¯ã‚‚ã¡ã‚ã‚“ã€ä¸€å£é£Ÿã¹ã‚Œã°ãã®ç¹Šç´°ãªå‘³ã‚ã„ã®é•ã„ã‚’å®Ÿæ„Ÿã—ã¦ã„ãŸã ã‘ã‚‹ã¯ãšã§ã™ã€‚å­£ç¯€ã”ã¨ã«å¤‰ã‚ã‚‹é™å®šãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚‚äººæ°—ã§ã€ä½•åº¦è¨ªã‚Œã¦ã‚‚æ–°ã—ã„ç¾å‘³ã—ã•ã«å‡ºä¼šãˆã‚‹ã®ã‚‚é­…åŠ›ã®ä¸€ã¤ã§ã™ã€‚`;
    } else if (keywords.includes('ãƒ‘ãƒ³')) {
      content += `æ¯æœæ—©ãã‹ã‚‰ç„¼ããŸã¦ã®ãƒ‘ãƒ³ãŒåº—å†…ã«ä¸¦ã¶ã“ã¡ã‚‰ã®ãƒ™ãƒ¼ã‚«ãƒªãƒ¼ã§ã¯ã€å°éº¦ã®é¦™ã°ã—ã„é¦™ã‚ŠãŒåº—å†…ã„ã£ã±ã„ã«åºƒãŒã‚Šã€è¨ªã‚Œã‚‹äººã€…ã‚’æ¸©ã‹ãè¿ãˆã¦ãã‚Œã¾ã™ã€‚é•·å¹´åŸ¹ã‚ã‚ŒãŸè·äººã®ç¢ºã‹ãªæŠ€è¡“ã¨ã€ç¾å‘³ã—ã„ãƒ‘ãƒ³ã¸ã®æƒ…ç†±ãŒè¾¼ã‚ã‚‰ã‚ŒãŸä¸€ã¤ä¸€ã¤ã®å•†å“ã¯ã€åœ°å…ƒã®æ–¹ã€…ã«ã‚‚é•·ãæ„›ã•ã‚Œç¶šã‘ã¦ã„ã¾ã™ã€‚ç‰¹ã«äººæ°—ã®å•†å“ã¯æ—©ã„æ™‚é–“ã«å£²ã‚Šåˆ‡ã‚Œã¦ã—ã¾ã†ã“ã¨ã‚‚ã‚ã‚‹ãŸã‚ã€ãŠç›®å½“ã¦ã®å•†å“ãŒã‚ã‚‹å ´åˆã¯æ—©ã‚ã®æ¥åº—ã‚’ãŠã™ã™ã‚ã—ã¾ã™ã€‚`;
    } else if (keywords.includes('ãŸã„ç„¼ã') || keywords.includes('ã©ã‚‰ç„¼ã')) {
      content += `æ˜”ãªãŒã‚‰ã®ä¼çµ±çš„ãªè£½æ³•ã§ä¸å¯§ã«ä½œã‚‰ã‚Œã‚‹å’Œè“å­ã¯ã€ã©ã“ã‹æ‡ã‹ã—ãã€å¿ƒæ¸©ã¾ã‚‹å‘³ã‚ã„ãŒç‰¹å¾´ã§ã™ã€‚ä¸€ã¤ä¸€ã¤æ‰‹ä½œæ¥­ã§å¿ƒã‚’è¾¼ã‚ã¦ä½œã‚‰ã‚Œã¦ãŠã‚Šã€ç´ ææœ¬æ¥ã®è‡ªç„¶ãªç”˜ã•ã‚’æ´»ã‹ã—ãŸå„ªã—ã„å‘³ã‚ã„ãŒæ¥½ã—ã‚ã¾ã™ã€‚å¿™ã—ã„æ—¥å¸¸ã‚’å¿˜ã‚Œã¦ã€ã‚†ã£ãã‚Šã¨ã—ãŸæ™‚é–“ã‚’éã”ã—ãªãŒã‚‰å‘³ã‚ã£ã¦ã„ãŸã ã‘ã‚Œã°ã€ãã£ã¨å¿ƒãŒç™’ã•ã‚Œã‚‹ã“ã¨ã§ã—ã‚‡ã†ã€‚`;
    } else if (keywords.includes('ã‚Šã‚“ã”é£´')) {
      content += `æ–°é®®ãªã‚Šã‚“ã”ã‚’ä½¿ç”¨ã—ãŸç‰¹è£½ã®ã‚Šã‚“ã”é£´ã¯ã€ãƒ‘ãƒªãƒƒã¨ã—ãŸé£Ÿæ„Ÿã¨ç¨‹ã‚ˆã„ç”˜ã•ãŒçµ¶å¦™ãªãƒãƒ©ãƒ³ã‚¹ã‚’ä¿ã£ã¦ã„ã¾ã™ã€‚è¦‹ãŸç›®ã«ã‚‚ç¾ã—ãã€SNSæ˜ ãˆã™ã‚‹å•†å“ã¨ã—ã¦è‹¥ã„ä¸–ä»£ã‹ã‚‰ã‚‚äººæ°—ã‚’é›†ã‚ã¦ã„ã¾ã™ã€‚è·äººãŒä¸€ã¤ä¸€ã¤ä¸å¯§ã«ä»•ä¸Šã’ã‚‹æ‰‹ä½œã‚Šã®æ¸©ã‹ã•ã‚’æ„Ÿã˜ã‚‰ã‚Œã‚‹é€¸å“ã§ã™ã€‚`;
    } else {
      content += `ã“ã®å ´æ‰€ã§ã¯ã€${location}ãªã‚‰ã§ã¯ã®ç‰¹è‰²ã‚ã‚‹ä½“é¨“ã‚’ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚åœ°åŸŸã®æ–‡åŒ–ã‚„æ­´å²ã®æ·±ã•ã‚’è‚Œã§æ„Ÿã˜ãªãŒã‚‰ã€ã‚†ã£ãã‚Šã¨ã—ãŸè´…æ²¢ãªæ™‚é–“ã‚’éã”ã™ã“ã¨ãŒã§ãã‚‹ã§ã—ã‚‡ã†ã€‚`;
    }
    
    content += `\n\n`;
  }
  
  // å‘¨è¾ºç’°å¢ƒã¨ã‚¢ã‚¯ã‚»ã‚¹æƒ…å ±
  content += `## å‘¨è¾ºç’°å¢ƒã¨æ¥½ã—ã¿æ–¹\n\n`;
  content += `${location}ã‚’è¨ªã‚Œã‚‹éš›ã¯ã€ãƒ¡ã‚¤ãƒ³ã®ç›®çš„åœ°ã ã‘ã§ãªãã€å‘¨è¾ºã‚¨ãƒªã‚¢ã‚‚åˆã‚ã›ã¦æ•£ç­–ã™ã‚‹ã“ã¨ã‚’å¼·ããŠã™ã™ã‚ã„ãŸã—ã¾ã™ã€‚å¾’æ­©åœå†…ã«ã¯ä»–ã«ã‚‚é­…åŠ›çš„ãªã‚¹ãƒãƒƒãƒˆãŒç‚¹åœ¨ã—ã¦ãŠã‚Šã€ãã‚Œãã‚Œã®å­£ç¯€ã«ã‚ˆã£ã¦å…¨ãç•°ãªã‚‹è¡¨æƒ…ã‚’è¦‹ã›ã¦ãã‚Œã‚‹ãŸã‚ã€ä½•åº¦è¨ªã‚Œã¦ã‚‚æ–°ã—ã„ç™ºè¦‹ã¨æ„Ÿå‹•ãŒã‚ã‚‹ã“ã¨ã§ã—ã‚‡ã†ã€‚ç‰¹ã«åœ°å…ƒã®æ–¹ã€…ãŒãŠã™ã™ã‚ã™ã‚‹éš ã‚ŒãŸã‚¹ãƒãƒƒãƒˆã‚’æ¢ã—ã¦ã¿ã‚‹ã®ã‚‚ã€æ—…ã®é†é†å‘³ã®ä¸€ã¤ã§ã™ã€‚\n\n`;
  
  if (keywords.includes('ç¥­ã‚Š') || keywords.includes('èŠ±ç«')) {
    content += `ç‰¹ã«ãŠç¥­ã‚Šã‚„èŠ±ç«å¤§ä¼šãªã©ã®ã‚¤ãƒ™ãƒ³ãƒˆé–‹å‚¬æ™‚æœŸã«ã¯ã€åœ°åŸŸå…¨ä½“ãŒæ´»æ°—ã«æº€ã¡æº¢ã‚Œã€æ™®æ®µã¨ã¯é•ã£ãŸç‰¹åˆ¥ãªé›°å›²æ°—ã‚’æ¥½ã—ã‚€ã“ã¨ãŒã§ãã¾ã™ã€‚åœ°å…ƒã®ä¼çµ±æ–‡åŒ–ã‚„ç¿’æ…£ã‚’ç›´æ¥è‚Œã§æ„Ÿã˜ã‚‹ã“ã¨ãŒã§ãã‚‹è²´é‡ãªæ©Ÿä¼šã¨ãªã‚Šã€ãã£ã¨å¿˜ã‚Œã‚‰ã‚Œãªã„æ€ã„å‡ºã¨ãªã‚‹ã“ã¨ã§ã—ã‚‡ã†ã€‚`;
  } else if (keywords.includes('æ¡œ') || keywords.includes('ç´…è‘‰')) {
    content += `è‡ªç„¶ã®ç¾ã—ã•ã‚’å­˜åˆ†ã«æ¥½ã—ã‚€ãªã‚‰ã€å­£ç¯€ã®ç§»ã‚ã„ã¨ã¨ã‚‚ã«åŠ‡çš„ã«å¤‰åŒ–ã™ã‚‹é¢¨æ™¯ã«ãœã²æ³¨ç›®ã—ã¦ãã ã•ã„ã€‚ç‰¹ã«æ˜¥ã®æ¡œãŒå’²ãèª‡ã‚‹æ™‚æœŸã‚„ã€ç§‹ã®ç´…è‘‰ãŒå±±ã€…ã‚’å½©ã‚‹æ™‚æœŸã¯ã€å¤šãã®è¦³å…‰å®¢ã‚„å†™çœŸæ„›å¥½å®¶ãŒè¨ªã‚Œã‚‹äººæ°—ã®ã‚·ãƒ¼ã‚ºãƒ³ã§ã™ã€‚`;
  } else {
    content += `åœ°å…ƒã®æ–¹ã€…ã¨ã®ä½•æ°—ãªã„äº¤æµã‚‚ã€æ—…ã®å¤§ããªé†é†å‘³ã®ä¸€ã¤ã§ã™ã€‚æ¸©ã‹ã„äººæŸ„ã«è§¦ã‚Œã€åœ°åŸŸã®ç”Ÿæ´»ã‚„æ–‡åŒ–ã«ã¤ã„ã¦æ•™ãˆã¦ã„ãŸã ãã“ã¨ã§ã€ã‚ˆã‚Šæ·±ãã“ã®åœŸåœ°ã®çœŸã®é­…åŠ›ã‚’ç†è§£ã—ã€å¿ƒã«æ®‹ã‚‹ä½“é¨“ã‚’ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã§ã—ã‚‡ã†ã€‚`;
  }
  
  content += `\n\n`;
  
  // è¨ªå•ã®ã‚³ãƒ„ã¨ãƒãƒŠãƒ¼
  content += `## è¨ªå•æ™‚ã®ãƒã‚¤ãƒ³ãƒˆ\n\n`;
  content += `${location}ã‚’è¨ªã‚Œã‚‹éš›ã¯ã€åœ°åŸŸã®æ–‡åŒ–ã‚„ç¿’æ…£ã‚’å°Šé‡ã—ã€ãƒãƒŠãƒ¼ã‚’å®ˆã£ã¦æ¥½ã—ã„æ™‚é–“ã‚’éã”ã—ã¦ã„ãŸã ã‘ã‚Œã°ã¨æ€ã„ã¾ã™ã€‚ã¾ãŸã€æ··é›‘ã™ã‚‹æ™‚é–“å¸¯ã‚’é¿ã‘ã¦ã€ã‚†ã£ãã‚Šã¨è½ã¡ç€ã„ã¦æ¥½ã—ã‚ã‚‹æ™‚é–“ã‚’é¸ã¶ã“ã¨ã§ã€ã‚ˆã‚Šå……å®Ÿã—ãŸä½“é¨“ãŒã§ãã‚‹ã§ã—ã‚‡ã†ã€‚åœ°å…ƒã®æ–¹ã€…ã«ã¨ã£ã¦ã‚‚å¤§åˆ‡ãªå ´æ‰€ã§ã™ã®ã§ã€ãŠäº’ã„ã«æ°—æŒã¡ã‚ˆãéã”ã›ã‚‹ã‚ˆã†å¿ƒãŒã‘ã‚‹ã“ã¨ãŒå¤§åˆ‡ã§ã™ã€‚\n\n`;
  
  // ã¾ã¨ã‚
  content += `## ã¾ã¨ã‚\n\n`;
  content += `${location}ã§ã®ã²ã¨ã¨ãã¯ã€ãã£ã¨çš†æ§˜ã«ã¨ã£ã¦ç‰¹åˆ¥ã§å¿ƒã«æ®‹ã‚‹æ€ã„å‡ºã¨ãªã‚‹ã“ã¨ã§ã—ã‚‡ã†ã€‚`;
  
  if (stores.length > 0) {
    content += `${stores[0]}ã‚’ã¯ã˜ã‚ã¨ã™ã‚‹åœ°åŸŸã®é­…åŠ›çš„ãªã‚¹ãƒãƒƒãƒˆã‚’å·¡ã‚ŠãªãŒã‚‰ã€`;
  }
  
  content += `å¯Œå±±ã®å¥¥æ·±ã„é­…åŠ›ã¨æ¸©ã‹ã„äººæƒ…ã‚’å­˜åˆ†ã«å‘³ã‚ã£ã¦ã„ãŸã ã‘ã‚Œã°ã¨æ€ã„ã¾ã™ã€‚å››å­£ã‚’é€šã˜ã¦ç•°ãªã‚‹è¡¨æƒ…ã‚’è¦‹ã›ã¦ãã‚Œã‚‹ã“ã®åœ°åŸŸã¯ã€æ¬¡å›ã®${location}è¨ªå•æ™‚ã«ã‚‚ã€ã¾ãŸæ–°ãŸãªç™ºè¦‹ã¨æ„Ÿå‹•ãŒå¾…ã£ã¦ã„ã‚‹ã“ã¨ã¨æ€ã„ã¾ã™ã€‚ãœã²æ™‚é–“ã«ä½™è£•ã‚’æŒã£ã¦ã€ã‚†ã£ãã‚Šã¨ã—ãŸç™’ã—ã®æ™‚é–“ã‚’ãŠéã”ã—ãã ã•ã„ã€‚`;
  
  return content;
}

// ã‚¿ã‚¤ãƒˆãƒ«ã‹ã‚‰ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’æŠ½å‡ºã™ã‚‹é–¢æ•°ï¼ˆå†åˆ©ç”¨ï¼‰
function extractKeywordsFromTitle(title) {
  const locationMatch = title.match(/ã€([^ã€‘]+)ã€‘/);
  const location = locationMatch ? locationMatch[1] : '';
  
  const storeMatches = title.match(/ã€Œ([^ã€]+)ã€/g);
  const stores = storeMatches ? storeMatches.map(match => match.replace(/[ã€Œã€]/g, '')) : [];
  
  const subtitleMatch = title.match(/ï½œ(.+)$/);
  const subtitle = subtitleMatch ? subtitleMatch[1] : '';
  
  const keywords = [];
  
  const foodKeywords = ['ã‚±ãƒ¼ã‚­', 'ãƒ‘ãƒ³', 'ã©ã‚‰ç„¼ã', 'ãŸã„ç„¼ã', 'ã‚Šã‚“ã”é£´', 'ã‚«ãƒ¬ãƒ¼ãƒ‘ãƒ³', 'ãƒ©ãƒ¼ãƒ¡ãƒ³', 'ã‚¹ã‚¤ãƒ¼ãƒ„', 'å’Œè“å­'];
  foodKeywords.forEach(keyword => {
    if (title.includes(keyword)) {
      keywords.push(keyword);
    }
  });
  
  const tourismKeywords = ['ç¥ç¤¾', 'å¯º', 'å…¬åœ’', 'æ¸©æ³‰', 'åšç‰©é¤¨', 'æ°´æ—é¤¨', 'ç¥­ã‚Š', 'èŠ±ç«', 'æ¡œ', 'ç´…è‘‰', 'ã‚¤ãƒ«ãƒŸãƒãƒ¼ã‚·ãƒ§ãƒ³'];
  tourismKeywords.forEach(keyword => {
    if (title.includes(keyword)) {
      keywords.push(keyword);
    }
  });
  
  const activityKeywords = ['æ•£æ­©', 'è¦‹å­¦', 'å·¥å ´è¦‹å­¦', 'ã¾ã¤ã‚Š', 'ãƒ•ã‚§ã‚¹ãƒ†ã‚£ãƒãƒ«', 'ãƒ©ã‚¤ãƒˆã‚¢ãƒƒãƒ—'];
  activityKeywords.forEach(keyword => {
    if (title.includes(keyword)) {
      keywords.push(keyword);
    }
  });
  
  return {
    location,
    stores,
    subtitle,
    keywords,
    originalTitle: title
  };
}

// Sanityç”¨ã®PortableTextãƒ–ãƒ­ãƒƒã‚¯ã«å¤‰æ›ã™ã‚‹é–¢æ•°ï¼ˆå†åˆ©ç”¨ï¼‰
function convertToPortableText(content) {
  const blocks = [];
  const paragraphs = content.split('\n\n');
  
  paragraphs.forEach(paragraph => {
    if (paragraph.trim() === '') return;
    
    if (paragraph.startsWith('## ')) {
      blocks.push({
        _type: 'block',
        _key: Math.random().toString(36).substr(2, 9),
        style: 'h2',
        children: [{
          _type: 'span',
          _key: Math.random().toString(36).substr(2, 9),
          text: paragraph.replace('## ', ''),
          marks: []
        }]
      });
    } else {
      blocks.push({
        _type: 'block',
        _key: Math.random().toString(36).substr(2, 9),
        style: 'normal',
        children: [{
          _type: 'span',
          _key: Math.random().toString(36).substr(2, 9),
          text: paragraph,
          marks: []
        }]
      });
    }
  });
  
  return blocks;
}

async function enhanceArticleContent() {
  try {
    console.log('ğŸ“ è¨˜äº‹ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’1000æ–‡å­—ç¨‹åº¦ã«æ‹¡å¼µã—ã¾ã™...\n');
    
    // å…ˆã»ã©å‡¦ç†ã—ãŸ3ã¤ã®è¨˜äº‹ã‚’å–å¾—
    const posts = await client.fetch(`
      *[_type == "post" && defined(publishedAt) && slug.current in ["toyama-city-cake-station", "toyama-city-50", "toyama-city-candy-apple-maroot"]]{ 
        _id,
        title, 
        description,
        category,
        "slug": slug.current,
        publishedAt
      }
    `);
    
    console.log(`ğŸ“‹ æ‹¡å¼µå¯¾è±¡è¨˜äº‹æ•°: ${posts.length}ä»¶\n`);
    
    let processedCount = 0;
    
    for (const post of posts) {
      console.log(`ğŸ“ æ‹¡å¼µä¸­: ${post.title}`);
      console.log(`   ã‚¹ãƒ©ãƒƒã‚°: ${post.slug}`);
      
      try {
        // ã‚¿ã‚¤ãƒˆãƒ«ã‹ã‚‰ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’æŠ½å‡º
        const extractedData = extractKeywordsFromTitle(post.title);
        
        // 1000æ–‡å­—ç¨‹åº¦ã®å……å®Ÿã—ãŸè¨˜äº‹å†…å®¹ã‚’ç”Ÿæˆ
        const enhancedContent = generateEnhancedArticleContent(extractedData);
        console.log(`   æ‹¡å¼µå¾Œæ–‡å­—æ•°: ${enhancedContent.length}æ–‡å­—`);
        
        // PortableTextãƒ–ãƒ­ãƒƒã‚¯ã«å¤‰æ›
        const portableTextBlocks = convertToPortableText(enhancedContent);
        
        // Sanityã«ä¿å­˜
        await client
          .patch(post._id)
          .set({ body: portableTextBlocks })
          .commit();
        
        console.log(`   âœ… æ‹¡å¼µå®Œäº†\n`);
        processedCount++;
        
        // ãƒ¬ãƒ¼ãƒˆåˆ¶é™å¯¾ç­–
        await new Promise(resolve => setTimeout(resolve, 1000));
        
      } catch (error) {
        console.error(`   âŒ æ‹¡å¼µå¤±æ•—: ${error.message}\n`);
      }
    }
    
    console.log('ğŸ‰ è¨˜äº‹ã‚³ãƒ³ãƒ†ãƒ³ãƒ„æ‹¡å¼µå®Œäº†ï¼');
    console.log(`ğŸ“Š çµæœ: ${processedCount}/${posts.length}ä»¶ã®è¨˜äº‹ã‚’æ‹¡å¼µã—ã¾ã—ãŸã€‚`);
    
  } catch (error) {
    console.error('âŒ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ:', error.message);
  }
}

enhanceArticleContent();