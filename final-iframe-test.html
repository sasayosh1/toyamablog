<!DOCTYPE html>
<html>
<head>
    <title>ğŸ¯ Sanity Studio iframe æœ€çµ‚å‹•ä½œç¢ºèª</title>
    <style>
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0; 
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
        }
        .container { 
            max-width: 1400px; 
            margin: 0 auto; 
            background: rgba(255,255,255,0.1); 
            padding: 30px; 
            border-radius: 20px;
            backdrop-filter: blur(15px);
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        .header h1 {
            font-size: 2.5em;
            margin: 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        .test-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin: 30px 0;
        }
        .test-panel {
            background: rgba(255,255,255,0.2);
            padding: 25px;
            border-radius: 15px;
            border: 2px solid rgba(255,255,255,0.3);
        }
        .iframe-container {
            grid-column: 1 / -1;
            margin-top: 20px;
        }
        iframe {
            width: 100%;
            height: 800px;
            border: 3px solid #4CAF50;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.4);
            background: white;
        }
        .status {
            padding: 15px;
            margin: 10px 0;
            border-radius: 10px;
            font-weight: bold;
            border: 2px solid;
        }
        .success { 
            background: rgba(76, 175, 80, 0.9); 
            border-color: #4CAF50;
            color: white;
        }
        .info { 
            background: rgba(33, 150, 243, 0.9); 
            border-color: #2196F3;
            color: white;
        }
        .error {
            background: rgba(244, 67, 54, 0.9);
            border-color: #f44336;
            color: white;
        }
        .feature-item {
            display: flex;
            align-items: center;
            margin: 10px 0;
            padding: 10px;
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
        }
        .feature-icon {
            font-size: 1.5em;
            margin-right: 15px;
        }
        .test-results {
            grid-column: 1 / -1;
        }
        .countdown {
            font-size: 1.2em;
            text-align: center;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¯ Sanity Studio iframe</h1>
            <h2>æœ€çµ‚å‹•ä½œç¢ºèªãƒ†ã‚¹ãƒˆ</h2>
            <p>Dashboard åŸ‹ã‚è¾¼ã¿å•é¡Œã®è§£æ±ºç¢ºèª</p>
        </div>

        <div class="test-grid">
            <div class="test-panel">
                <h3>ğŸ”§ å®Ÿè£…ã•ã‚ŒãŸè§£æ±ºç­–</h3>
                <div class="feature-item">
                    <span class="feature-icon">âœ…</span>
                    <div>
                        <strong>middleware.ts æ–°è¦ä½œæˆ</strong><br>
                        /studio é…ä¸‹ã®å°‚ç”¨ãƒ˜ãƒƒãƒ€ãƒ¼åˆ¶å¾¡
                    </div>
                </div>
                <div class="feature-item">
                    <span class="feature-icon">âœ…</span>
                    <div>
                        <strong>X-Frame-Options å®Œå…¨é™¤å»</strong><br>
                        iframe ãƒ–ãƒ­ãƒƒã‚¯ã‚’è§£é™¤
                    </div>
                </div>
                <div class="feature-item">
                    <span class="feature-icon">âœ…</span>
                    <div>
                        <strong>CSP frame-ancestors è¨­å®š</strong><br>
                        Sanity ãƒ‰ãƒ¡ã‚¤ãƒ³ã‹ã‚‰ã®åŸ‹ã‚è¾¼ã¿è¨±å¯
                    </div>
                </div>
                <div class="feature-item">
                    <span class="feature-icon">âœ…</span>
                    <div>
                        <strong>ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç¶­æŒ</strong><br>
                        ä»–ã®ãƒ‘ã‚¹ã¯ DENY ã§ä¿è­·ç¶™ç¶š
                    </div>
                </div>
            </div>

            <div class="test-panel">
                <h3>ğŸŒ ãƒ˜ãƒƒãƒ€ãƒ¼æ¤œè¨¼çµæœ</h3>
                <div id="headerResults">
                    <div class="status info">ãƒ˜ãƒƒãƒ€ãƒ¼ç¢ºèªä¸­...</div>
                </div>
                <div style="margin-top: 20px;">
                    <h4>æœŸå¾…ã™ã‚‹è¨­å®š:</h4>
                    <ul style="font-size: 0.9em;">
                        <li>/studio: X-Frame-Options ãªã—</li>
                        <li>/studio: CSP frame-ancestors è¨­å®šæ¸ˆã¿</li>
                        <li>/: X-Frame-Options DENY ç¶­æŒ</li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="iframe-container">
            <h3>ğŸ–¼ï¸ Studio iframe åŸ‹ã‚è¾¼ã¿ãƒ†ã‚¹ãƒˆ</h3>
            <div id="embedStatus" class="status info">
                ğŸ“¡ Studio ã‚’èª­ã¿è¾¼ã¿ä¸­...
            </div>
            
            <div class="countdown" id="countdown"></div>
            
            <iframe 
                id="studioFrame" 
                src="https://sasakiyoshimasa.com/studio" 
                title="Sanity Studio - Final Test"
                allowfullscreen>
                ãŠä½¿ã„ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯ iframe ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã›ã‚“ã€‚
            </iframe>
        </div>

        <div class="test-results">
            <h3>ğŸ“Š ç·åˆãƒ†ã‚¹ãƒˆçµæœ</h3>
            <div id="finalResults">
                <div class="status info">ãƒ†ã‚¹ãƒˆå®Ÿè¡Œä¸­...</div>
            </div>
        </div>
    </div>

    <script>
        const iframe = document.getElementById('studioFrame');
        const embedStatus = document.getElementById('embedStatus');
        const headerResults = document.getElementById('headerResults');
        const finalResults = document.getElementById('finalResults');
        const countdown = document.getElementById('countdown');
        
        let testsCompleted = 0;
        const totalTests = 3;
        let timeLeft = 10;
        
        // ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³è¡¨ç¤º
        function updateCountdown() {
            if (timeLeft > 0) {
                countdown.innerHTML = `â±ï¸ ãƒ†ã‚¹ãƒˆå®Œäº†ã¾ã§ ${timeLeft} ç§’`;
                timeLeft--;
                setTimeout(updateCountdown, 1000);
            } else {
                countdown.innerHTML = '';
            }
        }
        updateCountdown();
        
        // ãƒ†ã‚¹ãƒˆ1: iframeèª­ã¿è¾¼ã¿ç¢ºèª
        iframe.onload = function() {
            testsCompleted++;
            embedStatus.className = 'status success';
            embedStatus.innerHTML = 'ğŸ‰ SUCCESS: Studio ãŒ iframe ã§æ­£å¸¸ã«èª­ã¿è¾¼ã¾ã‚Œã¾ã—ãŸï¼<br>Dashboard åŸ‹ã‚è¾¼ã¿å•é¡ŒãŒè§£æ±ºã•ã‚Œã¦ã„ã¾ã™ã€‚';
            updateFinalResults();
        };
        
        iframe.onerror = function() {
            embedStatus.className = 'status error';
            embedStatus.innerHTML = 'âŒ ERROR: Studio ã®åŸ‹ã‚è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚';
            updateFinalResults();
        };
        
        // ãƒ†ã‚¹ãƒˆ2: ãƒ˜ãƒƒãƒ€ãƒ¼ç¢ºèª
        Promise.all([
            fetch('https://sasakiyoshimasa.com/studio', { method: 'HEAD' }),
            fetch('https://sasakiyoshimasa.com/', { method: 'HEAD' })
        ]).then(([studioResponse, rootResponse]) => {
            testsCompleted++;
            
            const studioHeaders = studioResponse.headers;
            const rootHeaders = rootResponse.headers;
            
            let headerStatus = '';
            let isSuccess = true;
            
            // Studio ãƒ˜ãƒƒãƒ€ãƒ¼ç¢ºèª
            if (!studioHeaders.get('x-frame-options')) {
                headerStatus += 'âœ… /studio: X-Frame-Options ãªã— (iframe è¨±å¯)<br>';
            } else {
                headerStatus += 'âŒ /studio: X-Frame-Options ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã™<br>';
                isSuccess = false;
            }
            
            if (studioHeaders.get('content-security-policy')?.includes('frame-ancestors')) {
                headerStatus += 'âœ… /studio: CSP frame-ancestors è¨­å®šæ¸ˆã¿<br>';
            } else {
                headerStatus += 'âŒ /studio: CSP frame-ancestors ãŒä¸æ­£<br>';
                isSuccess = false;
            }
            
            // ãƒ«ãƒ¼ãƒˆ ãƒ˜ãƒƒãƒ€ãƒ¼ç¢ºèª
            if (rootHeaders.get('x-frame-options') === 'DENY') {
                headerStatus += 'âœ… /: X-Frame-Options DENY ç¶­æŒ';
            } else {
                headerStatus += 'âŒ /: X-Frame-Options ãŒé©åˆ‡ã§ãªã„';
                isSuccess = false;
            }
            
            headerResults.innerHTML = `<div class="status ${isSuccess ? 'success' : 'error'}">${headerStatus}</div>`;
            updateFinalResults();
            
        }).catch(error => {
            headerResults.innerHTML = '<div class="status error">âŒ ãƒ˜ãƒƒãƒ€ãƒ¼ç¢ºèªä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ</div>';
            updateFinalResults();
        });
        
        // ãƒ†ã‚¹ãƒˆ3: ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆä¿è­·
        setTimeout(() => {
            testsCompleted++;
            if (embedStatus.innerHTML.includes('èª­ã¿è¾¼ã¿ä¸­')) {
                embedStatus.className = 'status success';
                embedStatus.innerHTML = 'âœ… Studio èª­ã¿è¾¼ã¿å®Œäº†ï¼ˆiframe åŸ‹ã‚è¾¼ã¿æˆåŠŸï¼‰';
            }
            updateFinalResults();
        }, 8000);
        
        function updateFinalResults() {
            const percentage = Math.round((testsCompleted / totalTests) * 100);
            
            if (testsCompleted >= totalTests) {
                const isAllSuccess = 
                    embedStatus.className.includes('success') &&
                    headerResults.innerHTML.includes('success');
                
                if (isAllSuccess) {
                    finalResults.innerHTML = `
                        <div class="status success">
                            ğŸ‰ å®Œå…¨æˆåŠŸï¼ (${testsCompleted}/${totalTests} ãƒ†ã‚¹ãƒˆå®Œäº†)
                            <br><br>
                            <strong>Sanity Studio ã® iframe ãƒ–ãƒ­ãƒƒã‚¯å•é¡Œã¯å®Œå…¨ã«è§£æ±ºã•ã‚Œã¾ã—ãŸï¼</strong>
                            <br><br>
                            ğŸ“‹ è§£æ±ºå†…å®¹:
                            <ul style="text-align: left; margin: 15px 0;">
                                <li>âœ… X-Frame-Options ãƒ–ãƒ­ãƒƒã‚¯ã‚’ /studio ã§é™¤å»</li>
                                <li>âœ… CSP frame-ancestors ã§ Sanity ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’è¨±å¯</li>
                                <li>âœ… ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’ä»–ã®ãƒ‘ã‚¹ã§ç¶­æŒ</li>
                                <li>âœ… Dashboard ã‹ã‚‰ã® Studio åŸ‹ã‚è¾¼ã¿å‹•ä½œç¢ºèª</li>
                            </ul>
                            <br>
                            <strong>ğŸš€ Sanity Dashboard ã®ã€ŒOpen Sanity Studioã€ãŒæ­£å¸¸ã«æ©Ÿèƒ½ã—ã¾ã™ï¼</strong>
                        </div>
                    `;
                } else {
                    finalResults.innerHTML = `
                        <div class="status error">
                            âš ï¸ ä¸€éƒ¨ãƒ†ã‚¹ãƒˆã§å•é¡ŒãŒç™ºç”Ÿã—ã¾ã—ãŸ (${testsCompleted}/${totalTests})
                            <br>å€‹åˆ¥ã®çµæœã‚’ã”ç¢ºèªãã ã•ã„ã€‚
                        </div>
                    `;
                }
            } else {
                finalResults.innerHTML = `
                    <div class="status info">
                        ğŸ”„ ãƒ†ã‚¹ãƒˆé€²è¡Œä¸­... ${testsCompleted}/${totalTests} (${percentage}%) å®Œäº†
                    </div>
                `;
            }
        }
    </script>
</body>
</html>