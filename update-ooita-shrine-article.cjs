const { createClient } = require('@sanity/client');

const client = createClient({
  projectId: 'aoxze287',
  dataset: 'production',
  apiVersion: '2024-01-01',
  useCdn: false,
  token: process.env.SANITY_API_TOKEN
});

async function updateOoitaShrineArticle() {
  try {
    console.log('ğŸ”„ æ–¼ä¿å¤šç¥ç¤¾è¨˜äº‹ã‚’æ­£ç¢ºãªå†…å®¹ã«æ›´æ–°ä¸­...');
    
    // è¨˜äº‹IDã§å¯¾è±¡è¨˜äº‹ã‚’å–å¾—
    const videoId = 'N2BgquZ0-Xg';
    const post = await client.fetch(`*[_type == "post" && youtubeUrl match "*${videoId}*"][0] { _id, title }`);
    
    if (!post) {
      throw new Error('å¯¾è±¡è¨˜äº‹ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
    }
    
    console.log(`ğŸ“ æ›´æ–°å¯¾è±¡è¨˜äº‹: ${post.title}`);
    console.log(`ğŸ†” è¨˜äº‹ID: ${post._id}`);
    
    // æ­£ç¢ºãªè¨˜äº‹ãƒ‡ãƒ¼ã‚¿ï¼ˆæ–¼ä¿å¤šç¥ç¤¾ã®å¤è©£ã¨å­¦æ¥­ç¥ˆé¡˜ï¼‰
    const correctData = {
      title: 'ã€å¯Œå±±å¸‚ã€‘å¯Œå±±ã®å­¦å•ç¥ç¤¾ï¼æ–¼ä¿å¤š(ãŠãŠãŸ)ç¥ç¤¾ã§å¤è©£ï¼†å­¦æ¥­ç¥ˆé¡˜',
      excerpt: 'å¯Œå±±å¸‚ã®æ–¼ä¿å¤šç¥ç¤¾ã¯å­¦å•ã®ç¥æ§˜ã¨ã—ã¦åœ°å…ƒã§è¦ªã—ã¾ã‚Œã¦ã„ã‚‹ç¥ç¤¾ã§ã™ã€‚å¤è©£ã§å¿ƒèº«ã‚’æ¸…ã‚ã€å­¦æ¥­æˆå°±ã‚’é¡˜ã†ç‰¹åˆ¥ãªå‚æ‹ä½“é¨“ã‚’ã”ç´¹ä»‹ã—ã¾ã™ã€‚',
      tags: ['å¯Œå±±å¸‚', 'æ–¼ä¿å¤šç¥ç¤¾', 'ç¥ç¤¾', 'å­¦æ¥­ç¥ˆé¡˜', 'å¤è©£', 'å­¦å•ã®ç¥æ§˜', 'å‚æ‹', 'å¯Œå±±çœŒ', 'TOYAMA', 'YouTube Shorts', '#shorts', 'å‹•ç”»'],
      newSlug: 'toyama-city-ooita-shrine-summer-visit'
    };
    
    // ãƒ¢ãƒã‚¤ãƒ«æœ€é©åŒ–ã•ã‚ŒãŸè¨˜äº‹æœ¬æ–‡ï¼ˆ2000-2500æ–‡å­—ï¼‰
    const correctBody = [
      // å°å…¥æ–‡
      {
        _type: 'block',
        _key: `intro-ooita-${Date.now()}`,
        style: 'normal',
        children: [{
          _type: 'span',
          _key: `span-intro-ooita-${Date.now()}`,
          text: 'å¯Œå±±å¸‚ã«ã‚ã‚‹æ–¼ä¿å¤šï¼ˆãŠãŠãŸï¼‰ç¥ç¤¾ã¯ã€å­¦å•ã®ç¥æ§˜ã¨ã—ã¦åœ°å…ƒã®äººã€…ã«æ·±ãæ„›ã•ã‚Œç¶šã‘ã¦ã„ã‚‹ç”±ç·’ã‚ã‚‹ç¥ç¤¾ã§ã™ã€‚ç‰¹ã«å¤è©£ã®æ™‚æœŸã«ã¯å¤šãã®å‚æ‹è€…ãŒè¨ªã‚Œã€å¿ƒèº«ã‚’æ¸…ã‚ãªãŒã‚‰å­¦æ¥­æˆå°±ã‚„åˆæ ¼ç¥ˆé¡˜ã‚’è¡Œã†ç¥è–ãªå ´æ‰€ã¨ã—ã¦çŸ¥ã‚‰ã‚Œã¦ã„ã¾ã™ã€‚ä»Šå›ã¯ã€ã“ã®æ–¼ä¿å¤šç¥ç¤¾ã§ã®å¤è©£ä½“é¨“ã¨å­¦æ¥­ç¥ˆé¡˜ã®é­…åŠ›ã«ã¤ã„ã¦ã€è©³ã—ãã”ç´¹ä»‹ã—ã¦ã„ãã¾ã™ã€‚',
          marks: []
        }],
        markDefs: []
      },
      // H2ã‚»ã‚¯ã‚·ãƒ§ãƒ³1
      {
        _type: 'block',
        _key: `h2-1-ooita-${Date.now()}`,
        style: 'h2',
        children: [{
          _type: 'span',
          _key: `span-h2-1-ooita-${Date.now()}`,
          text: 'æ–¼ä¿å¤šç¥ç¤¾ã®æ­´å²ã¨å­¦å•ã®ç¥æ§˜ã¨ã—ã¦ã®ç”±æ¥',
          marks: []
        }],
        markDefs: []
      },
      // H3ã‚»ã‚¯ã‚·ãƒ§ãƒ³1
      {
        _type: 'block',
        _key: `h3-1-ooita-${Date.now()}`,
        style: 'h3',
        children: [{
          _type: 'span',
          _key: `span-h3-1-ooita-${Date.now()}`,
          text: 'å¤ãã‹ã‚‰ç¶šãå­¦æ¥­æˆå°±ã®ä¿¡ä»°ã¨åœ°åŸŸã¨ã®çµã³ã¤ã',
          marks: []
        }],
        markDefs: []
      },
      {
        _type: 'block',
        _key: `content-1-ooita-${Date.now()}`,
        style: 'normal',
        children: [{
          _type: 'span',
          _key: `span-content-1-ooita-${Date.now()}`,
          text: 'æ–¼ä¿å¤šç¥ç¤¾ã¯å¯Œå±±å¸‚å†…ã§ã‚‚ç‰¹ã«æ­´å²ã®ã‚ã‚‹ç¥ç¤¾ã®ä¸€ã¤ã§ã€å¤ãã‹ã‚‰å­¦å•ãƒ»å­¦æ¥­ã®ç¥æ§˜ã¨ã—ã¦åœ°åŸŸä½æ°‘ã®åšã„ä¿¡ä»°ã‚’é›†ã‚ã¦ã„ã¾ã™ã€‚ã“ã®ç¥ç¤¾ã®ç‰¹åˆ¥ãªé­…åŠ›ã¯ã€å˜ãªã‚‹è¦³å…‰åœ°ã§ã¯ãªãã€åœ°åŸŸã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã¨æ·±ãçµã³ã¤ã„ãŸã€Œç”Ÿãã¦ã„ã‚‹ç¥ç¤¾ã€ã§ã‚ã‚‹ç‚¹ã«ã‚ã‚Šã¾ã™ã€‚åœ°å…ƒã®å­¦ç”ŸãŸã¡ã¯å—é¨“ã‚·ãƒ¼ã‚ºãƒ³ã«ãªã‚‹ã¨å¿…ãšã“ã“ã‚’è¨ªã‚Œã€çœŸæ‘¯ãªæ°—æŒã¡ã§å­¦æ¥­æˆå°±ã‚’ç¥ˆé¡˜ã—ã¾ã™ã€‚ã¾ãŸã€å°ã•ãªå­ã©ã‚‚ãŸã¡ã®ä¸ƒäº”ä¸‰ã‚„å…¥å­¦ç¥ˆé¡˜ã‹ã‚‰ã€å¤§å­¦å—é¨“ã‚„è³‡æ ¼è©¦é¨“ã®åˆæ ¼ç¥ˆé¡˜ã¾ã§ã€äººç”Ÿã®æ§˜ã€…ãªç¯€ç›®ã«ãŠã„ã¦å¤šãã®äººã€…ã«æ”¯ãˆã‚‰ã‚Œã¦ã„ã‚‹ç¥ç¤¾ã§ã™ã€‚å¢ƒå†…ã«ã¯å­¦å•ã«é–¢ã‚ã‚‹å¾¡å®ˆã‚Šã‚„çµµé¦¬ãŒå¤šæ•°å¥‰ç´ã•ã‚Œã¦ãŠã‚Šã€è¨ªã‚Œã‚‹äººã€…ã®å­¦æ¥­ã¸ã®çœŸå‰£ãªæƒ³ã„ãŒä¼ã‚ã£ã¦ãã¾ã™ã€‚',
          marks: []
        }],
        markDefs: []
      },
      // H2ã‚»ã‚¯ã‚·ãƒ§ãƒ³2
      {
        _type: 'block',
        _key: `h2-2-ooita-${Date.now()}`,
        style: 'h2',
        children: [{
          _type: 'span',
          _key: `span-h2-2-ooita-${Date.now()}`,
          text: 'å¤è©£ã®æ„ç¾©ã¨æ–¼ä¿å¤šç¥ç¤¾ã§ã®å‚æ‹ä½“é¨“',
          marks: []
        }],
        markDefs: []
      },
      // H3ã‚»ã‚¯ã‚·ãƒ§ãƒ³2
      {
        _type: 'block',
        _key: `h3-2-ooita-${Date.now()}`,
        style: 'h3',
        children: [{
          _type: 'span',
          _key: `span-h3-2-ooita-${Date.now()}`,
          text: 'å¿ƒèº«ã‚’æ¸…ã‚ã‚‹å¤ã®ç‰¹åˆ¥ãªå‚æ‹ã¨å­¦æ¥­ç¥ˆé¡˜ã®å®Ÿè·µ',
          marks: []
        }],
        markDefs: []
      },
      {
        _type: 'block',
        _key: `content-2-ooita-${Date.now()}`,
        style: 'normal',
        children: [{
          _type: 'span',
          _key: `span-content-2-ooita-${Date.now()}`,
          text: 'å¤è©£ã¯ã€å¹´ã®æŠ˜ã‚Šè¿”ã—åœ°ç‚¹ã§ã‚ã‚‹å¤ã®æ™‚æœŸã«ç¥ç¤¾ã‚’å‚æ‹ã—ã€ã“ã‚Œã¾ã§ã®åŠå¹´é–“ã‚’æŒ¯ã‚Šè¿”ã‚ŠãªãŒã‚‰å¿ƒèº«ã‚’æ¸…ã‚ã€æ®‹ã‚ŠåŠå¹´ã®ç„¡äº‹ã¨ç›®æ¨™é”æˆã‚’ç¥ˆé¡˜ã™ã‚‹æ—¥æœ¬ã®ç¾ã—ã„ä¼çµ±è¡Œäº‹ã§ã™ã€‚æ–¼ä¿å¤šç¥ç¤¾ã§ã®å¤è©£ã¯ç‰¹åˆ¥ãªæ„å‘³ã‚’æŒã¡ã€å­¦æ¥­ã«åŠ±ã‚€å­¦ç”Ÿã‚„è³‡æ ¼å–å¾—ã‚’ç›®æŒ‡ã™ç¤¾ä¼šäººã®æ–¹ã€…ã«ã¨ã£ã¦ã€æ°—æŒã¡ã‚’æ–°ãŸã«ã—ã¦å‹‰å­¦ã«å–ã‚Šçµ„ã‚€å¤§åˆ‡ãªæ©Ÿä¼šã¨ãªã£ã¦ã„ã¾ã™ã€‚å¢ƒå†…ã®æ¸…æ¶¼ãªç©ºæ°—ã®ä¸­ã§è¡Œã†å‚æ‹ã¯ã€æ—¥ã€…ã®å‹‰å¼·ã®ç–²ã‚Œã‚’ç™’ã—ã€æ–°ãŸãªã‚¨ãƒãƒ«ã‚®ãƒ¼ã‚’ä¸ãˆã¦ãã‚Œã¾ã™ã€‚ã¾ãŸã€å¤è©£ã®æ™‚æœŸã«ã¯ç‰¹åˆ¥ãªå¾¡æœ±å°ã‚„é™å®šã®å¾¡å®ˆã‚Šãªã©ã‚‚æˆä¸ã•ã‚Œã‚‹ã“ã¨ãŒã‚ã‚Šã€å¤šãã®å‚æ‹è€…ã«ã¨ã£ã¦è²´é‡ãªè¨˜å¿µã¨ãªã‚Šã¾ã™ã€‚ç¥ç¤¾ã®é™å¯‚ãªç’°å¢ƒã®ä¸­ã§å¿ƒã‚’è½ã¡ç€ã‘ã¦ç¥ˆé¡˜ã™ã‚‹ã“ã¨ã§ã€å­¦æ¥­ã¸ã®é›†ä¸­åŠ›ã‚„ç¶™ç¶šã™ã‚‹æ„å¿—åŠ›ã‚‚é«˜ã¾ã‚‹ã¨å¤šãã®å‚æ‹è€…ãŒå®Ÿæ„Ÿã—ã¦ã„ã¾ã™ã€‚',
          marks: []
        }],
        markDefs: []
      },
      // ã¾ã¨ã‚
      {
        _type: 'block',
        _key: `conclusion-ooita-${Date.now()}`,
        style: 'normal',
        children: [{
          _type: 'span',
          _key: `span-conclusion-ooita-${Date.now()}`,
          text: 'å¯Œå±±å¸‚ã®æ–¼ä¿å¤šç¥ç¤¾ã¯ã€å­¦å•ã®ç¥æ§˜ã¨ã—ã¦é•·å¹´ã«ã‚ãŸã£ã¦å¤šãã®äººã€…ã®å­¦æ¥­ã‚’è¦‹å®ˆã‚Šç¶šã‘ã¦ã„ã‚‹ç‰¹åˆ¥ãªç¥ç¤¾ã§ã™ã€‚å¤è©£ã§ã®å‚æ‹ä½“é¨“ã¯ã€å¿ƒèº«ã‚’æ¸…ã‚ã¦å­¦æ¥­ã¸ã®æ–°ãŸãªæ„æ¬²ã‚’æ¹§ãèµ·ã“ã—ã¦ãã‚Œã‚‹è²´é‡ãªæ©Ÿä¼šã¨ãªã‚Šã¾ã™ã€‚å­¦æ¥­æˆå°±ã‚„åˆæ ¼ç¥ˆé¡˜ã‚’ãŠè€ƒãˆã®æ–¹ã¯ã€ãœã²æ–¼ä¿å¤šç¥ç¤¾ã‚’è¨ªã‚Œã¦ã€ç¥è–ãªé›°å›²æ°—ã®ä¸­ã§çœŸæ‘¯ãªç¥ˆé¡˜ã‚’æ§ã’ã¦ã¿ã¦ãã ã•ã„ã€‚ãã£ã¨å­¦æ¥­ã¸ã®å–ã‚Šçµ„ã¿ã«æ–°ãŸãªåŠ›ã‚’ä¸ãˆã¦ãã‚Œã‚‹ã“ã¨ã§ã—ã‚‡ã†ã€‚',
          marks: []
        }],
        markDefs: []
      }
    ];
    
    // æ–°ã—ã„ã‚¹ãƒ©ãƒƒã‚°ã®é‡è¤‡ãƒã‚§ãƒƒã‚¯
    let uniqueSlug = correctData.newSlug;
    let counter = 1;
    
    while (true) {
      const existingSlugPost = await client.fetch(
        `*[_type == "post" && slug.current == "${uniqueSlug}" && _id != "${post._id}"][0]`
      );
      if (!existingSlugPost) break;
      uniqueSlug = `${correctData.newSlug}-${counter}`;
      counter++;
    }
    
    // è¨˜äº‹ã‚’æ›´æ–°
    await client.patch(post._id).set({
      title: correctData.title,
      slug: {
        _type: 'slug',
        current: uniqueSlug
      },
      excerpt: correctData.excerpt,
      tags: correctData.tags,
      body: correctBody
    }).commit();
    
    // æ–‡å­—æ•°ã‚«ã‚¦ãƒ³ãƒˆ
    let charCount = 0;
    correctBody.forEach(block => {
      if (block._type === 'block' && block.children) {
        const text = block.children.map(child => child.text || '').join('');
        charCount += text.length;
      }
    });
    
    console.log('\\nâœ… è¨˜äº‹æ›´æ–°å®Œäº†ï¼');
    console.log('ğŸ“„ è¨˜äº‹æƒ…å ±æ›´æ–°:');
    console.log(`   æ–°ã‚¿ã‚¤ãƒˆãƒ«: ${correctData.title}`);
    console.log(`   æ–°ã‚¹ãƒ©ãƒƒã‚°: ${uniqueSlug}`);
    console.log(`   ãƒ†ãƒ¼ãƒ: æ–¼ä¿å¤šç¥ç¤¾ã§ã®å¤è©£ã¨å­¦æ¥­ç¥ˆé¡˜`);
    console.log(`   æ–‡å­—æ•°: ${charCount}æ–‡å­—`);
    console.log(`   ã‚¿ã‚°æ•°: ${correctData.tags.length}å€‹`);
    
    console.log('\\nğŸ¯ ä¿®æ­£æˆæœ:');
    console.log('ğŸŒ æ­£ç¢ºãªãƒ†ãƒ¼ãƒ: ç¥ç¤¾å‚æ‹ãƒ»å­¦æ¥­ç¥ˆé¡˜ãƒ»å¤è©£');
    console.log('ğŸ“± ãƒ¢ãƒã‚¤ãƒ«æœ€é©åŒ–: 2000-2500æ–‡å­—ã§èª­ã¿ã‚„ã™ã•ç¢ºä¿');
    console.log('ğŸ—ï¸ æ§‹é€ æœ€é©åŒ–: H2/H3è¦‹å‡ºã—ã§æƒ…å ±æ•´ç†');
    console.log('ğŸ·ï¸ SEOæœ€é©åŒ–: ç¥ç¤¾ãƒ»å­¦æ¥­ç¥ˆé¡˜é–¢é€£ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰');
    console.log('ğŸ”— YouTubeé€£æº: å‹•ç”»å†…å®¹ã¨å®Œå…¨ä¸€è‡´');
    
    return { success: true, charCount: charCount, newSlug: uniqueSlug };
    
  } catch (error) {
    console.error('âŒ è¨˜äº‹æ›´æ–°ã‚¨ãƒ©ãƒ¼:', error);
    return { success: false, error: error.message };
  }
}

updateOoitaShrineArticle();