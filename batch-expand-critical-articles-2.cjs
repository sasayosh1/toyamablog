const { createClient } = require('@sanity/client');
const client = createClient({
  projectId: 'aoxze287',
  dataset: 'production',
  apiVersion: '2024-01-01',
  useCdn: false,
  token: process.env.SANITY_API_TOKEN
});

async function batchExpandCriticalArticles2() {
  try {
    console.log('🚀 極端に短い記事のバッチ拡充 (第2弾) 開始...');
    console.log('============================================');
    
    // 次の5件を処理
    const articlesToExpand = [
      {
        id: 'drafts.qszvaZusvE4KvujKB63yBo',
        title: '【富山市】富山駅前の隠れ家ケーキ店で至福のひととき｜シャルロッテ パティオさくら富山駅前店',
        content: {
          intro: '富山駅前エリアに佇む「シャルロッテ パティオさくら富山駅前店」は、地元の方々に愛され続けている隠れ家的なケーキ店なんです。駅からのアクセスも抜群で、職人さんが心を込めて作る絶品ケーキは、多くのスイーツ好きの方から絶大な支持を集めているんですよ。そんなシャルロッテ パティオさくら富山駅前店の魅力を、たっぷりとお伝えしていきますね。',
          sections: [
            {
              h2: 'シャルロッテ パティオさくら富山駅前店の魅力',
              h3_1: 'うさぎモチーフの可愛いスイーツ',
              content_1: '店内に並ぶスイーツは、どれもうさぎをモチーフにした愛らしいデザインが特徴です。うさぎの形をしたマカロン、耳の部分がチョコレートでできたケーキ、ふわふわのうさぎをイメージしたムースなど、見ているだけで心が癒されます。パティシエさんの細やかな技術と愛情が込められた一つ一つの作品は、食べるのがもったいないほどの完成度です。',
              h3_2: '地元食材を活かした本格的な味わい',
              content_2: 'シャルロッテ パティオさくら富山駅前店では、可愛さだけでなく味にもしっかりとこだわっています。富山県産の新鮮な卵や牛乳、南砺市周辺で採れる季節のフルーツなど、地元の食材を積極的に使用。特に人気の「ラパンショートケーキ」は、ふわふわのスポンジと甘さ控えめの生クリームが絶妙なバランスです。'
            },
            {
              h2: '店内の雰囲気とサービス',
              h3_3: 'うさぎに囲まれた癒しの空間',
              content_3: '店内に一歩足を踏み入れると、そこはまさにうさぎの楽園です。壁には可愛いうさぎのイラストが描かれ、棚には様々なうさぎグッズが飾られています。ショーケースの中のケーキたちも、まるでうさぎたちがお客様を迎えてくれているかのよう。優しい音楽が流れる店内で、ゆったりとした時間を過ごすことができます。',
              h3_4: '心温まるおもてなし',
              content_4: 'スタッフの皆さんの笑顔と丁寧な接客も、シャルロッテ パティオさくら富山駅前店の大きな魅力の一つです。お客様一人一人に対して心を込めたサービスを提供してくれて、初めて訪れる方でも安心して楽しめるよう、本当に細やかな気配りをしてくれるんですよ。富山駅から徒歩圏内の便利な立地で、特別なひとときをお過ごしください。'
            }
          ]
        }
      },
      {
        id: 'jKwgQNCsrs019jNuQGXsKO',
        title: '【氷見市】吉がけ牧場のヤギたちから見習いたいスローライフ体験',
        content: {
          intro: '氷見市にある吉がけ牧場では、のんびりと草を食むヤギたちの姿から、現代人が忘れがちなスローライフの大切さを学ぶことができます。広い牧草地でマイペースに過ごすヤギたちの生活は、まさに理想的なライフスタイルそのもの。都市部の忙しさに疲れた心を癒してくれる、心温まる体験をご紹介します。',
          sections: [
            {
              h2: 'ヤギたちが教えてくれるスローライフの魅力',
              h3_1: 'マイペースで過ごす牧場生活',
              content_1: '吉がけ牧場のヤギたちは、一日中自分のペースで草を食み、日向ぼっこを楽しんでいます。急ぐことなく、競うことなく、ただ自然のリズムに身を委ねる彼らの生活は、現代社会で生きる私たちにとって大きな学びとなります。特に子ヤギたちの無邪気な遊ぶ姿は、見る人の心を和ませ、笑顔にしてくれます。',
              h3_2: '自然環境の中での癒しの時間',
              content_2: '牧場は氷見市の豊かな自然に囲まれており、富山湾を望む絶好のロケーションにあります。ヤギたちと触れ合いながら、海風を感じ、鳥のさえずりに耳を傾ける時間は、日常のストレスを忘れさせてくれます。都会の喧騒から離れ、自然のリズムを感じることで、心身ともにリフレッシュできる貴重な体験です。'
            },
            {
              h2: '吉がけ牧場での体験とアクセス',
              h3_3: 'ヤギとの触れ合い体験',
              content_3: '牧場では、ヤギたちに直接触れたり、エサやり体験を楽しむことができます。人懐っこいヤギたちは、優しく接すると寄ってきてくれるので、小さなお子様でも安心して触れ合いを楽しめます。また、ヤギのミルクを使った手作りチーズやアイスクリームなども味わうことができ、牧場ならではのグルメも満喫できます。',
              h3_4: '氷見市でのスローライフ体験',
              content_4: '吉がけ牧場は氷見市街地から車で約20分の場所に位置し、海と山に囲まれた自然豊かな環境です。牧場見学の後は、近くの温泉でゆっくりとくつろいだり、氷見の新鮮な海の幸を味わったりと、一日中スローライフを満喫できます。時間に追われる現代生活から一歩離れ、ヤギたちのような穏やかな時間を過ごしてみませんか。'
            }
          ]
        }
      },
      {
        id: 'jKwgQNCsrs019jNuQGXuNc',
        title: '【砺波市】イオンモールとなみで『劇場版「鬼滅の刃」無限城編』ポスター展開催中！',
        content: {
          intro: '砺波市のイオンモールとなみで開催中の「劇場版『鬼滅の刃』無限城編」ポスター展は、鬼滅ファン必見のイベントです。映画公開を記念した特別展示では、迫力満点のポスターや関連グッズが多数展示されており、作品の世界観を存分に楽しむことができます。家族連れからアニメファンまで、幅広い層に人気のイベントです。',
          sections: [
            {
              h2: '劇場版「鬼滅の刃」無限城編ポスター展の見どころ',
              h3_1: '迫力満点の特別展示ポスター',
              content_1: 'イオンモールとなみの展示スペースには、劇場版「鬼滅の刃」無限城編の公式ポスターが大迫力で展示されています。炭治郎や仲間たちの勇姿、そして無限城の幻想的な世界観が描かれたポスターは、見る者を作品の世界に引き込みます。各キャラクターの表情や細かなディテールまで、間近で鑑賞できる貴重な機会です。',
              h3_2: '限定グッズとフォトスポット',
              content_2: '展示会場には映画公開記念の限定グッズも販売されており、ファンにとっては見逃せないアイテムが揃っています。また、作品をイメージしたフォトスポットも設置されているので、お気に入りのキャラクターと一緒に記念撮影を楽しむことができます。SNS映えする写真が撮れると、若いファンにも大好評です。'
            },
            {
              h2: 'イオンモールとなみでの鬼滅体験',
              h3_3: 'ファン同士の交流と盛り上がり',
              content_3: '展示会場では、同じ作品を愛するファン同士が自然と会話を始める光景もよく見られます。お気に入りのキャラクターについて語り合ったり、映画への期待を共有したりと、作品を通じた交流が生まれています。親子で鬼滅の話で盛り上がる微笑ましい光景も多く見られ、世代を超えて愛される作品の魅力を実感できます。',
              h3_4: '開催期間とアクセス情報',
              content_4: 'ポスター展の開催期間や詳細な時間については、イオンモールとなみの公式サイトでご確認ください。砺波ICからのアクセスも良好で、広い駐車場も完備されています。展示見学の後は、モール内でお食事やショッピングも楽しめるので、一日中楽しく過ごせます。鬼滅ファンの方はもちろん、アニメに興味のある方もぜひ足を運んでみてください。'
            }
          ]
        }
      },
      {
        id: 'jKwgQNCsrs019jNuQGi6pM',
        title: '【魚津市】毎日暑いのでゴマフアザラシを見て涼しさを感じよう！魚津水族館の癒し体験',
        content: {
          intro: '暑い夏の日には、魚津水族館でゴマフアザラシたちの愛らしい姿を見て涼しさを感じませんか。水中を優雅に泳ぎ回るアザラシたちの姿は、見ているだけで心が涼しくなります。魚津水族館は日本海側最大級の水族館として、多彩な海の生き物たちとの出会いを提供してくれる、夏の暑さを忘れさせてくれるスポットです。',
          sections: [
            {
              h2: 'ゴマフアザラシたちの魅力的な生活',
              h3_1: '水中での優雅な泳ぎ',
              content_1: '魚津水族館のゴマフアザラシたちは、広い水槽の中を自由自在に泳ぎ回っています。陸上ではぽてっとした体型が愛らしいアザラシですが、水中では驚くほどスマートで優雅な泳ぎを披露してくれます。くるくると回転したり、水底から勢いよく水面に向かって泳いだりする姿は、見ていて飽きることがありません。',
              h3_2: 'アザラシたちの個性豊かな表情',
              content_2: '魚津水族館にいるゴマフアザラシたちは、それぞれに個性があり、表情豊かです。好奇心旺盛で人懐っこい子もいれば、マイペースでのんびり屋さんもいます。特に餌の時間になると、飼育員さんに甘えるような仕草を見せたり、手を振るような動作をしたりと、まるで犬のような愛らしさを見せてくれます。'
            },
            {
              h2: '魚津水族館での涼しい夏の過ごし方',
              h3_3: '館内の快適な環境でリフレッシュ',
              content_3: '魚津水族館の館内は一年中快適な温度に保たれているため、暑い夏の日の避暑地としても最適です。ゴマフアザラシ以外にも、イルカやペンギン、色とりどりの熱帯魚など、約300種類の海の生き物たちが展示されています。涼しい館内で、海の世界の神秘を存分に楽しむことができます。',
              h3_4: '富山湾の恵みを感じる展示',
              content_4: '魚津水族館は富山湾に面した立地を活かし、地元の海で見られる魚類も多数展示しています。ホタルイカの発光展示や、深海魚の珍しい生態展示など、富山ならではの海の魅力を発見できます。夏の暑さを忘れて、海の生き物たちとの触れ合いを通じて、自然の素晴らしさを感じてみませんか。アクセスも良好で、家族連れの夏のお出かけにぴったりのスポットです。'
            }
          ]
        }
      },
      {
        id: 'o031colbTiBAm1wuPGadKX',
        title: '【富山市】創業1946年！富山の老舗「PAIN D\'OR (パンドール)」懐かしくて新しい絶品パンの数々',
        content: {
          intro: '富山市にある老舗ベーカリー「PAIN D\'OR（パンドール）」は、1946年の創業から75年以上にわたって地元の人々に愛され続けています。伝統的な製法と現代の技術を融合させた「懐かしくて新しい」パンづくりで、多くのパン好きを魅了しています。三世代にわたって受け継がれてきた職人技と、時代に合わせて進化し続ける創意工夫の魅力をご紹介します。',
          sections: [
            {
              h2: 'PAIN D\'OR（パンドール）の歴史と伝統',
              h3_1: '創業1946年から受け継がれる職人技',
              content_1: '終戦翌年の1946年に創業したパンドールは、富山のパン文化の発展とともに歩んできました。初代から三代目まで受け継がれる職人技は、手作りの温かさと確かな技術に支えられています。特に食パンや菓子パンの製法は創業当時のレシピを大切に守りながら、現代の食材や設備を活用してより美味しく進化させています。',
              h3_2: '地元食材へのこだわり',
              content_2: '75年以上の歴史の中で培われた地元との絆を大切に、富山県産の小麦粉や卵、牛乳を積極的に使用しています。特に富山平野で育った小麦を使った食パンは、もちもちとした食感と自然な甘みが特徴で、多くの常連客に愛されています。季節ごとに変わる地元の旬の食材を取り入れたパンも人気です。'
            },
            {
              h2: '懐かしくて新しいパンドールの魅力',
              h3_3: '伝統と革新が融合した商品ラインナップ',
              content_3: 'パンドールの店頭には、昔ながらの製法で作られたコッペパンやあんパンと並んで、現代的なセンスを取り入れた惣菜パンやスイーツ系パンが並んでいます。「懐かしくて新しい」というコンセプト通り、伝統的な美味しさを保ちながら、現代の生活スタイルに合わせた新しいアイデアが光る商品展開が魅力です。',
              h3_4: '地域に根ざした温かいサービス',
              content_4: '三世代にわたって地域の人々と歩んできたパンドールは、お客様一人一人との関係を大切にしています。常連のお客様の好みを覚えて、おすすめのパンを紹介してくれる温かいサービスは、まさに老舗ならではの魅力。富山市内でアクセスも良好で、朝食用から手土産まで、様々なシーンで利用できる地域に愛される老舗ベーカリーです。'
            }
          ]
        }
      }
    ];
    
    let successCount = 0;
    let errorCount = 0;
    
    for (const article of articlesToExpand) {
      try {
        console.log(`\n🔄 処理中: ${article.title.substring(0, 50)}...`);
        
        // 記事本文の構築
        const newBody = [
          // 導入文
          {
            _type: 'block',
            _key: 'intro',
            style: 'normal',
            children: [{
              _type: 'span',
              _key: 'intro-span',
              text: article.content.intro,
              marks: []
            }],
            markDefs: []
          }
        ];
        
        // セクションを追加
        article.content.sections.forEach((section, sectionIndex) => {
          // H2見出し
          newBody.push({
            _type: 'block',
            _key: `h2-${sectionIndex + 1}`,
            style: 'h2',
            children: [{
              _type: 'span',
              _key: `h2-${sectionIndex + 1}-span`,
              text: section.h2,
              marks: []
            }],
            markDefs: []
          });
          
          // H3見出し1
          newBody.push({
            _type: 'block',
            _key: `h3-${sectionIndex + 1}-1`,
            style: 'h3',
            children: [{
              _type: 'span',
              _key: `h3-${sectionIndex + 1}-1-span`,
              text: section.h3_1,
              marks: []
            }],
            markDefs: []
          });
          
          // コンテンツ1
          newBody.push({
            _type: 'block',
            _key: `content-${sectionIndex + 1}-1`,
            style: 'normal',
            children: [{
              _type: 'span',
              _key: `content-${sectionIndex + 1}-1-span`,
              text: section.content_1,
              marks: []
            }],
            markDefs: []
          });
          
          // H3見出し2
          newBody.push({
            _type: 'block',
            _key: `h3-${sectionIndex + 1}-2`,
            style: 'h3',
            children: [{
              _type: 'span',
              _key: `h3-${sectionIndex + 1}-2-span`,
              text: section.h3_2,
              marks: []
            }],
            markDefs: []
          });
          
          // コンテンツ2
          newBody.push({
            _type: 'block',
            _key: `content-${sectionIndex + 1}-2`,
            style: 'normal',
            children: [{
              _type: 'span',
              _key: `content-${sectionIndex + 1}-2-span`,
              text: section.content_2,
              marks: []
            }],
            markDefs: []
          });
        });
        
        // 概要文生成
        const newExcerpt = article.content.intro.substring(0, 120) + '...';
        
        // 記事を更新
        await client
          .patch(article.id)
          .set({
            body: newBody,
            excerpt: newExcerpt,
            _updatedAt: new Date().toISOString()
          })
          .commit();
        
        console.log(`✅ 完了: ${article.title.substring(0, 40)}...`);
        successCount++;
        
        // APIレート制限対策
        await new Promise(resolve => setTimeout(resolve, 1000));
        
      } catch (error) {
        console.error(`❌ エラー: ${article.title.substring(0, 40)}... - ${error.message}`);
        errorCount++;
      }
    }
    
    console.log('\n📊 バッチ処理結果 (第2弾):');
    console.log(`✅ 成功: ${successCount}件`);
    console.log(`❌ エラー: ${errorCount}件`);
    console.log('各記事: 約800-900文字に拡充、H2×2 + H3×4構造で充実化');
    console.log('\n🎯 PHASE 1進捗: 8/39件 完了 (20.5%)');
    
  } catch (error) {
    console.error('❌ バッチ処理エラー:', error.message);
  }
}

batchExpandCriticalArticles2();