const { createClient } = require('@sanity/client');

const client = createClient({
  projectId: 'aoxze287',
  dataset: 'production',
  apiVersion: '2024-01-01',
  useCdn: false,
  token: process.env.SANITY_API_TOKEN
});

async function expandTwentyFirstArticle() {
  try {
    console.log('ç¬¬21è¨˜äº‹ã®æ›´æ–°ã‚’é–‹å§‹ã—ã¾ã™...');
    console.log('å¯¾è±¡: toyama-city-shrine-sakura-6 (æœ6æ™‚ã®è­·å›½ç¥ç¤¾ã®æ¡œ)');
    
    // è¨˜äº‹ã‚’å–å¾—
    const post = await client.fetch('*[_type == "post" && slug.current == "toyama-city-shrine-sakura-6"][0] { _id, title, body, youtubeUrl }');
    
    if (!post) {
      console.log('è¨˜äº‹ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ');
      return;
    }
    
    console.log('è¨˜äº‹ã‚¿ã‚¤ãƒˆãƒ«:', post.title);
    console.log('YouTube URL:', post.youtubeUrl ? 'ã‚ã‚Š' : 'ãªã—');
    
    // ç¾åœ¨ã®çŠ¶æ…‹ç¢ºèª
    let totalChars = 0;
    post.body.forEach(block => {
      if (block._type === 'block' && block.children) {
        const text = block.children.map(child => child.text).join('');
        totalChars += text.length;
      }
    });
    
    console.log(`ç¾åœ¨ã®æ–‡å­—æ•°: ${totalChars}æ–‡å­—`);
    console.log('ç›®æ¨™: 800-1000æ–‡å­—ã«æ‹¡å¼µ');
    
    // ã‚·ãƒ£ãƒ«ãƒ­ãƒƒãƒ†è¨˜äº‹ã®æ§‹æˆã‚’å‚è€ƒã«ã€è­·å›½ç¥ç¤¾ã®æ¡œã®è¨˜äº‹ã‚’æ‹¡å¼µ
    const expandedContent = [
      // å°å…¥æ–‡ï¼ˆç´„95æ–‡å­—ï¼‰
      {
        _type: 'block',
        _key: 'intro',
        style: 'normal',
        children: [{ _type: 'span', text: 'æœ6æ™‚ã®å¯Œå±±çœŒè­·å›½ç¥ç¤¾ã€‚èš¤ã®å¸‚ã®æº–å‚™ãŒå§‹ã¾ã‚‹é™å¯‚ãªæ™‚é–“ã«å’²ãæ¡œã¯ã€ç¥è–ãªå ´æ‰€ãªã‚‰ã§ã¯ã®ç‰¹åˆ¥ãªç¾ã—ã•ã‚’è¦‹ã›ã¦ãã‚Œã¾ã™ã€‚', marks: [] }],
        markDefs: []
      },
      
      // H2: å¯Œå±±çœŒè­·å›½ç¥ç¤¾ã®æ­´å²ã¨æ„ç¾©ï¼ˆç´„175æ–‡å­—ï¼‰
      {
        _type: 'block',
        _key: 'h2-shrine',
        style: 'h2',
        children: [{ _type: 'span', text: 'å¯Œå±±çœŒè­·å›½ç¥ç¤¾ã®æ­´å²ã¨ç¥è–ãªæ„ç¾©', marks: [] }],
        markDefs: []
      },
      {
        _type: 'block',
        _key: 'shrine-content',
        style: 'normal',
        children: [{ _type: 'span', text: 'å¯Œå±±çœŒè­·å›½ç¥ç¤¾ã¯ã€æˆ¦æ²¡è€…ã®è‹±éœŠã‚’ç¥€ã‚‹ç¥è–ãªå ´æ‰€ã¨ã—ã¦ã€é•·å¹´ã«ã‚ãŸã£ã¦å¯Œå±±çœŒæ°‘ã®å¿ƒã®æ”¯ãˆã¨ãªã£ã¦ãã¾ã—ãŸã€‚å¢ƒå†…ã¯éƒ½å¸‚éƒ¨ã«ã‚ã‚ŠãªãŒã‚‰é™å¯‚ã«åŒ…ã¾ã‚Œã€è¨ªã‚Œã‚‹äººã€…ã«å®‰ã‚‰ãã¨å³ç²›ã•ã‚’ä¸ãˆã¦ãã‚Œã¾ã™ã€‚æ˜¥ã«ãªã‚‹ã¨å¢ƒå†…ã«å’²ãæ¡œã¯ã€è‹±éœŠã¸ã®æ„Ÿè¬ã¨å¹³å’Œã¸ã®é¡˜ã„ã‚’è¾¼ã‚ãŸç¾ã—ã„å…‰æ™¯ã‚’ä½œã‚Šå‡ºã—ã¾ã™ã€‚ç¥ç¤¾ã¯åœ°åŸŸã®æ–‡åŒ–çš„ä¸­å¿ƒåœ°ã¨ã—ã¦ã‚‚æ©Ÿèƒ½ã—ã¦ãŠã‚Šã€å­£ç¯€ã®ç¥­ã‚Šã‚„è¡Œäº‹ã‚’é€šã˜ã¦åœ°åŸŸã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã®çµæŸã‚’æ·±ã‚ã‚‹å ´æ‰€ã§ã‚‚ã‚ã‚Šã¾ã™ã€‚æœã®é™å¯‚ãªæ™‚é–“å¸¯ã¯ç‰¹ã«ç¥è–ãªé›°å›²æ°—ãŒæ¼‚ã„ã€å¿ƒã‚’æ¸…ã‚ã‚‹è²´é‡ãªã²ã¨ã¨ãã‚’éã”ã™ã“ã¨ãŒã§ãã¾ã™ã€‚', marks: [] }],
        markDefs: []
      },
      
      // H2: æœ6æ™‚ã®ç‰¹åˆ¥ãªé­…åŠ›ï¼ˆç´„165æ–‡å­—ï¼‰
      {
        _type: 'block',
        _key: 'h2-morning',
        style: 'h2',
        children: [{ _type: 'span', text: 'æœ6æ™‚ã®ç¥ç¤¾ãŒæŒã¤ç‰¹åˆ¥ãªé­…åŠ›', marks: [] }],
        markDefs: []
      },
      {
        _type: 'block',
        _key: 'morning-content',
        style: 'normal',
        children: [{ _type: 'span', text: 'æœ6æ™‚ã¨ã„ã†æ—©æœã®æ™‚é–“å¸¯ã¯ã€è­·å›½ç¥ç¤¾ã®æœ€ã‚‚ç¾ã—ã„ç¬é–“ã®ä¸€ã¤ã§ã™ã€‚ã¾ã äººå½±ã‚‚ã¾ã°ã‚‰ãªå¢ƒå†…ã«ã¯ã€æ¾„ã‚“ã æœã®ç©ºæ°—ã¨é³¥ã®ã•ãˆãšã‚Šã ã‘ãŒéŸ¿ãã¾ã™ã€‚ã“ã®æ™‚é–“ã®æ¡œã¯æœéœ²ã«æ¿¡ã‚Œã¦ä¸€å±¤ç¾ã—ãã€æŸ”ã‚‰ã‹ãªæœæ—¥ã«ç…§ã‚‰ã•ã‚Œã¦ç¥ã€…ã—ã„è¼ãã‚’æ”¾ã¡ã¾ã™ã€‚æ—¥ä¸­ã®å–§é¨’ã¨ã¯å…¨ãç•°ãªã‚‹ã€é™è¬ã§ç¥ç§˜çš„ãªé›°å›²æ°—ãŒå¢ƒå†…å…¨ä½“ã‚’åŒ…ã¿è¾¼ã‚“ã§ã„ã¾ã™ã€‚æ—©èµ·ãã—ãŸåœ°å…ƒã®æ–¹ã€…ãŒé™ã‹ã«å‚æ‹ã•ã‚Œã‚‹å§¿ã‚‚è¦‹ã‚‰ã‚Œã€æ—¥å¸¸ã®ä¸­ã«ã‚ã‚‹ä¿¡ä»°ã®æ·±ã•ã‚’æ„Ÿã˜ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã“ã®ç‰¹åˆ¥ãªæ™‚é–“ã¯ã€éƒ½å¸‚éƒ¨ã«ã„ãªãŒã‚‰è‡ªç„¶ã¨ç¥è–ã•ã‚’åŒæ™‚ã«æ„Ÿã˜ã‚‰ã‚Œã‚‹è²´é‡ãªä½“é¨“ã§ã™ã€‚', marks: [] }],
        markDefs: []
      },
      
      // H2: èš¤ã®å¸‚ã®æº–å‚™é¢¨æ™¯ï¼ˆç´„155æ–‡å­—ï¼‰
      {
        _type: 'block',
        _key: 'h2-flea-market',
        style: 'h2',
        children: [{ _type: 'span', text: 'èš¤ã®å¸‚æº–å‚™ã®é¢¨æƒ…ã‚ã‚‹å…‰æ™¯', marks: [] }],
        markDefs: []
      },
      {
        _type: 'block',
        _key: 'flea-market-content',
        style: 'normal',
        children: [{ _type: 'span', text: 'å¯Œå±±çœŒè­·å›½ç¥ç¤¾ã§ã¯å®šæœŸçš„ã«èš¤ã®å¸‚ãŒé–‹å‚¬ã•ã‚Œã€æœ6æ™‚é ƒã‹ã‚‰å‡ºåº—è€…ã®æ–¹ã€…ãŒæº–å‚™ã‚’å§‹ã‚ã¾ã™ã€‚æ¡œã®å­£ç¯€ã®èš¤ã®å¸‚æº–å‚™ã¯ç‰¹ã«é¢¨æƒ…ãŒã‚ã‚Šã€èŠ±ã³ã‚‰ãŒèˆã„æ•£ã‚‹ä¸­ã§ãƒ†ãƒ³ãƒˆã‚’è¨­å–¶ã—ãŸã‚Šå•†å“ã‚’ä¸¦ã¹ãŸã‚Šã™ã‚‹å…‰æ™¯ã¯ã€æ—¥æœ¬ã®æ˜¥ã®é¢¨ç‰©è©©ãã®ã‚‚ã®ã§ã™ã€‚å‡ºåº—è€…ã®æ–¹ã€…ã®é™ã‹ãªä¼šè©±ã¨ä½œæ¥­ã®éŸ³ãŒã€ç¥ç¤¾ã®ç¥è–ãªé™å¯‚ã«æº¶ã‘è¾¼ã‚“ã§ã„ãã¾ã™ã€‚ã“ã®æº–å‚™æ™‚é–“ã¯ã€å¾Œã«è³‘ã‚ã†èš¤ã®å¸‚ã®å‰ã®é™ã‹ãªå‰å¥æ›²ã®ã‚ˆã†ãªæ™‚é–“ã§ã€æ¡œã¨å…±ã«å­£ç¯€ã®ç§»ã‚ã„ã‚’æ„Ÿã˜ã•ã›ã¦ãã‚Œã¾ã™ã€‚æº–å‚™ã«æºã‚ã‚‹äººã€…ã®ä¸å¯§ãªæ‰€ä½œã‹ã‚‰ã¯ã€ã“ã®å ´æ‰€ã¸ã®æ•¬æ„ãŒæ„Ÿã˜ã‚‰ã‚Œã¾ã™ã€‚', marks: [] }],
        markDefs: []
      },
      
      // H2: æ¡œã¨ç¥è–ãªå ´æ‰€ã®èª¿å’Œï¼ˆç´„145æ–‡å­—ï¼‰
      {
        _type: 'block',
        _key: 'h2-harmony',
        style: 'h2',
        children: [{ _type: 'span', text: 'æ¡œã¨ç¥è–ãªå ´æ‰€ãŒç”Ÿã¿å‡ºã™èª¿å’Œ', marks: [] }],
        markDefs: []
      },
      {
        _type: 'block',
        _key: 'harmony-content',
        style: 'normal',
        children: [{ _type: 'span', text: 'è­·å›½ç¥ç¤¾ã®æ¡œã¯ã€å˜ãªã‚‹å­£ç¯€ã®èŠ±ä»¥ä¸Šã®æ„å‘³ã‚’æŒã£ã¦ã„ã¾ã™ã€‚ç¥è–ãªå ´æ‰€ã«å’²ãæ¡œã¯ã€ç”Ÿå‘½ã®ç¾ã—ã•ã¨å„šã•ã‚’åŒæ™‚ã«è¡¨ç¾ã—ã€å‚æ‹è€…ã®å¿ƒã«æ·±ã„æ„Ÿå‹•ã‚’ä¸ãˆã¾ã™ã€‚æˆ¦æ²¡è€…ã¸ã®è¿½æ‚¼ã®æ„å‘³ã‚‚è¾¼ã‚ã‚‰ã‚ŒãŸæ¡œã¯ã€å¹³å’Œã¸ã®é¡˜ã„ã¨æ„Ÿè¬ã®æ°—æŒã¡ã‚’è¡¨ç¾ã™ã‚‹è±¡å¾´ã§ã‚‚ã‚ã‚Šã¾ã™ã€‚æœã®é™å¯‚ãªæ™‚é–“ã«å’²ãæ¡œã‚’çœºã‚ã¦ã„ã‚‹ã¨ã€æ—¥å¸¸ã®å¿™ã—ã•ã‚’å¿˜ã‚Œã€ç”Ÿãã‚‹ã“ã¨ã®å°Šã•ã«ã¤ã„ã¦æ·±ãè€ƒãˆã•ã›ã‚‰ã‚Œã¾ã™ã€‚ç¥ç¤¾ã¨ã„ã†è–åŸŸã¨æ¡œã®ç¾ã—ã•ãŒç¹”ã‚Šãªã™èª¿å’Œã¯ã€è¨ªã‚Œã‚‹äººã€…ã®å¿ƒã‚’æµ„åŒ–ã—ã¦ãã‚Œã‚‹ç‰¹åˆ¥ãªåŠ›ã‚’æŒã£ã¦ã„ã¾ã™ã€‚', marks: [] }],
        markDefs: []
      },
      
      // H2: æ—©æœå‚æ‹ã®ã™ã™ã‚ï¼ˆç´„130æ–‡å­—ï¼‰
      {
        _type: 'block',
        _key: 'h2-visit',
        style: 'h2',
        children: [{ _type: 'span', text: 'æ—©æœå‚æ‹ã¨æ¡œé‘‘è³ã®ã™ã™ã‚', marks: [] }],
        markDefs: []
      },
      {
        _type: 'block',
        _key: 'visit-content',
        style: 'normal',
        children: [{ _type: 'span', text: 'å¯Œå±±çœŒè­·å›½ç¥ç¤¾ã§ã®æ—©æœå‚æ‹ã¯ã€å¿ƒèº«ã‚’æ¸…ã‚ã‚‹ç´ æ™´ã‚‰ã—ã„ä½“é¨“ã§ã™ã€‚æ¡œã®å­£ç¯€ã®æ—©æœå‚æ‹ã¯ç‰¹ã«ãŠã™ã™ã‚ã§ã€é™å¯‚ãªå¢ƒå†…ã§æ¡œã‚’ç‹¬å ã§ãã‚‹è´…æ²¢ãªæ™‚é–“ã‚’éã”ã›ã¾ã™ã€‚å‚æ‹å¾Œã¯å¢ƒå†…ã‚’ã‚†ã£ãã‚Šã¨æ•£ç­–ã—ã€æ§˜ã€…ãªè§’åº¦ã‹ã‚‰æ¡œã‚’é‘‘è³ã—ã¦ã¿ã¦ãã ã•ã„ã€‚æ—©æœã®ãŸã‚é§è»Šå ´ã‚‚ç©ºã„ã¦ãŠã‚Šã€ã‚†ã£ãŸã‚Šã¨éã”ã™ã“ã¨ãŒã§ãã¾ã™ã€‚ã‚«ãƒ¡ãƒ©ã‚’æŒå‚ã™ã‚Œã°ã€æœæ—¥ã«ç…§ã‚‰ã•ã‚ŒãŸç¾ã—ã„æ¡œã®å†™çœŸã‚’æ’®å½±ã§ãã¾ã™ã€‚å¿ƒãŒæ´—ã‚ã‚Œã‚‹ã‚ˆã†ãªæ¸…ã€…ã—ã„ä½“é¨“ã‚’ãœã²å‘³ã‚ã£ã¦ãã ã•ã„ã€‚', marks: [] }],
        markDefs: []
      },
      
      // H2: ã¾ã¨ã‚ï¼ˆç´„90æ–‡å­—ï¼‰
      {
        _type: 'block',
        _key: 'h2-summary',
        style: 'h2',
        children: [{ _type: 'span', text: 'ã¾ã¨ã‚', marks: [] }],
        markDefs: []
      },
      {
        _type: 'block',
        _key: 'summary-content',
        style: 'normal',
        children: [{ _type: 'span', text: 'æœ6æ™‚ã®å¯Œå±±çœŒè­·å›½ç¥ç¤¾ã®æ¡œã¯ã€ç¥è–ã•ã¨è‡ªç„¶ã®ç¾ã—ã•ãŒèª¿å’Œã—ãŸç‰¹åˆ¥ãªå…‰æ™¯ã§ã™ã€‚æ—©æœã®é™å¯‚ãªæ™‚é–“ã«ã€å¿ƒæ´—ã‚ã‚Œã‚‹ã²ã¨ã¨ãã‚’ãŠéã”ã—ãã ã•ã„ã€‚', marks: [] }],
        markDefs: []
      }
    ];
    
    // æ–‡å­—æ•°ã‚«ã‚¦ãƒ³ãƒˆ
    let newTotalChars = 0;
    expandedContent.forEach(block => {
      if (block._type === 'block' && block.children) {
        const text = block.children.map(child => child.text).join('');
        newTotalChars += text.length;
      }
    });
    
    console.log(`æ–°ã—ã„æ–‡å­—æ•°: ${newTotalChars}æ–‡å­—`);
    console.log('æ–°ã—ã„æ§‹æˆ: H2è¦‹å‡ºã—6å€‹ã®çµ±ä¸€æ§‹é€ ');
    
    // è¨˜äº‹ã‚’æ›´æ–°
    await client
      .patch(post._id)
      .set({ body: expandedContent })
      .commit();
    
    console.log('âœ… ç¬¬21è¨˜äº‹ã®æ›´æ–°ãŒå®Œäº†ã—ã¾ã—ãŸ');
    console.log('ğŸ“‹ 180æ–‡å­—â†’' + newTotalChars + 'æ–‡å­—ã«æ‹¡å¼µ');
    console.log('ğŸ—ï¸ H2è¦‹å‡ºã—6å€‹ã®çµ±ä¸€æ§‹é€ ã‚’é©ç”¨');
    
    // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢
    await client
      .patch(post._id)
      .set({ _updatedAt: new Date().toISOString() })
      .commit();
    
    console.log('ğŸ”„ ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢å®Ÿè¡Œå®Œäº†');
    
  } catch (error) {
    console.error('âŒ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ:', error);
    throw error;
  }
}

expandTwentyFirstArticle();