const { createClient } = require('@sanity/client');

const client = createClient({
  projectId: 'aoxze287',
  dataset: 'production',
  apiVersion: '2024-01-01',
  useCdn: false,
  token: process.env.SANITY_API_TOKEN
});

async function expandTwentyThirdArticle() {
  try {
    console.log('ç¬¬23è¨˜äº‹ã®æ›´æ–°ã‚’é–‹å§‹ã—ã¾ã™...');
    console.log('å¯¾è±¡: uozu-city-cake (å³¶å´æ¾æœˆå ‚ã®ã‚±ãƒ¼ã‚­)');
    
    // è¨˜äº‹ã‚’å–å¾—
    const post = await client.fetch('*[_type == "post" && slug.current == "uozu-city-cake"][0] { _id, title, body, youtubeUrl }');
    
    if (!post) {
      console.log('è¨˜äº‹ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ');
      return;
    }
    
    console.log('è¨˜äº‹ã‚¿ã‚¤ãƒˆãƒ«:', post.title);
    console.log('YouTube URL:', post.youtubeUrl ? 'ã‚ã‚Š' : 'ãªã—');
    
    // ç¾åœ¨ã®çŠ¶æ…‹ç¢ºèª
    let totalChars = 0;
    post.body.forEach(block => {
      if (block._type === 'block' && block.children) {
        const text = block.children.map(child => child.text).join('');
        totalChars += text.length;
      }
    });
    
    console.log(`ç¾åœ¨ã®æ–‡å­—æ•°: ${totalChars}æ–‡å­—`);
    console.log('ç›®æ¨™: 800-1000æ–‡å­—ã«æ‹¡å¼µ');
    
    // çµ±ä¸€æ§‹é€ ã‚’å‚è€ƒã«ã€å³¶å´æ¾æœˆå ‚ã®è¨˜äº‹ã‚’æ…é‡ã«æ‹¡å¼µ
    const expandedContent = [
      // å°å…¥æ–‡ï¼ˆç´„85æ–‡å­—ï¼‰
      {
        _type: 'block',
        _key: 'intro',
        style: 'normal',
        children: [{ _type: 'span', text: 'é­šæ´¥å¸‚ã«ã‚ã‚‹å³¶å´æ¾æœˆå ‚ã¯ã€é©šãã»ã©ãŠæ‰‹é ƒãªä¾¡æ ¼ã§ç¾å‘³ã—ã„ã‚±ãƒ¼ã‚­ã‚’æä¾›ã™ã‚‹åœ°å…ƒã§æ„›ã•ã‚Œã‚‹è€èˆ—æ´‹è“å­åº—ã§ã™ã€‚', marks: [] }],
        markDefs: []
      },
      
      // H2: å³¶å´æ¾æœˆå ‚ã®æ­´å²ï¼ˆç´„175æ–‡å­—ï¼‰
      {
        _type: 'block',
        _key: 'h2-history',
        style: 'h2',
        children: [{ _type: 'span', text: 'å³¶å´æ¾æœˆå ‚ã®æ­´å²ã¨åœ°åŸŸã§ã®è©•åˆ¤', marks: [] }],
        markDefs: []
      },
      {
        _type: 'block',
        _key: 'history-content',
        style: 'normal',
        children: [{ _type: 'span', text: 'å³¶å´æ¾æœˆå ‚ã¯é­šæ´¥å¸‚ã§é•·å¹´ã«ã‚ãŸã£ã¦å–¶æ¥­ã‚’ç¶šã‘ã¦ã„ã‚‹è€èˆ—ã®æ´‹è“å­åº—ã§ã™ã€‚å‰µæ¥­ä»¥æ¥ã€åœ°å…ƒã®äººã€…ã®ç‰¹åˆ¥ãªæ—¥ã‚’å½©ã‚‹ã‚±ãƒ¼ã‚­ã‚’ä½œã‚Šç¶šã‘ã¦ãŠã‚Šã€èª•ç”Ÿæ—¥ã‚„è¨˜å¿µæ—¥ã«ã¯å¤šãã®å®¶æ—ãŒã“ã®ãŠåº—ã‚’è¨ªã‚Œã¾ã™ã€‚ä»£ã€…å—ã‘ç¶™ãŒã‚Œã¦ããŸè£½è“æŠ€è¡“ã¨ã€ãŠå®¢æ§˜ã‚’å¤§åˆ‡ã«ã™ã‚‹å¿ƒã¯ã€ç¾åœ¨ã§ã‚‚å¤‰ã‚ã‚‹ã“ã¨ãªãåº—ã®æ ¹å¹¹ã‚’æˆã—ã¦ã„ã¾ã™ã€‚é­šæ´¥å¸‚æ°‘ã«ã¨ã£ã¦ã€å³¶å´æ¾æœˆå ‚ã®ã‚±ãƒ¼ã‚­ã¯ç‰¹åˆ¥ãªæ€ã„å‡ºã¨çµã³ã¤ã„ã¦ãŠã‚Šã€ã€Œæ¾æœˆå ‚ã®ã‚±ãƒ¼ã‚­ã§è‚²ã£ãŸã€ã¨ã„ã†äººã‚‚å°‘ãªãã‚ã‚Šã¾ã›ã‚“ã€‚ãã®ä¿¡é ¼ã¨å®Ÿç¸¾ãŒã€ç¾åœ¨ã®ç¢ºå›ºãŸã‚‹åœ°ä½ã‚’ç¯‰ã„ã¦ã„ã¾ã™ã€‚', marks: [] }],
        markDefs: []
      },
      
      // H2: é©šãã®ä¾¡æ ¼è¨­å®šï¼ˆç´„165æ–‡å­—ï¼‰
      {
        _type: 'block',
        _key: 'h2-price',
        style: 'h2',
        children: [{ _type: 'span', text: 'é©šãã»ã©ãŠæ‰‹é ƒãªä¾¡æ ¼è¨­å®šã®ç§˜å¯†', marks: [] }],
        markDefs: []
      },
      {
        _type: 'block',
        _key: 'price-content',
        style: 'normal',
        children: [{ _type: 'span', text: 'å³¶å´æ¾æœˆå ‚ã®æœ€å¤§ã®é­…åŠ›ã®ä¸€ã¤ã¯ã€ãã®é©šãã»ã©ãŠæ‰‹é ƒãªä¾¡æ ¼è¨­å®šã§ã™ã€‚é«˜å“è³ªãªã‚±ãƒ¼ã‚­ã§ã‚ã‚ŠãªãŒã‚‰ã€ä»–åº—ã¨æ¯”ã¹ã¦éå¸¸ã«ãƒªãƒ¼ã‚ºãƒŠãƒ–ãƒ«ãªä¾¡æ ¼ã§æä¾›ã•ã‚Œã¦ãŠã‚Šã€å®¶è¨ˆã«å„ªã—ã„ä¾¡æ ¼è¨­å®šã¨ãªã£ã¦ã„ã¾ã™ã€‚ã“ã®ä¾¡æ ¼ã‚’å®Ÿç¾ã§ãã‚‹ã®ã¯ã€åœ°åŸŸå¯†ç€å‹ã®çµŒå–¶æ–¹é‡ã¨ã€ãŠå®¢æ§˜ã«å–œã‚“ã§ã‚‚ã‚‰ã„ãŸã„ã¨ã„ã†åº—ä¸»ã®å¼·ã„æƒ³ã„ãŒã‚ã‚‹ã‹ã‚‰ã§ã™ã€‚ææ–™è²»ãŒé«˜é¨°ã™ã‚‹ä¸­ã§ã‚‚ã€ã§ãã‚‹é™ã‚Šä¾¡æ ¼ã‚’æŠ‘ãˆã¦æä¾›ã—ç¶šã‘ã‚‹å§¿å‹¢ã¯ã€å¤šãã®å¸¸é€£å®¢ã‹ã‚‰æ„›ã•ã‚Œç¶šã‘ã‚‹ç†ç”±ã¨ãªã£ã¦ã„ã¾ã™ã€‚ã‚³ã‚¹ãƒˆãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®é«˜ã•ã¯é­šæ´¥å¸‚å†…ã§ã‚‚è©•åˆ¤ã§ã€é æ–¹ã‹ã‚‰ã‚ã–ã‚ã–è²·ã„ã«æ¥ã‚‹äººã‚‚å¤šã„ã»ã©ã§ã™ã€‚', marks: [] }],
        markDefs: []
      },
      
      // H2: ã‚±ãƒ¼ã‚­ã®ç¨®é¡ã¨å“è³ªï¼ˆç´„155æ–‡å­—ï¼‰
      {
        _type: 'block',
        _key: 'h2-quality',
        style: 'h2',
        children: [{ _type: 'span', text: 'è±Šå¯Œãªç¨®é¡ã¨ç¢ºã‹ãªå“è³ªã®ã‚±ãƒ¼ã‚­', marks: [] }],
        markDefs: []
      },
      {
        _type: 'block',
        _key: 'quality-content',
        style: 'normal',
        children: [{ _type: 'span', text: 'å³¶å´æ¾æœˆå ‚ã§ã¯ã€ã‚·ãƒ§ãƒ¼ãƒˆã‚±ãƒ¼ã‚­ã‚„ãƒãƒ§ã‚³ãƒ¬ãƒ¼ãƒˆã‚±ãƒ¼ã‚­ãªã©ã®å®šç•ªå•†å“ã‹ã‚‰ã€å­£ç¯€é™å®šã®ç‰¹è£½ã‚±ãƒ¼ã‚­ã¾ã§ã€å¹…åºƒã„ç¨®é¡ã®ã‚±ãƒ¼ã‚­ã‚’å–ã‚Šæƒãˆã¦ã„ã¾ã™ã€‚ã©ã®ã‚±ãƒ¼ã‚­ã‚‚è·äººãŒä¸€ã¤ä¸€ã¤ä¸å¯§ã«æ‰‹ä½œã‚Šã—ã¦ãŠã‚Šã€æ–°é®®ãªææ–™ã‚’ä½¿ç”¨ã—ãŸç¢ºã‹ãªå“è³ªãŒè‡ªæ…¢ã§ã™ã€‚ç”Ÿã‚¯ãƒªãƒ¼ãƒ ã¯è»½ã‚„ã‹ã§ä¸Šå“ãªç”˜ã•ã€ã‚¹ãƒãƒ³ã‚¸ã¯ã—ã£ã¨ã‚Šã¨ã—ãŸé£Ÿæ„Ÿã§ã€ãƒãƒ©ãƒ³ã‚¹ã®å–ã‚ŒãŸç¾å‘³ã—ã•ãŒç‰¹å¾´ã§ã™ã€‚ç‰¹ã«åœ°å…ƒç”£ã®é£Ÿæã‚’æ´»ç”¨ã—ãŸã‚±ãƒ¼ã‚­ã¯äººæ°—ãŒé«˜ãã€å¯Œå±±ã®ç¾å‘³ã—ã•ã‚’å­˜åˆ†ã«å‘³ã‚ã†ã“ã¨ãŒã§ãã¾ã™ã€‚è¦‹ãŸç›®ã®ç¾ã—ã•ã«ã‚‚ã“ã ã‚ã‚ŠãŒã‚ã‚Šã€å†™çœŸæ˜ ãˆã™ã‚‹ä»•ä¸ŠãŒã‚Šã§ã™ã€‚', marks: [] }],
        markDefs: []
      },
      
      // H2: åœ°åŸŸã¨ã®çµã³ã¤ãï¼ˆç´„145æ–‡å­—ï¼‰
      {
        _type: 'block',
        _key: 'h2-community',
        style: 'h2',
        children: [{ _type: 'span', text: 'åœ°åŸŸã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã¨ã®æ·±ã„çµã³ã¤ã', marks: [] }],
        markDefs: []
      },
      {
        _type: 'block',
        _key: 'community-content',
        style: 'normal',
        children: [{ _type: 'span', text: 'å³¶å´æ¾æœˆå ‚ã¯é­šæ´¥å¸‚ã®åœ°åŸŸã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã¨æ·±ãçµã³ã¤ã„ãŸå­˜åœ¨ã§ã™ã€‚åœ°å…ƒã®å­¦æ ¡è¡Œäº‹ã‚„åœ°åŸŸã®ã‚¤ãƒ™ãƒ³ãƒˆãªã©ã€æ§˜ã€…ãªå ´é¢ã§åŒåº—ã®ã‚±ãƒ¼ã‚­ãŒåˆ©ç”¨ã•ã‚Œã¦ãŠã‚Šã€å¸‚æ°‘ã®æš®ã‚‰ã—ã«æ¬ ã‹ã›ãªã„ãŠåº—ã¨ãªã£ã¦ã„ã¾ã™ã€‚ãŠå®¢æ§˜ã¨ã®æ¸©ã‹ã„ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚‚å¤§åˆ‡ã«ã—ã¦ãŠã‚Šã€å¸¸é€£ã®ãŠå®¢æ§˜ã®å¥½ã¿ã‚’è¦šãˆã¦ã€ãŠã™ã™ã‚ã®ã‚±ãƒ¼ã‚­ã‚’ææ¡ˆã—ã¦ãã‚Œã‚‹ã“ã¨ã‚‚ã‚ã‚Šã¾ã™ã€‚åœ°åŸŸã®äººã€…ã«ã¨ã£ã¦ã€å˜ãªã‚‹ã‚±ãƒ¼ã‚­å±‹ã•ã‚“ã§ã¯ãªãã€ç”Ÿæ´»ã®ä¸€éƒ¨ã¨ã—ã¦æ„›ã•ã‚Œç¶šã‘ã¦ã„ã‚‹ç‰¹åˆ¥ãªå­˜åœ¨ã§ã™ã€‚', marks: [] }],
        markDefs: []
      },
      
      // H2: åˆ©ç”¨ã®ã™ã™ã‚ï¼ˆç´„130æ–‡å­—ï¼‰
      {
        _type: 'block',
        _key: 'h2-recommendation',
        style: 'h2',
        children: [{ _type: 'span', text: 'å³¶å´æ¾æœˆå ‚åˆ©ç”¨æ™‚ã®ãŠã™ã™ã‚ãƒã‚¤ãƒ³ãƒˆ', marks: [] }],
        markDefs: []
      },
      {
        _type: 'block',
        _key: 'recommendation-content',
        style: 'normal',
        children: [{ _type: 'span', text: 'å³¶å´æ¾æœˆå ‚ã‚’è¨ªã‚Œã‚‹éš›ã¯ã€äº‹å‰ã«é›»è©±ã§åœ¨åº«ã‚’ç¢ºèªã™ã‚‹ã“ã¨ã‚’ãŠã™ã™ã‚ã—ã¾ã™ã€‚äººæ°—å•†å“ã¯å£²ã‚Šåˆ‡ã‚Œã‚‹ã“ã¨ã‚‚ã‚ã‚‹ãŸã‚ã§ã™ã€‚èª•ç”Ÿæ—¥ã‚±ãƒ¼ã‚­ãªã©ç‰¹åˆ¥ãªæ³¨æ–‡ã¯ã€å‰æ—¥ã¾ã§ã®äºˆç´„ãŒãŠã™ã™ã‚ã§ã™ã€‚ãŠæ‰‹é ƒä¾¡æ ¼ãªã®ã§ã€ã„ãã¤ã‹ã®ç¨®é¡ã‚’è³¼å…¥ã—ã¦é£Ÿã¹æ¯”ã¹ã‚’æ¥½ã—ã‚€ã®ã‚‚è‰¯ã„ã§ã—ã‚‡ã†ã€‚é§è»Šå ´ã‚‚å®Œå‚™ã•ã‚Œã¦ã„ã‚‹ãŸã‚ã€è»Šã§ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚‚ä¾¿åˆ©ã§ã™ã€‚é­šæ´¥å¸‚ã‚’è¨ªã‚ŒãŸéš›ã¯ã€ãœã²åœ°å…ƒã®å‘³ã‚’ä½“é¨“ã—ã¦ã¿ã¦ãã ã•ã„ã€‚', marks: [] }],
        markDefs: []
      },
      
      // H2: ã¾ã¨ã‚ï¼ˆç´„85æ–‡å­—ï¼‰
      {
        _type: 'block',
        _key: 'h2-summary',
        style: 'h2',
        children: [{ _type: 'span', text: 'ã¾ã¨ã‚', marks: [] }],
        markDefs: []
      },
      {
        _type: 'block',
        _key: 'summary-content',
        style: 'normal',
        children: [{ _type: 'span', text: 'å³¶å´æ¾æœˆå ‚ã¯é­šæ´¥å¸‚ãŒèª‡ã‚‹ãŠæ‰‹é ƒä¾¡æ ¼ã®æ´‹è“å­åº—ã§ã™ã€‚ç¢ºã‹ãªå“è³ªã¨æ¸©ã‹ã„ã‚µãƒ¼ãƒ“ã‚¹ã®ã‚±ãƒ¼ã‚­ã‚’ãœã²å‘³ã‚ã£ã¦ã¿ã¦ãã ã•ã„ã€‚', marks: [] }],
        markDefs: []
      }
    ];
    
    // æ–‡å­—æ•°ã‚«ã‚¦ãƒ³ãƒˆ
    let newTotalChars = 0;
    expandedContent.forEach(block => {
      if (block._type === 'block' && block.children) {
        const text = block.children.map(child => child.text).join('');
        newTotalChars += text.length;
      }
    });
    
    console.log(`æ–°ã—ã„æ–‡å­—æ•°: ${newTotalChars}æ–‡å­—`);
    console.log('æ–°ã—ã„æ§‹æˆ: H2è¦‹å‡ºã—6å€‹ã®çµ±ä¸€æ§‹é€ ');
    
    // è¨˜äº‹ã‚’æ…é‡ã«æ›´æ–°
    await client
      .patch(post._id)
      .set({ body: expandedContent })
      .commit();
    
    console.log('âœ… ç¬¬23è¨˜äº‹ã®æ›´æ–°ãŒå®Œäº†ã—ã¾ã—ãŸ');
    console.log('ğŸ“‹ 182æ–‡å­—â†’' + newTotalChars + 'æ–‡å­—ã«æ‹¡å¼µ');
    console.log('ğŸ—ï¸ H2è¦‹å‡ºã—6å€‹ã®çµ±ä¸€æ§‹é€ ã‚’é©ç”¨');
    
    // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢
    await client
      .patch(post._id)
      .set({ _updatedAt: new Date().toISOString() })
      .commit();
    
    console.log('ğŸ”„ ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢å®Ÿè¡Œå®Œäº†');
    
  } catch (error) {
    console.error('âŒ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ:', error);
    throw error;
  }
}

expandTwentyThirdArticle();