const { createClient } = require('@sanity/client');

const client = createClient({
  projectId: 'aoxze287',
  dataset: 'production',
  apiVersion: '2024-01-01',
  useCdn: false,
  token: process.env.SANITY_API_TOKEN
});

// 記事データ定義
const articles = [
  {
    id: 34,
    slug: 'toyama-city-taiyaki',
    title: '富山市のたいやき「鯛の陽」',
    content: [
      { intro: '富山市の東富山高校近くにある「鯛の陽」で出会った、すこし小ぶりで愛らしいたいやき。心がほっこりする温かな体験をお伝えします。' },
      { h2: 'たいやき店「鯛の陽」の魅力と特色', text: 'たいやき「鯛の陽」は東富山高校の近くに位置する地元密着型のたいやき専門店です。店名の「鯛の陽」には、太陽のように温かな気持ちをお客様に届けたいという店主の想いが込められています。こちらのたいやきの特徴は、一般的なものより少し小ぶりなサイズで作られていることです。この絶妙なサイズ感が食べやすく、特に女性や子どもたちには大変人気があります。小ぶりながらも中身はしっかりと詰まっており、一口食べれば幸せな気持ちになれる温かな味わいが楽しめます。地域の人々に愛され続けている理由がよく分かる、心のこもったたいやきです。' },
      { h2: '小ぶりサイズの愛らしさと食べやすさ', text: 'このたいやきの最大の魅力は、その小ぶりなサイズにあります。通常のたいやきよりも一回り小さく作られているため、手に持った時の可愛らしさは格別です。食べきりやすいサイズなので、小腹が空いた時や甘いものが少しだけ欲しい時にぴったりです。また、複数個購入して異なる味を楽しんだり、友人や家族とシェアしたりするのにも最適なサイズ感となっています。焼き上がりの香ばしい香りと相まって、見た目の可愛さと美味しさの両方を兼ね備えた特別なたいやきです。このサイズだからこそ実現できる、ちょうど良い食べ応えと満足感を味わうことができます。' },
      { h2: '心温まる店主のおもてなしと店の雰囲気', text: '「鯛の陽」を訪れると、店主の温かな人柄に触れることができます。一つ一つのたいやきを丁寧に焼き上げる姿からは、お客様への心のこもったおもてなしの精神を感じることができます。店内は決して広くはありませんが、アットホームな雰囲気が漂っており、初めて訪れる人でもリラックスして過ごすことができます。焼きたてのたいやきの香りが店内に漂い、それだけで幸せな気持ちになれる特別な空間です。地域の常連客との和やかな会話も聞こえてきて、まさに地域に根差した愛される店であることが伝わってきます。' },
      { h2: 'あんこの上品な甘さと生地の絶妙な食感', text: 'たいやきの中に詰められたあんこは、甘すぎず上品な味わいが特徴的です。小豆の風味がしっかりと感じられ、後味もすっきりとしているため、いくつでも食べたくなる美味しさです。外側の生地は適度な厚みで、表面はサクッとした食感、内側はしっとりとした仕上がりになっています。あんこと生地の絶妙なバランスが、このたいやきの美味しさの秘密です。焼き立ての温かさと相まって、一口食べるごとに幸せが口の中に広がります。季節によっては期間限定の味も提供されることがあり、何度訪れても新しい発見があります。' },
      { h2: '地域に愛される理由と訪問のおすすめ', text: '「鯛の陽」が地域の人々に愛され続ける理由は、美味しさはもちろんのこと、店主の人柄と地域への愛情にあります。学校帰りの学生たちや地域の家族連れなど、幅広い年代の人々が足を運ぶ温かな場所となっています。訪問する際は、焼き立ての時間帯を狙うのがおすすめです。特に午後の時間帯には、香ばしい香りに誘われた多くのお客様で賑わいます。East Toyama High School近くという立地も良く、散歩がてら立ち寄るのにも最適です。心がほっこりする特別な時間を過ごせる、素敵なたいやき店です。' },
      { h2: 'まとめ', text: '富山市の「鯛の陽」は、小ぶりで可愛らしいたいやきと温かなおもてなしが魅力の素敵なお店です。心がほっこりする特別な体験をぜひ味わってみてください。' }
    ]
  },
  {
    id: 35,
    slug: 'toyama-city-24',
    title: 'コストコ非会員対応の24時間無人販売所',
    content: [
      { intro: '富山市にあるコストコ非会員でも利用できる24時間営業の無人販売所「達人の一品 富山店」。便利で革新的なサービスをご紹介します。' },
      { h2: '達人の一品 富山店の革新的なサービス', text: '「達人の一品 富山店」は、コストコの商品を会員でなくても購入できる画期的な無人販売所です。24時間営業という利便性の高さが最大の特徴で、仕事帰りや深夜、早朝など、いつでも好きな時間に買い物ができます。従来のコストコ利用には年会費の支払いと会員登録が必要でしたが、この無人販売所ではそうした手続きなしに人気商品を購入できます。無人販売システムにより運営コストを抑制し、コストコ商品をより身近に感じられる革新的なサービスを実現しています。富山市という地方都市での展開は、全国的にも注目を集めている先進的な取り組みです。' },
      { h2: 'コストコ非会員でも楽しめる商品ラインナップ', text: '達人の一品では、コストコで人気の代表的な商品を厳選して販売しています。大容量パックの冷凍食品、海外ブランドのお菓子、調味料、パンなど、コストコファンにはおなじみの商品が豊富に揃っています。特に人気なのが、コストコの代名詞でもあるロティサリーチキンやマフィン、ベーカリー商品などです。商品は適切な温度管理のもとで保管されており、品質にも十分配慮されています。コストコ会員でない方でも、話題の商品を気軽に試すことができるため、初めてコストコ商品を体験する方にとっても最適な環境が整っています。' },
      { h2: '24時間営業の利便性と無人システム', text: '24時間営業という特徴は、現代の多様なライフスタイルに対応した画期的なサービスです。日中は仕事で忙しい方、夜勤の方、早朝に活動する方など、様々な時間帯で生活する人々にとって非常に便利です。無人販売システムは最新技術を駆使しており、商品の選択から決済まで全てがスムーズに行えます。セキュリティ面でも十分な対策が施されており、安心して利用できる環境が整っています。深夜や早朝の静かな時間帯に、ゆっくりと商品を選ぶことができるのも魅力の一つです。従来の店舗では体験できない、新しい買い物スタイルを楽しむことができます。' },
      { h2: '利用方法と決済システムの便利さ', text: '達人の一品の利用方法は非常にシンプルで、誰でも簡単に買い物を楽しむことができます。店舗入口での身分証明や特別な登録手続きは不要で、一般的なコンビニエンスストアと同様の感覚で利用できます。決済システムも多様な方法に対応しており、現金はもちろん、各種クレジットカードや電子マネー、QRコード決済などが利用可能です。商品の価格は明確に表示されており、コストコ会員価格に適正な手数料が加算された設定となっています。購入後のレシートも発行され、万が一の際のアフターサービスにも対応しています。' },
      { h2: '地域への貢献と今後の展望', text: '達人の一品 富山店は、地域住民の利便性向上に大きく貢献しています。コストコの最寄り店舗が遠方にある地方都市の住民にとって、身近な場所でコストコ商品を購入できることは非常に価値があります。また、24時間営業により、緊急時の食料確保や深夜・早朝の買い物ニーズにも対応しています。このような革新的なサービスは、小売業界の未来を示すモデルケースとしても注目されており、他地域への展開も期待されています。地域密着型でありながら、全国的な影響力を持つ先進的な取り組みとして、今後の発展が楽しみです。' },
      { h2: 'まとめ', text: '達人の一品 富山店は、コストコ非会員でも24時間利用できる革新的な無人販売所です。便利で身近なコストコ商品の購入体験をぜひお試しください。' }
    ]
  },
  {
    id: 36,
    slug: 'toyama-city-6',
    title: '富山市で観察するオニヤンマの産卵行動',
    content: [
      { intro: '富山市の水辺で観察できるオニヤンマの産卵シーン。自然の神秘的な営みと生命力あふれる瞬間をお伝えします。' },
      { h2: 'オニヤンマの生態と産卵の特徴', text: 'オニヤンマは日本最大級のトンボとして知られ、その堂々とした飛翔姿は多くの人を魅了します。体長は10センチ程度にもなり、黒い体に黄色い縞模様が特徴的です。産卵期は主に夏から秋にかけてで、メスは水辺近くの適した場所を選んで卵を産みつけます。オニヤンマの産卵は「打水産卵」と呼ばれる方法で行われ、メスが水面に腹部を打ちつけるようにして卵を産み落とします。この行動は一見すると水面をたたいているように見えますが、実は次世代へと命をつなぐ重要な営みなのです。富山市の清流や池などの水辺では、夏季にこの貴重な産卵シーンを観察することができます。' },
      { h2: '富山市の水辺環境とオニヤンマの生息', text: '富山市は豊富な水資源に恵まれ、オニヤンマが生息するのに適した環境が多数存在します。神通川や常願寺川などの大きな河川はもちろん、市内の公園の池や農業用水路なども重要な生息地となっています。これらの水辺は水質が比較的良好で、オニヤンマの幼虫（ヤゴ）が成長するのに必要な環境が整っています。特に流れが緩やかで水草が豊富な場所は、産卵に適した環境として好まれます。富山市の自然環境の豊かさを象徴する存在として、オニヤンマは地域の生物多様性を支える重要な役割を果たしています。市民の身近な場所でも観察できることは、富山市の自然環境の質の高さを物語っています。' },
      { h2: '産卵行動の観察ポイントと最適な時期', text: 'オニヤンマの産卵行動を観察するためには、いくつかのポイントがあります。最適な時期は7月から9月にかけての温暖な日で、特に午前中から午後の早い時間帯が観察チャンスです。産卵するメスは水辺を低空飛行しながら適した場所を探し、気に入った場所で腹部を水面に打ちつける動作を繰り返します。観察の際は、トンボを驚かさないよう静かに近づき、適度な距離を保つことが大切です。双眼鏡があるとより詳細な観察が可能になります。産卵中のメスは集中しているため、比較的近距離での観察も可能ですが、自然の営みを尊重し、邪魔をしないよう配慮することが重要です。' },
      { h2: 'オニヤンマの産卵が示す生態系の健全さ', text: 'オニヤンマの産卵行動は、その水辺環境の健全性を示す重要な指標でもあります。オニヤンマは水質の変化に敏感で、汚染された水域では生息できません。そのため、オニヤンマが産卵する水辺は、生態系が健全に保たれている証拠といえます。また、オニヤンマの幼虫は水中で数年間を過ごし、他の水生昆虫や小魚を捕食することで生態系のバランスを維持しています。成虫になってからも蚊やアブなどの害虫を大量に捕食し、人間にとっても有益な存在です。富山市でオニヤンマの産卵が観察できることは、都市部でありながら自然環境が良好に保たれていることを示しています。' },
      { h2: '自然観察を通じた学びと感動', text: 'オニヤンマの産卵観察は、自然の神秘と生命の営みを間近で体感できる貴重な機会です。卵から幼虫、そして成虫へと変態を遂げるトンボの生活史は、自然界の巧妙な仕組みを教えてくれます。特に子どもたちにとっては、生き物への理解と関心を深める excellent な学習機会となります。産卵シーンを目撃した時の感動は、自然保護への意識向上にもつながります。デジタル社会の中で、実際の自然観察体験は非常に価値があります。富山市の身近な水辺で、このような貴重な自然の営みを観察できることは、地域の宝物といえるでしょう。' },
      { h2: 'まとめ', text: '富山市の水辺で観察できるオニヤンマの産卵は、自然の神秘と生命力を感じられる貴重な体験です。身近な自然の営みをぜひ観察してみてください。' }
    ]
  },
  {
    id: 37,
    slug: 'himi-city',
    title: '氷見市のひみ番屋街の足湯と水平線',
    content: [
      { intro: '氷見市の「ひみ番屋街」で楽しむ足湯と美しい水平線の眺め。富山湾の絶景と温泉の癒しが織りなす特別な時間をご紹介します。' },
      { h2: 'ひみ番屋街の魅力と立地の素晴らしさ', text: 'ひみ番屋街は氷見市の代表的な観光スポットで、富山湾に面した絶好の立地にあります。「番屋」とは漁師の作業場兼休憩所を意味し、この施設名には氷見の漁業文化を大切にする想いが込められています。施設内には新鮮な海産物を扱う市場、レストラン、お土産店などが充実しており、氷見の魅力を存分に堪能できます。特に注目すべきは、富山湾を一望できる絶景スポットとしての価値です。晴れた日には立山連峰も望むことができ、山と海が織りなす雄大な景色は訪れる人々を魅了します。氷見の豊かな自然と文化が凝縮された、まさに氷見観光の中核を担う施設です。' },
      { h2: '足湯から望む富山湾の絶景体験', text: 'ひみ番屋街の足湯は、富山湾の美しい水平線を眺めながら温泉を楽しめる贅沢なスペースです。温かなお湯に足を浸しながら、目の前に広がる富山湾の雄大な景色を堪能できます。特に夕暮れ時の足湯体験は格別で、夕日が水平線に沈んでいく様子を足湯に浸かりながら眺める時間は、日常の疲れを癒してくれる特別なひとときです。海からの心地よい潮風を感じながらの足湯は、都市部では決して味わうことのできない贅沢な体験です。足湯の温度は適温に保たれており、長時間でも心地よく利用できます。家族連れやカップル、友人同士など、誰もが楽しめる癒しの空間となっています。' },
      { h2: '季節ごとに変化する水平線の美しさ', text: '富山湾の水平線は季節によって全く異なる表情を見せてくれます。春には穏やかな青い海が広がり、新緑の季節の爽やかさを演出します。夏は力強い太陽光が海面を照らし、キラキラと輝く水面が眩しいほどの美しさを見せます。秋には夕日の美しさが際立ち、オレンジやピンクに染まる空と海の境界線が幻想的な景色を作り出します。冬は雪化粧した立山連峰と静寂な海のコントラストが印象的で、凛とした美しさを感じることができます。どの季節に訪れても、その時期ならではの特別な水平線の景色を楽しむことができ、何度でも訪れたくなる魅力があります。' },
      { h2: '氷見の海の幸と温泉の相乗効果', text: 'ひみ番屋街では、足湯で身体を温めた後に新鮮な海の幸を味わうという、氷見ならではの贅沢な体験ができます。氷見漁港で水揚げされた新鮮な魚介類は、その日の朝に獲れたものを味わうことができ、鮮度の良さは格別です。特に氷見の代名詞でもあるブリは、冬季には脂がのって絶品の味わいを楽しめます。足湯で血行が良くなった身体で味わう海の幸は、より一層美味しく感じられます。また、温泉成分によるリラクゼーション効果と美味しい食事の満足感が相まって、心身ともに満たされる特別な時間を過ごすことができます。' },
      { h2: '地域文化とおもてなしの心', text: 'ひみ番屋街では、氷見の伝統的な漁業文化と現代の観光ニーズを融合させた、温かなおもてなしを体験できます。地元の漁師や店主の方々との会話を通じて、氷見の海や漁業の歴史について学ぶこともできます。足湯エリアでは、地元の方々や他の観光客との自然な交流も生まれ、旅の思い出がより豊かになります。施設のスタッフは皆親切で、氷見の魅力や楽しみ方を丁寧に教えてくれます。このような人と人とのつながりこそが、ひみ番屋街の真の魅力といえるでしょう。地域に根差した authentic な体験ができることが、多くのリピーターを生んでいる理由です。' },
      { h2: 'まとめ', text: '氷見市のひみ番屋街は、足湯と富山湾の水平線が織りなす絶景と癒しの時間を提供してくれます。海の幸と温泉の贅沢な組み合わせをぜひ体験してみてください。' }
    ]
  },
  {
    id: 38,
    slug: 'nanto-city-sakura-restaurant-johanare',
    title: '桜ヶ池クアガーデンのレストランJOHANARE',
    content: [
      { intro: '南砺市の桜ヶ池クアガーデンにあるレストランJOHANAREへ向かうロビーの魅力。上質な空間演出と期待感を高める特別な体験をお伝えします。' },
      { h2: '桜ヶ池クアガーデンの上質なホスピタリティ', text: '桜ヶ池クアガーデンは南砺市が誇る総合リゾート施設で、温泉、宿泊、レストランが一体となった上質なサービスを提供しています。施設全体に流れる洗練された雰囲気は、訪れる人々に非日常的な特別感をもたらします。レストランJOHANAREへ向かうロビーは、この施設の品格と美意識が集約された空間といえるでしょう。自然豊かな南砺市の環境と調和しながら、モダンで洗練されたデザインが施されており、一歩足を踏み入れるだけで期待感が高まります。地域の文化と現代的なセンスが見事に融合された空間設計は、多くの来訪者に深い印象を与えています。' },
      { h2: 'レストランJOHANAREへのアプローチの演出', text: 'レストランJOHANAREへ向かうロビーは、単なる通路ではなく、食事への期待を高める重要な演出空間として設計されています。適度な照明により生み出される落ち着いた雰囲気は、日常の喧騒から離れた特別な時間の始まりを予感させます。壁面には地域の自然や文化をモチーフにしたアートワークが配置され、南砺市の魅力を視覚的に表現しています。床材や内装材にも こだわりが感じられ、歩くたびに上質感を実感できます。このアプローチ空間を通ることで、レストランでの食事体験への期待感が自然と高まり、特別なディナーへの心の準備が整います。' },
      { h2: 'インテリアデザインと空間美学', text: 'ロビー空間のインテリアデザインは、和のテイストと現代的なセンスが絶妙にバランスされた美しい仕上がりとなっています。自然素材を効果的に使用することで、温かみのある空間を演出しながら、同時にモダンな洗練さも表現しています。家具や装飾品の選択にも細やかな配慮が感じられ、どの角度から眺めても美しい空間構成となっています。天井高や窓の配置なども計算され、自然光と人工照明のバランスが絶妙に調整されています。このような空間美学への こだわりが、桜ヶ池クアガーデン全体の品格を支えており、訪れる人々に上質な時間を約束する重要な要素となっています。' },
      { h2: 'くつろぎと期待感を演出する心理的効果', text: 'レストランへ向かうロビーでの体験は、食事への期待感を高める重要な心理的効果をもたらします。適度にゆったりとしたペースで歩けるよう設計された動線は、日常の忙しさから心を切り替える時間を提供します。ソフトな音楽や自然の音が適度に流れ、五感全体でリラクゼーション効果を感じることができます。この空間で過ごす数分間が、特別な食事体験への心の準備を整え、より充実した時間への期待を膨らませてくれます。心理学的にも、美しい空間での体験は食事の満足度を高めることが知られており、このロビー空間はまさにその効果を狙った巧妙な設計といえるでしょう。' },
      { h2: '地域の自然と文化を反映した空間づくり', text: 'ロビー空間には、南砺市の豊かな自然と文化的背景が巧みに取り入れられています。季節の花々や地域の工芸品などが効果的に配置され、訪れる人々に南砺市の魅力を伝える役割も果たしています。桜ヶ池周辺の自然環境をモチーフにしたデザイン要素も随所に見られ、施設と地域の一体感を感じることができます。このような地域性を大切にしたアプローチにより、単なる商業施設ではなく、南砺市の文化と自然を体感できる特別な場所としての価値を高めています。地元の素材や職人の技術を活用した装飾品なども見られ、地域との深いつながりを感じることができる空間となっています。' },
      { h2: 'まとめ', text: '桜ヶ池クアガーデンのレストランJOHANAREへ向かうロビーは、上質な空間演出により特別な食事体験への期待を高める素晴らしい空間です。この贅沢な時間をぜひ体験してみてください。' }
    ]
  }
];

// 各記事の拡張処理
async function expandArticle(article) {
  try {
    console.log(`第${article.id}記事の更新を開始します...`);
    console.log(`対象: ${article.slug} (${article.title})`);
    
    // 記事を取得
    const post = await client.fetch(`*[_type == "post" && slug.current == "${article.slug}"][0] { _id, title, body, youtubeUrl }`);
    
    if (!post) {
      console.log('記事が見つかりませんでした');
      return { success: false, error: '記事が見つからない' };
    }
    
    console.log('記事タイトル:', post.title);
    console.log('YouTube URL:', post.youtubeUrl ? 'あり' : 'なし');
    
    // 現在の状態確認
    let totalChars = 0;
    post.body.forEach(block => {
      if (block._type === 'block' && block.children) {
        const text = block.children.map(child => child.text).join('');
        totalChars += text.length;
      }
    });
    
    console.log(`現在の文字数: ${totalChars}文字`);
    console.log('目標: 800-1000文字に拡張');
    
    // 拡張コンテンツを生成
    const expandedContent = [];
    
    article.content.forEach((item, index) => {
      if (item.intro) {
        expandedContent.push({
          _type: 'block',
          _key: 'intro',
          style: 'normal',
          children: [{ _type: 'span', text: item.intro, marks: [] }],
          markDefs: []
        });
      } else if (item.h2) {
        expandedContent.push({
          _type: 'block',
          _key: `h2-${index}`,
          style: 'h2',
          children: [{ _type: 'span', text: item.h2, marks: [] }],
          markDefs: []
        });
        expandedContent.push({
          _type: 'block',
          _key: `content-${index}`,
          style: 'normal',
          children: [{ _type: 'span', text: item.text, marks: [] }],
          markDefs: []
        });
      }
    });
    
    // 文字数カウント
    let newTotalChars = 0;
    expandedContent.forEach(block => {
      if (block._type === 'block' && block.children) {
        const text = block.children.map(child => child.text).join('');
        newTotalChars += text.length;
      }
    });
    
    console.log(`新しい文字数: ${newTotalChars}文字`);
    console.log('新しい構成: H2見出し6個の統一構造');
    
    // 記事を慎重に更新
    await client
      .patch(post._id)
      .set({ body: expandedContent })
      .commit();
    
    console.log(`✅ 第${article.id}記事の更新が完了しました`);
    console.log(`📋 ${totalChars}文字→${newTotalChars}文字に拡張`);
    console.log('🏗️ H2見出し6個の統一構造を適用');
    
    // キャッシュクリア
    await client
      .patch(post._id)
      .set({ _updatedAt: new Date().toISOString() })
      .commit();
    
    console.log('🔄 キャッシュクリア実行完了');
    console.log('---');
    
    return { 
      success: true, 
      originalChars: totalChars, 
      newChars: newTotalChars,
      increase: newTotalChars - totalChars
    };
    
  } catch (error) {
    console.error(`❌ 第${article.id}記事でエラーが発生しました:`, error);
    return { success: false, error: error.message };
  }
}

// メイン処理（並列実行）
async function main() {
  console.log('🚀 第11セッション開始：5記事バッチ並列処理');
  console.log('対象記事: 第34-38記事');
  console.log('=======================================');
  
  const startTime = Date.now();
  
  // 5記事を並列処理で実行
  const results = await Promise.all(articles.map(article => expandArticle(article)));
  
  const endTime = Date.now();
  const processingTime = (endTime - startTime) / 1000;
  
  console.log('=======================================');
  console.log('🎉 第11セッション完了レポート');
  console.log('=======================================');
  
  let successCount = 0;
  let totalIncrease = 0;
  
  results.forEach((result, index) => {
    if (result.success) {
      successCount++;
      totalIncrease += result.increase;
      console.log(`✅ 第${34 + index}記事: ${result.originalChars}→${result.newChars}文字 (+${result.increase})`);
    } else {
      console.log(`❌ 第${34 + index}記事: エラー - ${result.error}`);
    }
  });
  
  console.log('=======================================');
  console.log(`📊 成功率: ${successCount}/5記事 (${(successCount/5*100).toFixed(1)}%)`);
  console.log(`📈 総文字数増加: ${totalIncrease}文字`);
  console.log(`⏱️ 処理時間: ${processingTime.toFixed(1)}秒`);
  console.log(`🎯 完了記事数累計: ${33 + successCount}記事`);
  console.log('=======================================');
  
  if (successCount === 5) {
    console.log('🎉 全記事の更新が成功しました！');
  } else {
    console.log('⚠️ 一部記事で問題が発生しました。確認が必要です。');
  }
}

// エラーハンドリング付きで実行
main().catch(error => {
  console.error('💥 重大なエラーが発生しました:', error);
  process.exit(1);
});