<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>📊 GA4リアルタイムレポート確認</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #007bff, #0056b3);
            min-height: 100vh;
        }
        .container {
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        .header {
            text-align: center;
            background: #007bff;
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
        }
        .step {
            background: #f8f9fa;
            margin: 20px 0;
            padding: 25px;
            border-radius: 15px;
            border-left: 5px solid #007bff;
        }
        .step h3 {
            margin: 0 0 15px 0;
            color: #2c3e50;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .step-number {
            background: #007bff;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        .dashboard-item {
            background: #e7f3ff;
            border: 2px solid #007bff;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }
        .instruction {
            background: #fff3cd;
            border: 2px solid #ffc107;
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
        }
        .success {
            background: #d4edda;
            border: 2px solid #28a745;
            color: #155724;
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
        }
        .error {
            background: #f8d7da;
            border: 2px solid #dc3545;
            color: #721c24;
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            cursor: pointer;
            margin: 10px;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        button:hover {
            background: #0056b3;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        .btn-success { background: #28a745; }
        .btn-success:hover { background: #218838; }
        .btn-warning { background: #ffc107; color: #212529; }
        .btn-warning:hover { background: #e0a800; }
        .large-button {
            font-size: 18px;
            padding: 20px 40px;
        }
        .dashboard-info {
            background: #17a2b8;
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
        }
        .timer {
            background: #28a745;
            color: white;
            padding: 10px 20px;
            border-radius: 20px;
            display: inline-block;
            font-weight: bold;
            margin: 10px 0;
        }
        @media (max-width: 768px) {
            .grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>📊 GA4リアルタイムレポート確認</h1>
            <p><strong>プロパティ:</strong> TOYAMA BLOG (ID: 498053318)</p>
            <p><strong>測定ID:</strong> G-5VS8BF91VH</p>
            <p><strong>確認時刻:</strong> <span id="timestamp"></span></p>
        </div>

        <div class="step">
            <h3><span class="step-number">1</span>🌐 サイトアクセス & ダッシュボード準備</h3>
            <p>GA4リアルタイムレポートとTOYAMA BLOGを同時に開いて、リアルタイムでデータ反映を確認します。</p>
            
            <div class="grid">
                <button class="large-button btn-warning" onclick="openGA4Dashboard()">
                    📊 GA4ダッシュボードを開く
                </button>
                <button class="large-button btn-success" onclick="openSiteForRealtime()">
                    🌐 TOYAMA BLOGを開く
                </button>
            </div>
            
            <div class="dashboard-info">
                <strong>📊 GA4ダッシュボードURL:</strong><br>
                https://analytics.google.com/analytics/web/#/p498053318/realtime/overview
            </div>
        </div>

        <div class="step">
            <h3><span class="step-number">2</span>⏰ ベースライン確認</h3>
            <p>GA4ダッシュボードで現在の状況を記録します。</p>
            
            <div class="instruction">
                <strong>記録項目:</strong>
                <div class="grid">
                    <div class="dashboard-item">
                        <h4>📈 アクティブユーザー</h4>
                        <p>現在の数値: <input type="number" id="baseline-users" placeholder="記録"></p>
                    </div>
                    <div class="dashboard-item">
                        <h4>📄 ページビュー数</h4>
                        <p>過去30分: <input type="number" id="baseline-pageviews" placeholder="記録"></p>
                    </div>
                </div>
            </div>
            
            <button onclick="recordBaseline()">📝 ベースライン記録</button>
        </div>

        <div class="step">
            <h3><span class="step-number">3</span>🚀 テストトラフィック生成</h3>
            <p>実際にサイトにアクセスして、GA4でのデータ反映を確認します。</p>
            
            <div class="instruction">
                <strong>テスト手順:</strong>
                <ol>
                    <li>TOYAMA BLOGのメインページにアクセス（既に開いている場合はリロード）</li>
                    <li>異なる記事を3-4回クリックしてページ遷移</li>
                    <li>カテゴリーページも訪問</li>
                    <li>トップページに戻る</li>
                </ol>
            </div>
            
            <div class="timer" id="timer">
                ⏱️ データ反映まで: 待機中
            </div>
            
            <button onclick="startTrafficTest()">🚗 テストトラフィック開始</button>
            <button onclick="generateTestTraffic()">🎯 自動テストトラフィック</button>
        </div>

        <div class="step">
            <h3><span class="step-number">4</span>📊 リアルタイムデータ確認</h3>
            <p>GA4ダッシュボードで以下の項目が反映されることを確認します。</p>
            
            <div class="grid">
                <div class="dashboard-item">
                    <h4>👤 アクティブユーザー</h4>
                    <p>1以上の数値が表示される</p>
                    <input type="checkbox" id="check-users"> 確認済み
                </div>
                <div class="dashboard-item">
                    <h4>📄 ページビュー</h4>
                    <p>アクセスしたページ数の増加</p>
                    <input type="checkbox" id="check-pageviews"> 確認済み
                </div>
                <div class="dashboard-item">
                    <h4>📱 上位のページ</h4>
                    <p>アクセスしたページのURL表示</p>
                    <input type="checkbox" id="check-pages"> 確認済み
                </div>
                <div class="dashboard-item">
                    <h4>🌍 地理的情報</h4>
                    <p>大まかな地域情報の表示</p>
                    <input type="checkbox" id="check-location"> 確認済み
                </div>
            </div>
        </div>

        <div class="step">
            <h3><span class="step-number">5</span>🎯 詳細確認項目</h3>
            <p>より詳細な項目を確認して、GA4実装の完全性を検証します。</p>
            
            <div class="instruction">
                <strong>確認項目:</strong>
                <div style="margin-top: 15px;">
                    <label><input type="checkbox" id="detail-1"> イベント数の記録</label><br>
                    <label><input type="checkbox" id="detail-2"> デバイスカテゴリの表示</label><br>
                    <label><input type="checkbox" id="detail-3"> ブラウザ情報の記録</label><br>
                    <label><input type="checkbox" id="detail-4"> 参照元/メディアの記録</label><br>
                    <label><input type="checkbox" id="detail-5"> リアルタイムタイムラインでの時刻表示</label><br>
                </div>
            </div>
        </div>

        <div class="step">
            <h3><span class="step-number">6</span>🧪 手動イベントテスト</h3>
            <p>手動でカスタムイベントを送信して、GA4での即座の反映を確認します。</p>
            
            <div class="instruction">
                <strong>手順:</strong>
                <ol>
                    <li>TOYAMA BLOGのDevTools Consoleを開く</li>
                    <li>下のスクリプトをコピーして実行</li>
                    <li>GA4ダッシュボードで1-2分後にイベント数の増加を確認</li>
                </ol>
            </div>
            
            <div style="background: #2d3748; color: #e2e8f0; padding: 20px; border-radius: 10px; font-family: monospace; margin: 15px 0;">
// GA4手動イベント送信
gtag('event', 'realtime_test', {
  event_category: 'dashboard_verification',
  event_label: 'manual_test_' + Date.now(),
  value: 1,
  custom_parameter_1: 'realtime_dashboard_test'
});
console.log('✅ リアルタイムテストイベントを送信しました');
            </div>
            
            <button onclick="copyEventScript()">📋 イベント送信スクリプトをコピー</button>
        </div>

        <div class="step">
            <h3><span class="step-number">7</span>📈 最終確認とレポート</h3>
            <p>全ての確認項目をチェックして、GA4実装の完全性を評価します。</p>
            
            <div class="success">
                <strong>✅ 成功基準:</strong><br>
                • アクティブユーザー: 1以上<br>
                • ページビュー: テストアクセス分が反映<br>
                • ページURL: 正確な記録<br>
                • データ反映時間: 1-2分以内<br>
                • カスタムイベント: 正常に記録
            </div>
            
            <button onclick="generateRealtimeReport()">📊 最終確認レポートを生成</button>
        </div>

        <div id="report" style="display: none;">
            <div class="step">
                <h2>📊 GA4リアルタイム確認レポート</h2>
                <div id="reportContent"></div>
            </div>
        </div>
    </div>

    <script>
        let testStartTime = null;
        let timerInterval = null;
        
        // タイムスタンプ表示
        document.getElementById('timestamp').textContent = new Date().toLocaleString('ja-JP');

        function openGA4Dashboard() {
            console.log('📊 GA4リアルタイムダッシュボードを開いています...');
            const dashboardUrl = 'https://analytics.google.com/analytics/web/#/p498053318/realtime/overview';
            const dashboardWindow = window.open(dashboardUrl, '_blank', 'width=1200,height=800');
            
            if (dashboardWindow) {
                alert('✅ GA4リアルタイムダッシュボードを開きました！\n\n確認手順:\n1. Googleアカウントでログイン\n2. TOYAMA BLOGプロパティを選択\n3. 現在のアクティブユーザー数とページビュー数を記録\n4. リアルタイム概要画面を表示したまま待機');
            } else {
                alert('❌ ポップアップがブロックされました。\nブラウザの設定でポップアップを許可してください。');
            }
        }

        function openSiteForRealtime() {
            console.log('🌐 TOYAMA BLOGを新しいタブで開いています...');
            const siteWindow = window.open('https://sasakiyoshimasa.com', '_blank', 'width=1200,height=800');
            
            if (siteWindow) {
                alert('✅ TOYAMA BLOGを新しいタブで開きました！\n\n次の手順:\n1. サイト内で複数のページを訪問\n2. 記事をクリックしてページ遷移\n3. カテゴリーページも訪問\n4. GA4ダッシュボードでリアルタイム反映を確認');
            } else {
                alert('❌ ポップアップがブロックされました。');
            }
        }

        function recordBaseline() {
            const users = document.getElementById('baseline-users').value;
            const pageviews = document.getElementById('baseline-pageviews').value;
            
            if (users !== '' && pageviews !== '') {
                alert(`✅ ベースライン記録完了！\n\nアクティブユーザー: ${users}\nページビュー: ${pageviews}\n\nこれから実際のテストを開始します。`);
                console.log('📝 ベースライン記録:', { users, pageviews, time: new Date().toLocaleString() });
            } else {
                alert('❌ アクティブユーザー数とページビュー数を入力してください。');
            }
        }

        function startTrafficTest() {
            testStartTime = new Date();
            startTimer();
            alert('🚀 テストトラフィック開始！\n\nTOYAMA BLOGのタブで以下を実行してください:\n1. 複数の記事をクリック\n2. ページ遷移を実行\n3. カテゴリーページも訪問\n\n1-2分後にGA4ダッシュボードを確認してください。');
        }

        function generateTestTraffic() {
            alert('🎯 自動テストトラフィックを生成します。\n\n複数のページを自動で開いて閉じることで、GA4での計測を確認します。');
            
            const testPages = [
                'https://sasakiyoshimasa.com',
                'https://sasakiyoshimasa.com/blog/toyama-city-cake-station',
                'https://sasakiyoshimasa.com/categories',
                'https://sasakiyoshimasa.com/blog/toyama-city-ooita-shrine-summer-visit'
            ];
            
            testPages.forEach((url, index) => {
                setTimeout(() => {
                    const testWindow = window.open(url, `_test_${index}`, 'width=800,height=600');
                    console.log(`🌐 テストページ${index + 1}を開きました: ${url}`);
                    
                    // 3秒後に自動で閉じる
                    setTimeout(() => {
                        if (testWindow) {
                            testWindow.close();
                            console.log(`🔄 テストページ${index + 1}を閉じました`);
                        }
                    }, 3000);
                }, index * 1000);
            });
            
            testStartTime = new Date();
            startTimer();
        }

        function startTimer() {
            if (timerInterval) clearInterval(timerInterval);
            
            timerInterval = setInterval(() => {
                const elapsed = Math.floor((new Date() - testStartTime) / 1000);
                const remaining = Math.max(120 - elapsed, 0); // 2分後を目安
                
                if (remaining > 0) {
                    const minutes = Math.floor(remaining / 60);
                    const seconds = remaining % 60;
                    document.getElementById('timer').textContent = 
                        `⏱️ データ反映まで: ${minutes}:${seconds.toString().padStart(2, '0')}`;
                } else {
                    document.getElementById('timer').textContent = '✅ データ反映時間到達！GA4を確認してください';
                    document.getElementById('timer').style.background = '#28a745';
                    clearInterval(timerInterval);
                }
            }, 1000);
        }

        function copyEventScript() {
            const script = `// GA4手動イベント送信
gtag('event', 'realtime_test', {
  event_category: 'dashboard_verification',
  event_label: 'manual_test_' + Date.now(),
  value: 1,
  custom_parameter_1: 'realtime_dashboard_test'
});
console.log('✅ リアルタイムテストイベントを送信しました');`;

            navigator.clipboard.writeText(script).then(() => {
                alert('✅ イベント送信スクリプトをコピーしました！\n\nTOYAMA BLOGのDevTools Consoleに貼り付けて実行してください。');
            }).catch(err => {
                console.error('コピーに失敗:', err);
                alert('クリップボードへのコピーに失敗しました。手動でコピーしてください。');
            });
        }

        function generateRealtimeReport() {
            const now = new Date().toLocaleString('ja-JP');
            const baselineUsers = document.getElementById('baseline-users').value || '未記録';
            const baselinePageviews = document.getElementById('baseline-pageviews').value || '未記録';
            
            // 基本確認項目のチェック状況
            const basicChecks = [
                { id: 'check-users', label: 'アクティブユーザー確認' },
                { id: 'check-pageviews', label: 'ページビュー確認' },
                { id: 'check-pages', label: '上位ページ確認' },
                { id: 'check-location', label: '地理的情報確認' }
            ];
            
            // 詳細確認項目のチェック状況
            const detailChecks = [
                { id: 'detail-1', label: 'イベント数の記録' },
                { id: 'detail-2', label: 'デバイスカテゴリの表示' },
                { id: 'detail-3', label: 'ブラウザ情報の記録' },
                { id: 'detail-4', label: '参照元/メディアの記録' },
                { id: 'detail-5', label: 'リアルタイムタイムラインでの時刻表示' }
            ];
            
            let basicCompleted = 0;
            let detailCompleted = 0;
            
            let basicHTML = '';
            basicChecks.forEach(check => {
                const isChecked = document.getElementById(check.id).checked;
                if (isChecked) basicCompleted++;
                const status = isChecked ? '✅' : '❌';
                basicHTML += `<p>${status} ${check.label}</p>`;
            });
            
            let detailHTML = '';
            detailChecks.forEach(check => {
                const isChecked = document.getElementById(check.id).checked;
                if (isChecked) detailCompleted++;
                const status = isChecked ? '✅' : '❌';
                detailHTML += `<p>${status} ${check.label}</p>`;
            });
            
            const totalScore = Math.round(((basicCompleted * 2 + detailCompleted) / (basicChecks.length * 2 + detailChecks.length)) * 100);
            const overallStatus = totalScore >= 80 ? '🎉 成功' : totalScore >= 60 ? '⚠️ 部分的成功' : '❌ 要改善';
            
            const reportContent = `
                <div class="success">
                    <h3>📊 GA4リアルタイム確認レポート</h3>
                    <p><strong>確認日時:</strong> ${now}</p>
                    <p><strong>GA4プロパティ:</strong> TOYAMA BLOG (ID: 498053318)</p>
                    <p><strong>測定ID:</strong> G-5VS8BF91VH</p>
                    <p><strong>総合評価:</strong> ${overallStatus} (${totalScore}%)</p>
                    
                    <h4>📈 ベースライン記録</h4>
                    <p>• 開始時アクティブユーザー: ${baselineUsers}</p>
                    <p>• 開始時ページビュー: ${baselinePageviews}</p>
                    
                    <h4>📋 基本確認項目 (${basicCompleted}/${basicChecks.length})</h4>
                    ${basicHTML}
                    
                    <h4>🔍 詳細確認項目 (${detailCompleted}/${detailChecks.length})</h4>
                    ${detailHTML}
                    
                    <h4>🎯 結論</h4>
                    <p>${totalScore >= 80 ? 
                        '<strong style="color: #28a745;">GA4リアルタイムレポートは正常に動作しています！</strong>' : 
                        totalScore >= 60 ?
                        '<strong style="color: #ffc107;">基本的な動作は確認できましたが、一部項目で改善の余地があります。</strong>' :
                        '<strong style="color: #dc3545;">GA4の設定や実装に問題がある可能性があります。DevToolsでの確認をお勧めします。</strong>'
                    }</p>
                    
                    <h4>📞 次のステップ</h4>
                    <p>${totalScore >= 80 ? 
                        'GA4実装は完全に成功しています。継続的な監視を行ってください。' :
                        '未確認の項目について再度確認を行い、必要に応じてDevToolsでの詳細調査を実行してください。'
                    }</p>
                    
                    <h4>🔗 参考リンク</h4>
                    <p><a href="https://analytics.google.com/analytics/web/#/p498053318/realtime/overview" target="_blank">GA4リアルタイムレポート</a></p>
                    <p><a href="https://sasakiyoshimasa.com" target="_blank">TOYAMA BLOG</a></p>
                </div>
            `;
            
            document.getElementById('reportContent').innerHTML = reportContent;
            document.getElementById('report').style.display = 'block';
            document.getElementById('report').scrollIntoView({ behavior: 'smooth' });
        }

        // ページ読み込み時の案内
        window.onload = () => {
            console.log('📊 GA4リアルタイムレポート確認ツールを開始しました');
            console.log('手順に従ってリアルタイムでのデータ反映を確認してください');
        };
    </script>
</body>
</html>