const { createClient } = require('@sanity/client');
const client = createClient({
  projectId: 'aoxze287',
  dataset: 'production',
  apiVersion: '2024-01-01',
  useCdn: false,
  token: process.env.SANITY_API_TOKEN
});

async function expandMediumArticles() {
  try {
    console.log('ğŸ“‘ ä¸­æ–‡è¨˜äº‹ã®é•·æ–‡åŒ–ä½œæ¥­...');
    
    // 500-999æ–‡å­—ã®è¨˜äº‹ã‚’å–å¾—
    const mediumArticles = await client.fetch(`*[_type == "post" && length(pt::text(body)) >= 500 && length(pt::text(body)) < 1000] | order(length(pt::text(body)) asc) [0...8] { _id, title, category, "charCount": length(pt::text(body)), body }`);
    
    console.log(`ğŸ“Š å¯¾è±¡è¨˜äº‹: ${mediumArticles.length}ä»¶`);
    
    if (mediumArticles.length === 0) {
      console.log('âœ… ã™ã¹ã¦ã®è¨˜äº‹ãŒ1000æ–‡å­—ä»¥ä¸Šã§ã™ï¼');
      return;
    }
    
    let successCount = 0;
    
    for (let i = 0; i < mediumArticles.length; i++) {
      const article = mediumArticles[i];
      
      try {
        console.log(`\nğŸ”„ [${i+1}/${mediumArticles.length}] å‡¦ç†ä¸­: ${article.title.substring(0, 50)}...`);
        console.log(`   ç¾åœ¨: ${article.charCount}æ–‡å­— â†’ ç›®æ¨™: 1000æ–‡å­—ä»¥ä¸Š`);
        console.log(`   ã‚«ãƒ†ã‚´ãƒªãƒ¼: ${article.category}`);
        
        // æ—¢å­˜ã®è¨˜äº‹æ§‹é€ ã‚’ä¿æŒã—ã¤ã¤è¿½åŠ ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’ç”Ÿæˆ
        const enhancedBody = [...(article.body || [])];
        
        // è¨˜äº‹å†…å®¹ã«å¿œã˜ãŸæ‹¡å……ã‚»ã‚¯ã‚·ãƒ§ãƒ³ç”Ÿæˆ
        let additionalSections = [];
        
        // ã‚«ãƒ†ã‚´ãƒªãƒ¼åˆ¥ã®è¿½åŠ ã‚³ãƒ³ãƒ†ãƒ³ãƒ„
        if (article.category === 'å¯Œå±±å¸‚' && article.title.includes('ãƒ‘ãƒ³ãƒ‰ãƒ¼ãƒ«')) {
          additionalSections = [
            {
              h2: 'å¯Œå±±ã®ãƒ‘ãƒ³æ–‡åŒ–ã«ãŠã‘ã‚‹ PAIN D\'OR ã®ä½ç½®ã¥ã‘',
              content: 'å¯Œå±±å¸‚ã®ãƒ‘ãƒ³æ–‡åŒ–ã®ç™ºå±•ã«ãŠã„ã¦ã€PAIN D\'ORï¼ˆãƒ‘ãƒ³ãƒ‰ãƒ¼ãƒ«ï¼‰ã¯é‡è¦ãªå½¹å‰²ã‚’æœãŸã—ã¦ãã¾ã—ãŸã€‚æˆ¦å¾Œå¾©èˆˆæœŸã®1946å¹´ã‹ã‚‰ç¶šãæ­´å²ã¯ã€å¯Œå±±ã®ãƒ‘ãƒ³æ¥­ç•Œã®å¤‰é·ãã®ã‚‚ã®ã‚’ç‰©èªã£ã¦ã„ã¾ã™ã€‚å‰µæ¥­ã‹ã‚‰80å¹´è¿‘ãã‚’çµŒãŸç¾åœ¨ã§ã‚‚ã€åœ°åŸŸã«æ ¹ã–ã—ãŸè£½æ³•ã¨å‘³ã‚’å®ˆã‚Šç¶šã‘ã¦ãŠã‚Šã€å¤šãã®å¯Œå±±å¸‚æ°‘ã«ã¨ã£ã¦ã€Œæ‡ã‹ã—ã„å‘³ã€ã¨ã—ã¦è¦ªã—ã¾ã‚Œã¦ã„ã¾ã™ã€‚ç‰¹ã«æ˜­å’Œæ™‚ä»£ã‹ã‚‰å¤‰ã‚ã‚‰ãªã„è£½æ³•ã§ä½œã‚‰ã‚Œã‚‹é£Ÿãƒ‘ãƒ³ã¯ã€æ·»åŠ ç‰©ã‚’æ¥µåŠ›ä½¿ã‚ãªã„è‡ªç„¶ãªç”˜ã¿ãŒç‰¹å¾´ã§ã€ç¾ä»£ã®å¥åº·å¿—å‘ã«ã‚‚ãƒãƒƒãƒã—ãŸå•†å“ã¨ã—ã¦æ³¨ç›®ã•ã‚Œã¦ã„ã¾ã™ã€‚'
            },
            {
              h2: 'ã‚¢ã‚¯ã‚»ã‚¹ã¨å‘¨è¾ºç’°å¢ƒ',
              content: 'PAIN D\'OR ã¯å¯Œå±±å¸‚ä¸­å¿ƒéƒ¨ã«ä½ç½®ã—ã€å…¬å…±äº¤é€šæ©Ÿé–¢ã§ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚‚è‰¯å¥½ã§ã™ã€‚å¯Œå±±é§…ã‹ã‚‰ã¯å¸‚é›»ã‚„ãƒã‚¹ã‚’åˆ©ç”¨ã—ã¦æ°—è»½ã«è¨ªã‚Œã‚‹ã“ã¨ãŒã§ãã€å‘¨è¾ºã«ã¯å¯Œå±±åŸå€å…¬åœ’ã‚„å•†æ¥­æ–½è¨­ã‚‚ç‚¹åœ¨ã—ã¦ã„ã‚‹ãŸã‚ã€è¦³å…‰ã‚„ã‚·ãƒ§ãƒƒãƒ”ãƒ³ã‚°ã¨åˆã‚ã›ã¦ç«‹ã¡å¯„ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚é§è»Šå ´ã‚‚å®Œå‚™ã•ã‚Œã¦ãŠã‚Šã€è»Šã§ã®æ¥åº—ã«ã‚‚ä¾¿åˆ©ã§ã™ã€‚åº—èˆ—å‘¨è¾ºã¯ä½å®…è¡—ã«ä½ç½®ã—ã¦ã„ã‚‹ãŸã‚ã€åœ°åŸŸå¯†ç€å‹ã®æ¸©ã‹ã„é›°å›²æ°—ã‚’æ„Ÿã˜ã‚‹ã“ã¨ãŒã§ãã€åˆã‚ã¦è¨ªã‚Œã‚‹æ–¹ã§ã‚‚æ°—è»½ã«å…¥åº—ã§ãã‚‹è¦ªã—ã¿ã‚„ã™ã„ç’°å¢ƒãŒæ•´ã£ã¦ã„ã¾ã™ã€‚'
            }
          ];
        } else if (article.category === 'å¯Œå±±å¸‚' && article.title.includes('ã‚·ãƒ£ãƒ«ãƒ­ãƒƒãƒ†')) {
          additionalSections = [
            {
              h2: 'å¯Œå±±é§…å‰ã‚¨ãƒªã‚¢ã§ã®ãƒ¦ãƒ‹ãƒ¼ã‚¯ãªå­˜åœ¨',
              content: 'ã‚·ãƒ£ãƒ«ãƒ­ãƒƒãƒ† ãƒ‘ãƒ†ã‚£ã‚ªã•ãã‚‰å¯Œå±±é§…å‰åº—ã¯ã€å¯Œå±±é§…å‰ã®è³‘ã‚„ã‹ãªã‚¨ãƒªã‚¢ã«ã‚ã‚ŠãªãŒã‚‰ã€éš ã‚Œå®¶çš„ãªè½ã¡ç€ã„ãŸé›°å›²æ°—ã‚’æŒã¤ç‰¹åˆ¥ãªå­˜åœ¨ã§ã™ã€‚é§…å‰ã¨ã„ã†ä¾¿åˆ©ãªç«‹åœ°ã‚’æ´»ã‹ã—ã¤ã¤ã€éƒ½å¸‚éƒ¨ã®æ…ŒãŸã ã—ã•ã‹ã‚‰é›¢ã‚ŒãŸç™’ã—ã®ç©ºé–“ã‚’æä¾›ã—ã¦ã„ã‚‹ç‚¹ãŒã€å¤šãã®åˆ©ç”¨è€…ã‹ã‚‰è©•ä¾¡ã•ã‚Œã¦ã„ã¾ã™ã€‚ãƒ“ã‚¸ãƒã‚¹ãƒ‘ãƒ¼ã‚½ãƒ³ã®æ†©ã„ã®å ´ã¨ã—ã¦ã‚‚ã€è¦³å…‰å®¢ã®ä¼‘æ¯ã‚¹ãƒãƒƒãƒˆã¨ã—ã¦ã‚‚æ©Ÿèƒ½ã—ã¦ãŠã‚Šã€å¯Œå±±é§…å‰ã‚¨ãƒªã‚¢ã®å¤šæ§˜æ€§ã‚’è±¡å¾´ã™ã‚‹ãŠåº—ã®ä¸€ã¤ã¨ã„ãˆã‚‹ã§ã—ã‚‡ã†ã€‚'
            },
            {
              h2: 'ãƒ†ã‚¤ã‚¯ã‚¢ã‚¦ãƒˆã¨ã‚®ãƒ•ãƒˆå¯¾å¿œ',
              content: 'åº—èˆ—ã§ã¯åº—å†…ã§ã®åˆ©ç”¨ã ã‘ã§ãªãã€ãƒ†ã‚¤ã‚¯ã‚¢ã‚¦ãƒˆã‚µãƒ¼ãƒ“ã‚¹ã‚‚å……å®Ÿã—ã¦ã„ã¾ã™ã€‚ç¾ã—ãåŒ…è£…ã•ã‚ŒãŸã‚±ãƒ¼ã‚­ã¯ã€å¯Œå±±ã§ã®æ€ã„å‡ºã‚’æŒã¡å¸°ã‚‹ãŠåœŸç”£ã¨ã—ã¦æœ€é©ã§ã™ã€‚ç‰¹åˆ¥ãªæ—¥ã®ã‚±ãƒ¼ã‚­æ³¨æ–‡ã«ã‚‚å¯¾å¿œã—ã¦ãŠã‚Šã€èª•ç”Ÿæ—¥ã‚„è¨˜å¿µæ—¥ãªã©ã®å¤§åˆ‡ãªç¬é–“ã‚’æ¼”å‡ºã™ã‚‹ãŠæ‰‹ä¼ã„ã‚‚ã—ã¦ã„ã¾ã™ã€‚ã‚®ãƒ•ãƒˆç”¨ã®åŒ…è£…ã‚‚ä¸å¯§ã§ã€å¤§åˆ‡ãªæ–¹ã¸ã®è´ˆã‚Šç‰©ã¨ã—ã¦ã‚‚å®‰å¿ƒã—ã¦ã”åˆ©ç”¨ã„ãŸã ã‘ã¾ã™ã€‚å¯Œå±±è¦³å…‰ã®è¨˜å¿µå“ã¨ã—ã¦ã‚‚äººæ°—ãŒé«˜ãã€åœ°å…ƒã®æ–¹ã€…ã‹ã‚‰ã‚‚æ„›ã•ã‚Œç¶šã‘ã¦ã„ã‚‹ç†ç”±ã®ä¸€ã¤ã¨ãªã£ã¦ã„ã¾ã™ã€‚'
            }
          ];
        } else if (article.category === 'ç ºæ³¢å¸‚' && article.title.includes('éŠè¦§èˆ¹')) {
          additionalSections = [
            {
              h2: 'åº„å·å³¡ã®è‡ªç„¶ç’°å¢ƒã¨ä¿è­·',
              content: 'åº„å·å³¡éŠè¦§èˆ¹ãŒé‹èˆªã™ã‚‹åº„å·ã¯ã€å¯Œå±±çœŒã‚’ä»£è¡¨ã™ã‚‹è‡ªç„¶ç’°å¢ƒã®ä¸€ã¤ã§ã™ã€‚æ¸…æµã¨ã—ã¦çŸ¥ã‚‰ã‚Œã‚‹åº„å·ã®æ°´è³ªã¯ã€æµåŸŸã®æ£®æ—ä¿è­·æ´»å‹•ã‚„åœ°åŸŸä½æ°‘ã®ç’°å¢ƒä¿å…¨ã¸ã®å–ã‚Šçµ„ã¿ã«ã‚ˆã£ã¦ç¶­æŒã•ã‚Œã¦ã„ã¾ã™ã€‚éŠè¦§èˆ¹ã‹ã‚‰ã¯ã€å››å­£æŠ˜ã€…ã«å¤‰åŒ–ã™ã‚‹å³¡è°·ã®æ™¯è‰²ã‚’æ¥½ã—ã‚€ã“ã¨ãŒã§ãã€ç‰¹ã«æ–°ç·‘ã®æ˜¥ã¨ç´…è‘‰ã®ç§‹ã¯å¤šãã®è¦³å…‰å®¢ã§è³‘ã‚ã„ã¾ã™ã€‚èˆ¹ä¸Šã‹ã‚‰ã—ã‹è¦‹ã‚‹ã“ã¨ã®ã§ããªã„çµ¶æ™¯ãƒã‚¤ãƒ³ãƒˆã‚‚å¤šæ•°ã‚ã‚Šã€è‡ªç„¶å†™çœŸæ„›å¥½å®¶ã«ã‚‚äººæ°—ã®é«˜ã„ã‚¹ãƒãƒƒãƒˆã¨ãªã£ã¦ã„ã¾ã™ã€‚'
            },
            {
              h2: 'å¤§ç‰§æ¸©æ³‰ã¨ã®é€£æºè¦³å…‰',
              content: 'éŠè¦§èˆ¹ã®ç›®çš„åœ°ã§ã‚ã‚‹å¤§ç‰§æ¸©æ³‰ã¯ã€åº„å·å³¡ã®è‡ªç„¶ã«å›²ã¾ã‚ŒãŸç§˜æ¹¯ã¨ã—ã¦çŸ¥ã‚‰ã‚Œã¦ã„ã¾ã™ã€‚éŠè¦§èˆ¹ã§ã®ã‚¢ã‚¯ã‚»ã‚¹ã®ã¿ã¨ã„ã†ç‰¹åˆ¥æ„ŸãŒã€éæ—¥å¸¸çš„ãªæ¸©æ³‰ä½“é¨“ã‚’æ¼”å‡ºã—ã¦ã„ã¾ã™ã€‚æ¸©æ³‰æ–½è¨­ã§ã¯æ—¥å¸°ã‚Šå…¥æµ´ã‚‚å¯èƒ½ã§ã€èˆ¹æ—…ã¨æ¸©æ³‰ã‚’çµ„ã¿åˆã‚ã›ãŸè´…æ²¢ãªä¸€æ—¥ã‚’éã”ã™ã“ã¨ãŒã§ãã¾ã™ã€‚ã¾ãŸã€æ¸©æ³‰ã‹ã‚‰ã®å¸°ã‚Šã®èˆ¹ä¾¿ã§ã¯ã€å¤•æ—¥ã«æŸ“ã¾ã‚‹åº„å·å³¡ã®ç¾ã—ã„æ™¯è‰²ã‚’æ¥½ã—ã‚€ã“ã¨ãŒã§ãã€ä¸€æ—¥ã®ç· ã‚ããã‚Šã«ãµã•ã‚ã—ã„æ„Ÿå‹•çš„ãªä½“é¨“ã¨ãªã‚Šã¾ã™ã€‚ç ºæ³¢å¸‚ã®è¦³å…‰è³‡æºã¨ã—ã¦ã€éŠè¦§èˆ¹ã¨æ¸©æ³‰ã®é€£æºã¯é‡è¦ãªå½¹å‰²ã‚’æœãŸã—ã¦ã„ã¾ã™ã€‚'
            }
          ];
        } else {
          // æ±ç”¨çš„ãªæ‹¡å……ã‚³ãƒ³ãƒ†ãƒ³ãƒ„
          additionalSections = [
            {
              h2: `${article.category}ã®é­…åŠ›ã¨æ–‡åŒ–`,
              content: `${article.category}ã¯å¯Œå±±çœŒã®ä¸­ã§ã‚‚ç‹¬ç‰¹ã®æ–‡åŒ–ã¨æ­´å²ã‚’æŒã¤åœ°åŸŸã¨ã—ã¦çŸ¥ã‚‰ã‚Œã¦ã„ã¾ã™ã€‚è±Šã‹ãªè‡ªç„¶ç’°å¢ƒã¨ä¼çµ±çš„ãªæ–‡åŒ–ãŒèª¿å’Œã—ãŸè¡—ä¸¦ã¿ã¯ã€è¨ªã‚Œã‚‹äººã€…ã«æ·±ã„å°è±¡ã‚’ä¸ãˆã¾ã™ã€‚åœ°å…ƒã®æ–¹ã€…ã®æ¸©ã‹ã„ãŠã‚‚ã¦ãªã—ã¨ã€å­£ç¯€ã”ã¨ã«å¤‰åŒ–ã™ã‚‹ç¾ã—ã„æ™¯è¦³ã¯ã€ä¸€åº¦è¨ªã‚ŒãŸäººã‚’é­…åŠ›ã—ç¶šã‘ã¦ã„ã¾ã™ã€‚ã¾ãŸã€åœ°åŸŸç‰¹æœ‰ã®é£Ÿæ–‡åŒ–ã‚„ä¼çµ±å·¥èŠ¸ã‚‚å—ã‘ç¶™ãŒã‚Œã¦ãŠã‚Šã€ç¾ä»£ã«ãŠã„ã¦ã‚‚ãã®ä¾¡å€¤ã‚’ä¿ã¡ç¶šã‘ã¦ã„ã¾ã™ã€‚è¦³å…‰åœ°ã¨ã—ã¦ã®é­…åŠ›ã ã‘ã§ãªãã€ä½æ°‘ã®æš®ã‚‰ã—ã«æ ¹ã–ã—ãŸæœ¬ç‰©ã®æ–‡åŒ–ã‚’ä½“é¨“ã§ãã‚‹è²´é‡ãªå ´æ‰€ã¨ã„ãˆã‚‹ã§ã—ã‚‡ã†ã€‚`
            },
            {
              h2: 'ã‚¢ã‚¯ã‚»ã‚¹ã¨å‘¨è¾ºã®è¦‹ã©ã“ã‚',
              content: `${article.category}ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã¯ã€å…¬å…±äº¤é€šæ©Ÿé–¢ã¨è‡ªå®¶ç”¨è»Šã®ä¸¡æ–¹ã§ä¾¿åˆ©ã§ã™ã€‚å¯Œå±±é§…ã‹ã‚‰ã®æ¥ç¶šã‚‚è‰¯å¥½ã§ã€çœŒå¤–ã‹ã‚‰ã®è¦³å…‰å®¢ã«ã‚‚è¨ªã‚Œã‚„ã™ã„ç«‹åœ°ã«ã‚ã‚Šã¾ã™ã€‚å‘¨è¾ºã«ã¯ä»–ã®è¦³å…‰ã‚¹ãƒãƒƒãƒˆã‚‚ç‚¹åœ¨ã—ã¦ãŠã‚Šã€ä¸€æ—¥ã‹ã‘ã¦ã˜ã£ãã‚Šã¨åœ°åŸŸã®é­…åŠ›ã‚’å ªèƒ½ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚å››å­£ã‚’é€šã˜ã¦ç•°ãªã‚‹è¡¨æƒ…ã‚’è¦‹ã›ã‚‹è‡ªç„¶ç’°å¢ƒã¯ã€ä½•åº¦è¨ªã‚Œã¦ã‚‚æ–°ã—ã„ç™ºè¦‹ãŒã‚ã‚Šã¾ã™ã€‚åœ°åŸŸã®è¦³å…‰æ¡ˆå†…æ‰€ã‚„ãƒ“ã‚¸ã‚¿ãƒ¼ã‚»ãƒ³ã‚¿ãƒ¼ã§ã¯ã€è©³ç´°ãªæƒ…å ±æä¾›ã‚‚è¡Œã£ã¦ãŠã‚Šã€åˆã‚ã¦è¨ªã‚Œã‚‹æ–¹ã§ã‚‚å®‰å¿ƒã—ã¦è¦³å…‰ã‚’æ¥½ã—ã‚€ã“ã¨ãŒã§ãã‚‹ç’°å¢ƒãŒæ•´ã£ã¦ã„ã¾ã™ã€‚`
            }
          ];
        }
        
        // è¿½åŠ ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¨˜äº‹ã«æŒ¿å…¥
        additionalSections.forEach((section, index) => {
          enhancedBody.push({
            _type: 'block',
            _key: `enhanced-h2-${index + 1}-${Date.now()}`,
            style: 'h2',
            children: [{
              _type: 'span',
              _key: `enhanced-h2-span-${index + 1}-${Date.now()}`,
              text: section.h2,
              marks: []
            }],
            markDefs: []
          });
          
          enhancedBody.push({
            _type: 'block',
            _key: `enhanced-content-${index + 1}-${Date.now()}`,
            style: 'normal',
            children: [{
              _type: 'span',
              _key: `enhanced-content-span-${index + 1}-${Date.now()}`,
              text: section.content,
              marks: []
            }],
            markDefs: []
          });
        });
        
        // è¨˜äº‹ã‚’æ›´æ–°
        await client
          .patch(article._id)
          .set({
            body: enhancedBody,
            _updatedAt: new Date().toISOString()
          })
          .commit();
        
        console.log('   âœ… è¨˜äº‹ã‚’æ‹¡å……ã—ã¾ã—ãŸ');
        successCount++;
        
        await new Promise(resolve => setTimeout(resolve, 1000));
        
      } catch (error) {
        console.log(`   âŒ ã‚¨ãƒ©ãƒ¼: ${error.message}`);
      }
    }
    
    console.log(`\nğŸ‰ ä¸­æ–‡è¨˜äº‹æ‹¡å……å®Œäº†ï¼`);
    console.log(`âœ… æˆåŠŸ: ${successCount}ä»¶`);
    
    // æœ€çµ‚çµ±è¨ˆç¢ºèª
    const shortArticles = await client.fetch(`count(*[_type == "post" && length(pt::text(body)) < 500])`);
    const mediumArticlesRemaining = await client.fetch(`count(*[_type == "post" && length(pt::text(body)) >= 500 && length(pt::text(body)) < 1000])`);
    const longArticles = await client.fetch(`count(*[_type == "post" && length(pt::text(body)) >= 1000])`);
    const totalPosts = await client.fetch(`count(*[_type == "post"])`);
    
    console.log(`\nğŸ“Š æ›´æ–°å¾Œã‚³ãƒ³ãƒ†ãƒ³ãƒ„å“è³ª:`);
    console.log(`ğŸ“„ çŸ­æ–‡è¨˜äº‹ (<500æ–‡å­—): ${shortArticles}ä»¶`);
    console.log(`ğŸ“‘ ä¸­æ–‡è¨˜äº‹ (500-999æ–‡å­—): ${mediumArticlesRemaining}ä»¶`);
    console.log(`ğŸ“” é•·æ–‡è¨˜äº‹ (1000æ–‡å­—ä»¥ä¸Š): ${longArticles}ä»¶`);
    
    const longArticlePercentage = Math.round((longArticles / totalPosts) * 100);
    console.log(`ğŸ¯ é•·æ–‡è¨˜äº‹ç‡: ${longArticlePercentage}%`);
    
    if (longArticlePercentage >= 85) {
      console.log('ğŸŠ é•·æ–‡è¨˜äº‹85%é”æˆï¼');
    }
    
  } catch (error) {
    console.error('âŒ ã‚¨ãƒ©ãƒ¼:', error.message);
  }
}

expandMediumArticles();