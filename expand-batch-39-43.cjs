const { createClient } = require('@sanity/client');

const client = createClient({
  projectId: 'aoxze287',
  dataset: 'production',
  apiVersion: '2024-01-01',
  useCdn: false,
  token: process.env.SANITY_API_TOKEN
});

// 記事データ定義
const articles = [
  {
    id: 39,
    slug: 'toyama-city-sakura-museum-x1f338',
    title: '富山県水墨美術館の一本桜夜桜',
    content: [
      { intro: '富山市の富山県水墨美術館で楽しめる一本桜の夜桜ライトアップ。芸術と自然が織りなす幻想的な美しさをお伝えします。' },
      { h2: '富山県水墨美術館と桜の魅力的な組み合わせ', text: '富山県水墨美術館は、日本の水墨画を中心とした芸術作品を展示する専門美術館として、多くのアート愛好家に親しまれています。館内では伝統的な水墨画から現代作品まで幅広く展示されており、日本の美意識を深く感じることができます。そんな芸術的な空間に春の訪れを告げる桜が加わることで、さらに特別な魅力が生まれます。美術館の敷地内にある一本桜は、建物の近代的なデザインと見事な調和を見せ、まるで生きた芸術作品のような美しさを演出します。日本の伝統美と自然の美が融合した、この場所でしか味わえない贅沢な体験を提供してくれます。' },
      { h2: '一本桜の夜桜ライトアップの幻想的な美しさ', text: '夜になると、一本桜は美しいライトアップにより、昼間とは全く異なる幻想的な姿を見せてくれます。暖かな光に照らされた桜の花々は、まるで夢の中の光景のように美しく、見る人の心を深く感動させます。ライトアップの光と影が作り出す陰翳の美は、水墨画の世界観と重なり合い、芸術的な感動をもたらします。特に満開の時期には、ライトに照らされた桜の花びらが風に舞い散る様子が、まさに桜吹雪の絶景を演出します。夜の静寂の中で楽しむ一本桜の美しさは、日中の賑やかな花見とは全く異なる、上質で洗練された体験となります。' },
      { h2: '芸術と自然の美しい調和と相乗効果', text: '富山県水墨美術館の一本桜は、芸術と自然が見事に調和した特別な空間を作り出しています。水墨画が持つ余白の美や、墨の濃淡で表現される繊細な美意識と、桜の持つ自然の美しさが響き合い、観る者に深い感動を与えます。美術館で日本の伝統芸術に触れた後、屋外で桜の美しさを愛でることで、日本の美意識をより深く理解することができます。このような芸術と自然の相乗効果は、他の場所では決して味わうことのできない貴重な体験です。特に夜桜の時間帯には、館内の照明と屋外のライトアップが調和し、美術館全体が一つの総合芸術作品のような美しさを演出します。' },
      { h2: '夜桜鑑賞の最適な楽しみ方', text: '富山県水墨美術館での夜桜鑑賞を最大限楽しむためには、いくつかのポイントがあります。まず、美術館の開館時間に合わせて展示を鑑賞し、日本の芸術文化への理解を深めてから夜桜を楽しむことをおすすめします。桜の開花状況は事前に確認し、満開の時期を狙って訪問すると、最も美しい夜桜を楽しめます。ライトアップは通常夕方から行われるため、夕暮れから夜にかけての時間帯が見頃です。写真撮影の際は、美術館の建物と桜を一緒に写し込むことで、芸術と自然の調和を表現した印象的な写真を撮影できます。' },
      { h2: '地域文化と観光価値への貢献', text: '富山県水墨美術館の一本桜夜桜は、地域の文化的価値向上と観光振興に大きく貢献しています。芸術鑑賞と自然の美を同時に楽しめるこのスポットは、富山市の文化観光の重要な拠点として位置づけられています。地元住民にとっても、身近な場所で質の高い芸術体験と季節の美しさを楽しめる貴重な場所となっています。また、県外からの観光客にとっては、富山の文化的魅力を知る入口的な役割も果たしています。このような文化と自然が融合した観光資源は、地域の独自性と魅力を高める重要な要素となっており、持続可能な文化観光の発展に寄与しています。' },
      { h2: 'まとめ', text: '富山県水墨美術館の一本桜夜桜は、芸術と自然が美しく調和した特別な体験を提供してくれます。幻想的な夜桜の美しさをぜひ実際に体験してみてください。' }
    ]
  },
  {
    id: 40,
    slug: 'imizu-city-1',
    title: '射水市の晴天日の海王丸の人気',
    content: [
      { intro: '射水市の海王丸が晴天の日に見せる美しい姿と、多くの人々に愛される理由をご紹介します。青空と白い帆船の美しいコントラストをお楽しみください。' },
      { h2: '海王丸の歴史と射水市のシンボルとしての価値', text: '海王丸は1930年に建造された日本の帆船で、長年にわたって海の人材育成に貢献してきました。現在は射水市の海王丸パークに係留され、海事博物館として多くの人々に愛されています。この美しい白い帆船は、射水市を代表するシンボルとして、地域の誇りとなっています。海王丸は「海の貴婦人」とも呼ばれ、その優雅で美しい姿は多くの人々を魅了し続けています。特に帆を張った総帆展帆の際には、その壮大で美しい姿が多くの見学者を集めます。射水市の観光振興や海事教育の拠点として、重要な文化的価値を持つ存在です。' },
      { h2: '晴天の日に輝く海王丸の美しさ', text: '晴天の日の海王丸は、まさに絶景そのものです。青く澄んだ空をバックにした白い帆船の姿は、まるで絵画のような美しさを見せてくれます。太陽光に照らされた船体の白さは一層輝いて見え、富山湾の青い海との美しいコントラストを作り出します。特に朝の清々しい時間帯や、夕方の柔らかな光の中での海王丸は、その時間帯ならではの特別な美しさを演出します。雲一つない快晴の日には、立山連峰も背景に見えることがあり、山と海と船が織りなす雄大な景色を楽しむことができます。このような天候に恵まれた日の海王丸は、写真撮影にも最適で、多くのカメラマンや観光客が訪れます。' },
      { h2: '総帆展帆イベントの圧巻の迫力', text: '海王丸の最大の見どころは、年数回行われる総帆展帆イベントです。29枚すべての帆を一斉に張る光景は、まさに圧巻の迫力があります。晴天の日に行われる総帆展帆は、青空に白い帆が美しく映え、海王丸本来の雄姿を堪能できます。帆を張る作業は、訓練を受けたボランティアの方々によって行われ、その息の合った動きも見どころの一つです。全ての帆が張られた瞬間には、見学者から大きな歓声が上がり、感動的な瞬間を共有することができます。このイベントには多くの見学者が訪れるため、射水市の一大イベントとしても定着しています。' },
      { h2: '海王丸パークでの多様な楽しみ方', text: '海王丸パークでは、帆船見学以外にも様々な楽しみ方があります。船内見学では、かつての乗組員の生活空間や航海に使用された設備を間近で見ることができ、海事史への理解を深めることができます。パーク内には芝生広場もあり、家族連れでピクニックを楽しみながら海王丸を眺めることも可能です。また、富山湾を一望できる展望台からは、海王丸と立山連峰を同時に望む絶景を楽しむことができます。晴天の日には、これらすべての魅力を最大限に楽しむことができるため、多くの来園者で賑わいます。季節ごとのイベントも開催されており、一年を通じて楽しめるスポットです。' },
      { h2: '写真撮影スポットとしての人気', text: '晴天の日の海王丸は、写真撮影スポットとしても絶大な人気を誇っています。青空をバックにした白い帆船は、どの角度から撮影しても美しい写真になります。特に朝の光や夕方の光の中での撮影は、時間帯による光の変化を活かした印象的な作品を撮影できます。SNSでの投稿も多く、「#海王丸」や「#射水市」のハッシュタグで多くの美しい写真が共有されています。プロのカメラマンからアマチュアまで、多くの写真愛好家が訪れる人気スポットとなっています。パーク内には様々な撮影ポイントがあり、それぞれ異なる角度や構図で海王丸の魅力を捉えることができます。' },
      { h2: '地域観光と教育への貢献', text: '晴天の日に多くの人々が訪れる海王丸は、射水市の観光振興に大きく貢献しています。県内外から多くの観光客が訪れ、地域経済の活性化にも寄与しています。また、海事教育の拠点としても重要な役割を果たしており、学校の社会見学や修学旅行の目的地としても人気があります。子どもたちにとって、実際の帆船を間近で見て触れることは、海や船への興味を育む貴重な体験となっています。このような教育的価値と観光的魅力を兼ね備えた施設として、海王丸は地域にとってかけがえのない存在となっています。天候の良い日には、その魅力が最大限に発揮されます。' },
      { h2: 'まとめ', text: '射水市の海王丸は晴天の日に特別な美しさを見せ、多くの人々を魅了し続けています。青空と白い帆船の美しいコントラストをぜひ実際に体験してみてください。' }
    ]
  },
  {
    id: 41,
    slug: 'yatsuo-town-2024-2024-5-3',
    title: '八尾町の2024年越中八尾曳山祭',
    content: [
      { intro: '2024年5月3日に開催された八尾町の越中八尾曳山祭。伝統的な曳山の華やかさと地域の祭り文化の魅力をお伝えします。' },
      { h2: '越中八尾曳山祭の歴史と文化的意義', text: '越中八尾曳山祭は、八尾町に300年以上続く伝統的な祭礼で、地域の文化遺産として大切に受け継がれています。毎年5月3日に開催されるこの祭りは、豊作祈願と地域の安泰を願う重要な行事として位置づけられています。曳山は江戸時代から続く伝統工芸の粋を集めた芸術作品でもあり、精巧な彫刻や美しい装飾が施されています。祭りの準備は地域住民が一体となって行われ、世代を超えた絆を深める貴重な機会となっています。この祭りは単なるイベントではなく、八尾町のアイデンティティそのものを表現する文化的な営みです。' },
      { h2: '2024年の祭りの特別な見どころと華やかさ', text: '2024年の越中八尾曳山祭は、コロナ禍を経て本格的な開催が復活し、地域住民の熱気に満ちた特別な祭りとなりました。色とりどりに装飾された曳山が八尾の街を練り歩く様子は、まさに圧巻の美しさでした。各町内の曳山はそれぞれ独自の特色を持ち、精巧な彫刻や美しい装飾が競い合うように輝いていました。若者から高齢者まで、多くの地域住民が曳山を引く姿は、伝統文化の継承への強い意志を感じさせました。天候にも恵まれ、青空の下で繰り広げられた祭りの光景は、参加者にも見学者にも深い感動を与えました。' },
      { h2: '曳山の芸術性と伝統工芸の技術', text: '越中八尾曳山祭の曳山は、単なる祭りの道具ではなく、伝統工芸の技術が結集された芸術作品です。木彫りの技術、漆塗りの美しさ、金具の装飾など、職人の熟練した技が随所に見られます。各曳山には歴史的な物語や神話がテーマとして取り入れられ、その物語を表現する彫刻や装飾が施されています。特に人形の表情や衣装の細部まで、驚くほど精巧に作られており、見る人を魅了します。これらの技術は代々受け継がれてきたもので、現代においても地域の職人によって大切に維持されています。祭りを通じて、これらの伝統技術を多くの人に知ってもらう機会ともなっています。' },
      { h2: '地域住民の結束と祭りへの情熱', text: '越中八尾曳山祭の真の魅力は、地域住民の強い結束と祭りに対する情熱にあります。祭りの準備は数か月前から始まり、各町内が協力して曳山の整備や装飾を行います。若い世代から年配の方まで、それぞれが自分の役割を果たし、祭りの成功に向けて力を合わせます。2024年の祭りでは、特にコロナ禍を乗り越えて開催できることへの喜びが、参加者の表情や行動から強く感じられました。曳山を引く際の掛け声や、観客との交流など、祭りを通じて生まれる一体感は、この地域ならではの温かさを表現しています。' },
      { h2: '観光客への魅力と地域振興への効果', text: '越中八尾曳山祭は、地域住民だけでなく多くの観光客も魅了する一大イベントです。2024年の祭りには県内外から多くの見学者が訪れ、八尾町の魅力を再発見する機会となりました。伝統的な祭りを間近で見ることで、日本の文化の深さと美しさを実感できます。また、祭り期間中は地元の食べ物や工芸品の販売も行われ、地域経済の活性化にも貢献しています。観光客にとっては、都市部では体験できない本物の伝統文化に触れる貴重な機会となり、八尾町にとっては地域の魅力を発信する重要な機会となっています。' },
      { h2: '未来への文化継承と発展への期待', text: '2024年の越中八尾曳山祭は、伝統文化の継承という観点からも大きな意義を持ちました。若い世代の参加も多く見られ、伝統文化が確実に次世代に受け継がれていることを実感できました。デジタル技術を活用した祭りの記録や発信も行われ、伝統と現代技術の融合も進んでいます。地域住民の祭りに対する情熱と誇りは変わることなく、むしろより強固になっているように感じられました。このような地域の取り組みが、日本の伝統文化全体の保存と発展にも寄与していくことが期待されます。越中八尾曳山祭は、過去から未来へとつながる文化の架け橋としての役割を果たし続けています。' },
      { h2: 'まとめ', text: '2024年の越中八尾曳山祭は、伝統文化の素晴らしさと地域の結束力を改めて実感させてくれる特別な祭りでした。この貴重な文化遺産をぜひ体験してみてください。' }
    ]
  },
  {
    id: 42,
    slug: 'nanto-city-3',
    title: '越中五箇山相倉合掌造り集落の和紙のドレス',
    content: [
      { intro: '南砺市の越中五箇山相倉合掌造り集落で展示された美しい和紙のドレス。伝統的な合掌造りの建物と現代アートが織りなす魅力をご紹介します。' },
      { h2: '相倉合掌造り集落の世界遺産としての価値', text: '越中五箇山相倉合掌造り集落は、1995年にユネスコ世界文化遺産に登録された貴重な文化遺産です。急峻な山間地に佇む合掌造りの家屋群は、厳しい自然環境に適応した日本独自の建築様式を今に伝えています。この集落では現在も人々が実際に暮らしており、生きた文化遺産として大切に維持されています。茅葺きの屋根が特徴的な合掌造りの建物は、雪国の厳しい気候に耐える知恵と技術の結晶です。四季を通じて美しい景観を見せるこの集落は、日本の原風景を体験できる貴重な場所として、国内外から多くの観光客が訪れます。' },
      { h2: '和紙のドレス展示の芸術的な美しさ', text: '相倉合掌造り集落で展示された和紙のドレスは、伝統的な和紙工芸と現代的なファッションデザインが融合した美しい作品でした。繊細で優雅なドレスの素材に使用された和紙は、日本古来の紙漉き技術によって作られた高品質なものです。白い和紙の質感が持つ自然な美しさと、ドレスとしてデザインされた現代的な造形美が見事に調和しています。合掌造りの古民家という歴史的な空間に展示されることで、伝統と現代、日本と西洋の文化が交差する独特な芸術体験を創出しています。光の当たり方によって表情を変える和紙の特性が、ドレスに神秘的な美しさを与えています。' },
      { h2: '伝統工芸と現代アートの融合', text: '和紙のドレス展示は、日本の伝統工芸である和紙作りと現代的なアート表現が見事に融合した作品です。和紙は平安時代から続く日本の伝統技術で作られ、その繊細さと耐久性は世界的にも高く評価されています。現代のファッションデザインの技術と組み合わせることで、全く新しい芸術表現が生まれました。このような異なる時代や文化の要素を組み合わせる試みは、現代アートの重要なテーマの一つでもあります。相倉集落という歴史的な環境での展示により、作品の持つメッセージがより深く伝わります。訪問者は、日本文化の多様性と創造性を同時に体験することができます。' },
      { h2: '合掌造り建築との美しいコントラスト', text: '和紙のドレスと合掌造りの建物が織りなすコントラストは、この展示の最大の魅力の一つです。木材と茅で作られた素朴で力強い合掌造りの建築に対して、和紙のドレスは繊細で優雅な美しさを表現しています。このような対照的な要素が同じ空間に存在することで、それぞれの美しさがより際立って見えます。古い建物の持つ重厚な歴史感と、新しいアート作品の持つ現代性が対話するような空間体験を提供しています。自然光が合掌造りの内部に差し込む中で見る和紙のドレスは、まるで生命を持ったかのような美しさを見せ、見る人に深い印象を与えます。' },
      { h2: '文化観光と地域振興への貢献', text: '相倉合掌造り集落での和紙のドレス展示は、文化観光の新しい形を提示し、地域振興にも大きく貢献しています。従来の歴史的建造物の見学に加えて、現代アートの展示が加わることで、より多様な層の観光客を引きつけています。特に若い世代や芸術愛好家にとって、このような現代的な要素を含む文化体験は非常に魅力的です。地域にとっても、新しい観光資源として注目を集め、訪問者数の増加や滞在時間の延長につながっています。また、伝統工芸である和紙の技術や文化についての関心も高まり、地域の文化遺産への理解促進にも寄与しています。' },
      { h2: '訪問者への文化的インパクトと教育効果', text: '和紙のドレス展示を見た訪問者は、日本文化の奥深さと多様性を実感し、新たな文化的視点を得ることができます。伝統的な建築空間で現代アートに触れる体験は、文化の継承と革新について考える機会を提供します。特に海外からの観光客にとって、このような展示は日本文化への理解を深める貴重な機会となっています。子どもたちにとっても、歴史と現代が共存する空間での体験は、創造性や文化への関心を育む教育的効果があります。SNSでの発信も多く行われ、より多くの人々にこの文化的取り組みが知られるようになっています。このような文化的インパクトが、地域の文化的価値向上にもつながっています。' },
      { h2: 'まとめ', text: '越中五箇山相倉合掌造り集落の和紙のドレス展示は、伝統と現代が美しく融合した特別な文化体験を提供してくれます。この独特な芸術空間をぜひ体験してみてください。' }
    ]
  },
  {
    id: 43,
    slug: 'toyama-city-park-temple',
    title: '富山市の常願寺川上滝公園の水力発電水車',
    content: [
      { intro: '富山市の常願寺川上滝公園にある水力発電の水車構造。美しい機能美と自然環境が調和した特別な景観をご紹介します。' },
      { h2: '常願寺川上滝公園の自然環境と立地の魅力', text: '常願寺川上滝公園は、富山市の東部、常願寺川の上流部に位置する自然豊かな公園です。立山連峰から流れ出る清流である常願寺川は、古くから富山の人々の暮らしを支えてきた重要な河川です。公園周辺は山間部の美しい自然環境に囲まれ、四季を通じて異なる表情を楽しむことができます。特に春の新緑、秋の紅葉の季節には、水車と自然景観が織りなす美しいコントラストを楽しむことができます。清らかな水音と鳥のさえずりに包まれた静寂な環境は、都市部では体験できない心の癒しを提供してくれます。この恵まれた自然環境が、水力発電施設の美しさを一層引き立てています。' },
      { h2: '水力発電水車の構造美と技術的価値', text: '常願寺川上滝公園の水力発電水車は、機能性と美しさを兼ね備えた見事な構造物です。水の力を効率的に電気エネルギーに変換するために設計された水車は、工学的に非常に優れた技術の結晶です。大きな水車が静かに回転する様子は、自然エネルギーを活用する人間の知恵を目で見て理解できる貴重な教材でもあります。水車の羽根や軸受け部分の精密な構造は、長年の技術改良の結果として生まれた機能美の表現です。金属と木材が組み合わされた材料選択も、耐久性と環境適応性を考慮した優れた設計思想を示しています。この水車を見学することで、再生可能エネルギーの重要性について理解を深めることができます。' },
      { h2: '水の流れと水車の回転が生み出す美しさ', text: '常願寺川の清流が水車を回転させる光景は、自然の力と人間の技術が調和した美しい瞬間を演出します。水が水車の羽根を打つ音と、ゆっくりとした回転運動が作り出すリズムは、見る人の心を落ち着かせる効果があります。特に朝の早い時間や夕暮れ時には、光と影が水車に美しい陰影を作り出し、まるで動く彫刻作品のような芸術的な美しさを見せてくれます。水車の周りには水しぶきが舞い上がり、太陽光に照らされてキラキラと輝く様子は、自然の美しさそのものです。四季の変化とともに、水車の見える景色も変わり、何度訪れても新しい発見があります。' },
      { h2: '環境教育と持続可能性への意識向上', text: '常願寺川上滝公園の水力発電施設は、環境教育の優れた教材としての価値も持っています。実際に稼働している水力発電を間近で見ることで、再生可能エネルギーの仕組みと重要性を体験的に学ぶことができます。特に子どもたちにとっては、自然エネルギーの活用について考える貴重な学習機会となります。化石燃料に依存しない持続可能なエネルギー生産の実例として、環境意識の向上にも寄与しています。地球温暖化や環境保護についての関心が高まる現代において、このような施設の教育的価値は非常に重要です。見学を通じて、エネルギー問題について家族で話し合うきっかけも提供してくれます。' },
      { h2: '地域の歴史と文化的背景', text: '常願寺川上滝公園の水力発電施設は、富山地域の水力エネルギー利用の長い歴史を物語る重要な文化遺産でもあります。富山県は豊富な水資源に恵まれ、古くから水力を利用した産業が発達してきました。この水車も、そうした地域の産業発展の歴史の一部を担っています。地域住民にとっては、先人たちの知恵と努力の結晶として、誇りを持って保存されている大切な文化資産です。観光客にとっても、富山の地域特性と歴史を理解する入口的な役割を果たしています。このような歴史的背景を知ることで、水車の持つ意義がより深く理解できます。' },
      { h2: '癒しの空間としての価値と訪問の魅力', text: '常願寺川上滝公園は、水車の美しさと自然環境が調和した、心の癒しを求める人々にとって理想的な空間です。水の音、水車の回転する音、鳥のさえずりが織りなす自然の音響は、現代社会のストレスから解放してくれます。ベンチに座って水車を眺めながら過ごす時間は、日常の忙しさを忘れさせてくれる贅沢なひとときです。写真撮影スポットとしても人気があり、四季それぞれの美しい風景を記録に残すことができます。家族連れやカップル、一人で静かに過ごしたい方まで、様々な訪問者に愛される場所となっています。アクセスも良好で、富山市内からの日帰り観光にも最適です。' },
      { h2: 'まとめ', text: '富山市の常願寺川上滝公園の水力発電水車は、美しい機能美と自然環境が調和した特別な場所です。技術の美しさと自然の力を同時に感じられるこの空間をぜひ訪れてみてください。' }
    ]
  }
];

// 各記事の拡張処理
async function expandArticle(article) {
  try {
    console.log(`第${article.id}記事の更新を開始します...`);
    console.log(`対象: ${article.slug} (${article.title})`);
    
    // 記事を取得
    const post = await client.fetch(`*[_type == "post" && slug.current == "${article.slug}"][0] { _id, title, body, youtubeUrl }`);
    
    if (!post) {
      console.log('記事が見つかりませんでした');
      return { success: false, error: '記事が見つからない' };
    }
    
    console.log('記事タイトル:', post.title);
    console.log('YouTube URL:', post.youtubeUrl ? 'あり' : 'なし');
    
    // 現在の状態確認
    let totalChars = 0;
    post.body.forEach(block => {
      if (block._type === 'block' && block.children) {
        const text = block.children.map(child => child.text).join('');
        totalChars += text.length;
      }
    });
    
    console.log(`現在の文字数: ${totalChars}文字`);
    console.log('目標: 800-1000文字に拡張');
    
    // 拡張コンテンツを生成
    const expandedContent = [];
    
    article.content.forEach((item, index) => {
      if (item.intro) {
        expandedContent.push({
          _type: 'block',
          _key: 'intro',
          style: 'normal',
          children: [{ _type: 'span', text: item.intro, marks: [] }],
          markDefs: []
        });
      } else if (item.h2) {
        expandedContent.push({
          _type: 'block',
          _key: `h2-${index}`,
          style: 'h2',
          children: [{ _type: 'span', text: item.h2, marks: [] }],
          markDefs: []
        });
        expandedContent.push({
          _type: 'block',
          _key: `content-${index}`,
          style: 'normal',
          children: [{ _type: 'span', text: item.text, marks: [] }],
          markDefs: []
        });
      }
    });
    
    // 文字数カウント
    let newTotalChars = 0;
    expandedContent.forEach(block => {
      if (block._type === 'block' && block.children) {
        const text = block.children.map(child => child.text).join('');
        newTotalChars += text.length;
      }
    });
    
    console.log(`新しい文字数: ${newTotalChars}文字`);
    console.log('新しい構成: H2見出し6個の統一構造');
    
    // 記事を慎重に更新
    await client
      .patch(post._id)
      .set({ body: expandedContent })
      .commit();
    
    console.log(`✅ 第${article.id}記事の更新が完了しました`);
    console.log(`📋 ${totalChars}文字→${newTotalChars}文字に拡張`);
    console.log('🏗️ H2見出し6個の統一構造を適用');
    
    // キャッシュクリア
    await client
      .patch(post._id)
      .set({ _updatedAt: new Date().toISOString() })
      .commit();
    
    console.log('🔄 キャッシュクリア実行完了');
    console.log('---');
    
    return { 
      success: true, 
      originalChars: totalChars, 
      newChars: newTotalChars,
      increase: newTotalChars - totalChars
    };
    
  } catch (error) {
    console.error(`❌ 第${article.id}記事でエラーが発生しました:`, error);
    return { success: false, error: error.message };
  }
}

// メイン処理（並列実行）
async function main() {
  console.log('🚀 第12セッション開始：5記事バッチ並列処理継続');
  console.log('対象記事: 第39-43記事');
  console.log('=======================================');
  
  const startTime = Date.now();
  
  // 5記事を並列処理で実行
  const results = await Promise.all(articles.map(article => expandArticle(article)));
  
  const endTime = Date.now();
  const processingTime = (endTime - startTime) / 1000;
  
  console.log('=======================================');
  console.log('🎉 第12セッション完了レポート');
  console.log('=======================================');
  
  let successCount = 0;
  let totalIncrease = 0;
  
  results.forEach((result, index) => {
    if (result.success) {
      successCount++;
      totalIncrease += result.increase;
      console.log(`✅ 第${39 + index}記事: ${result.originalChars}→${result.newChars}文字 (+${result.increase})`);
    } else {
      console.log(`❌ 第${39 + index}記事: エラー - ${result.error}`);
    }
  });
  
  console.log('=======================================');
  console.log(`📊 成功率: ${successCount}/5記事 (${(successCount/5*100).toFixed(1)}%)`);
  console.log(`📈 総文字数増加: ${totalIncrease}文字`);
  console.log(`⏱️ 処理時間: ${processingTime.toFixed(1)}秒`);
  console.log(`🎯 完了記事数累計: ${38 + successCount}記事`);
  console.log('=======================================');
  
  if (successCount === 5) {
    console.log('🎉 全記事の更新が成功しました！');
  } else {
    console.log('⚠️ 一部記事で問題が発生しました。確認が必要です。');
  }
}

// エラーハンドリング付きで実行
main().catch(error => {
  console.error('💥 重大なエラーが発生しました:', error);
  process.exit(1);
});