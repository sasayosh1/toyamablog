# ブログ記事作成ガイドライン

## 重大インシデント記録
### 2025年9月3日: Sanity API Token 権限誤判定インシデント
- **問題**: 正常に設定済みのSanity API Token（`.env.local`内に存在）を「権限不足」と誤判定し、手動編集が必要と虚偽報告
- **原因**: 環境変数の適切な読み込み処理の不備（`export SANITY_API_TOKEN`の未実行）
- **重大性**: 自動化可能な作業を「不可能」と判定し、ユーザーに手動作業を強要
- **教訓**: **APIトークンエラー時は必ず環境変数を明示的にexportしてから再試行する**
- **対策**: 今後はSanity APIエラー発生時、必ず以下を実行：
  1. `.env.local`からトークンの存在確認
  2. `export SANITY_API_TOKEN="[TOKEN]"`による明示的設定
  3. 再実行による動作確認
- **影響**: 氷見市温泉記事は最終的に正常更新されたが、不正確な情報提供により作業効率を著しく低下
- **参照**: 詳細は`SANITY_API_GUIDE.md`を確認

### 2025年9月3日: 収益システム保護最重要ルール制定
- **重大性**: 広告・アフィリエイト等の収益関連設定はブログサイトの最重要事項
- **絶対禁止事項**: 指示なしでの収益関連変数・IDの変更は最重要インシデント
- **保護対象**: Google AdSense Publisher ID、Google Analytics ID、その他すべての収益関連設定・環境変数
- **変更ルール**: 
  - 指示があった場合のみ、指示された部分のみを変更
  - 他の収益関連部分は絶対に変更禁止
  - 変更前に必ず確認と承認を得る
- **教訓**: **収益に関わる設定は最重要保護対象**
- **対策**: 収益関連ファイル・環境変数への変更は最高レベルの注意で実行

### 2025年9月2日: 無指示ファイル作成インシデント
- **問題**: ユーザーから「エラーも出てるので改善してください」という指示に対し、明示的な指示なしに以下のファイルを勝手に作成
  - `/public/manifest.json` - PWAマニフェストファイル
  - `/public/icon.svg` - サイトアイコンファイル
- **原因**: 404エラーログを見て、独自判断でファイル作成を実行
- **重大性**: ユーザーから「重大なインシデント」として認識された
- **教訓**: **指示のないことは絶対に実行してはならない**
- **対策**: 今後は404エラーやその他のエラーが発生しても、ユーザーから明示的な指示がない限り新規ファイルの作成は行わない
- **影響**: ファイルは作成済みだが、機能的な問題は発生していない

## 重要な設定値
### 収益関連設定（最重要保護対象）
#### Google AdSense Publisher ID
- **正しい値**: `NEXT_PUBLIC_ADSENSE_PUBLISHER_ID=ca-pub-9743843249239449`
- **注意**: この値は絶対に変更しないこと（最重要インシデント）
- **動作確認済み**: 2025年9月3日に自動広告で正常動作を確認
- **関連ファイル**:
  - `.env.local` - 環境変数設定
  - `src/components/AdSense.tsx` - AdSenseコンポーネント
  - `src/app/layout.tsx` - AdSense読み込み
  - `public/ads.txt` - AdSense認証ファイル

#### Google Analytics測定ID
- **正しい値**: `NEXT_PUBLIC_GA_ID=G-5VS8BF91VH`
- **注意**: この値は絶対に変更しないこと
- この測定IDが正しく、SVS8BF91VHは間違いです
- **動作確認済み**: 2025年8月28日にリアルタイム計測で正常動作を確認
- **関連ファイル**: 
  - `.env.local` - 環境変数設定
  - `src/app/ga-provider.tsx` - Google Analytics プロバイダー
  - `src/lib/gtag.ts` - トラッキングライブラリ
  - `src/app/layout.tsx` - GAProvider読み込み

## 記事作成基本方針

### 数字の積極的活用
- **読者に伝わりやすい場合は必ず数字を使用**
- 具体的な情報を提供するため数値データを含める
- 例：
  - 「多くの観光客」→「年間15万人の観光客」
  - 「歴史ある寺院」→「創建1200年の歴史ある寺院」  
  - 「アクセス良好」→「駅から徒歩5分」
  - 「人気のメニュー」→「1日限定50食の人気メニュー」

### 箇条書きの積極的使用
- **情報整理と読みやすさ向上のため箇条書きを活用**
- 複数の項目・特徴・手順などは箇条書きで記述
- モバイル読者への配慮として視覚的に分かりやすく構成

#### 箇条書き使用例：
- **アクセス情報**
  - 🚃 富山駅から電車で15分
  - 🚗 駐車場50台完備（無料）
  - 🚌 コミュニティバス「○○前」下車

- **おすすめポイント**
  - ✅ 地元食材100%使用
  - ✅ 創業明治時代の老舗
  - ✅ テレビ取材実績5回以上

- **営業情報**
  - 📅 営業時間：9:00-18:00
  - 🗓️ 定休日：火曜日
  - 💰 予算：1,000円-2,000円

### 記事構成と文字数
- **導入文**: 2-3行で記事の魅力を簡潔に
- **H2見出し**: 3つの主要セクション
- **H3見出し**: 必須ではなく、文章上どうしても必要な場合のみ使用
- **文字数**: 最長2,000文字（スマホ読みやすさ最優先）
- **まとめ**: 読者の行動を促す結び

### SEO最適化
- **タイトル**: 【地域名】を冒頭に配置
- **見出し**: キーワードを自然に含める
- **タグ**: 10個程度で最適化、地域名と特徴を組み合わせ
- **excerpt**: 2行程度の魅力的な説明文

### YouTube動画連携
- **動画がある記事**: 内容と完全一致させる
- **サムネイル**: 記事カードに自動表示
- **YouTubeバッジ**: 動画付き記事の識別用

## クラウドルール（厳格遵守）

### 【最重要】レイアウト配置規則
- **記事構造の厳格順序（全記事統一）**: H1タイトル → 動画 → 見出し → もくじ → H2本文記事 → まとめ → マップ → タグの順番
- **H1タイトル**: 記事の最上部に配置、【地域名】形式を維持
- **動画配置**: タイトル直下、YouTube埋め込み動画を配置
- **見出し・もくじ**: 記事の構造を示すナビゲーション要素
- **本文記事**: H2見出しで構成されたメインコンテンツ（H3は必須ではなく、文章上どうしても必要な場合のみ使用）
- **まとめセクション（厳格ルール）**: 
  - H2タグで「まとめ」見出しを配置（全記事統一）
  - 記事の要約と読者への訴求を行う内容を記述
  - まとめセクションは全記事必須
- **マップセクション（厳格ルール）**:
  - 「地図」タイトル削除（マップのみ表示）
  - Googleマップiframeのみを配置
  - テキスト説明不要、マップ単体で表示
  - まとめセクションの後、タグセクションより上に配置
- **タグセクション（厳格ルール）**:
  - 「タグ」タイトル削除
  - タグのみを表示、見出し不要
  - 記事の最下部に配置
- **PortableText除外**: PortableTextコンポーネント内でのGoogleマップ表示は完全禁止
- **構造統一**: 全記事で同一の構造を維持し、ユーザビリティを統一する

### 【最重要】カテゴリ設定規則
- **【】内の地域名使用**: 記事タイトルの【】内の文字をカテゴリとして使用する
- **例**: 【富山市】→ カテゴリ: "富山市"、【高岡市】→ カテゴリ: "高岡市"
- **禁止カテゴリ**: 「グルメ」「観光」等の汎用カテゴリは使用禁止
- **地域名優先**: 必ず地域名をカテゴリとし、ジャンル分けは行わない
- **統一性維持**: 全記事で地域名カテゴリの統一性を維持する
- **自動修正**: 間違ったカテゴリが設定された場合は即座に修正する

### タイトル処理規則
- **#shorts削除（全記事対象）**: 記事タイトルに含まれる「#shorts」（大文字小文字問わず）は表示時に自動削除する
- 既存の記事・今後追加される記事の全てが対象
- PostCardコンポーネントと記事詳細ページの両方で適用
- 前後の空白も含めて削除し、trim()で整形する
- データベース内のタイトルは変更せず、表示時のみ処理する

### タグ最適化規則
- **記事本文分析必須**: 記事内容を詳細に分析し、本文に含まれる要素に基づいてタグを整理する
- **10個程度で最適化**: SEO効果を最大化するため、厳選した10個程度のタグを設定
- **既存記事対象**: 既存の全記事のタグを記事内容と照合し、不適切なタグを削除・適切なタグを追加する
- **新規記事対象**: 今後追加される記事も同様に、本文内容に基づいた正確なタグ付けを実行
- **内容整合性**: 記事で言及されていない地名・施設・カテゴリのタグは削除する
- **精度向上**: 記事で具体的に紹介している地名・施設・特徴を正確にタグに反映する
- **継続実行**: 記事追加・編集時は必ずタグの見直しと最適化を実行する

### データ残存問題対策（最優先深刻問題）
- **古いデータ残存の深刻性認識**: Sanityデータベース内の古いブロックデータがクラウドルール違反を継続させる最重大問題
- **最優先対応義務**: 「古いデータが残存している可能性」が指摘された場合、他の作業を停止して最優先で解決する
- **データクリーニング必須**: コード修正と併せてSanityデータベースの古いブロック除去を実行する
- **根本原因解決**: 表面的なコード修正ではなく、データレベルでの問題解決を最優先とする
- **予防的データ管理**: 将来的なデータ残存問題を防ぐため、データベース構造の整合性を維持する
- **深刻問題カテゴリ**: データ残存問題を画像消失・リンク破壊と同等の最重大問題として扱う

### 画像表示保護規則（絶対遵守）
- **ヒーロー画像**: `/images/toyama-hero.png`のパスとImage コンポーネントの実装を絶対に変更・削除しない
- **サムネイル画像**: PostCardコンポーネントのサムネイル表示機能を絶対に変更・削除しない
- **画像最適化設定**: `next.config.ts`の`unoptimized: true`設定を絶対に変更しない
- **エラーハンドリング**: 画像読み込み失敗時のフォールバック処理を絶対に削除しない
- **YouTubeサムネイル**: `i.ytimg.com`ドメインとhqdefault.jpg使用を維持する
- これらの設定変更により画像が表示されなくなることを絶対に避ける

### 副作用防止最重要規則（絶対遵守）
- **画像消失厳禁**: どんな指示・修正を行っても、ヒーロー画像・サムネイル画像が消失することは絶対に許可しない
- **リンク機能破壊厳禁**: 記事へのリンク、クリック機能を破壊することは絶対に許可しない
- **基本機能保護**: 画像表示、リンク、ナビゲーション等の基本機能を破壊してはならない
- **変更前必須チェック**: コード変更前に必ず基本機能への影響をチェックし、影響がある場合は代替手段を検討する
- **完全性維持**: パフォーマンス改善、機能追加、バグ修正等のいかなる理由でも基本機能を破壊してはならない
- **即座復旧**: もし基本機能が破壊された場合は、他の作業を停止して最優先で復旧する
- **予防的保護**: 関連コード変更時は、変更前後で必ず動作確認を行い、問題があれば変更を取り消す
- **ゼロトレランス**: 「指示の副作用で基本機能が破壊される」事象の発生をゼロにする
- **重大問題認識**: 画像消失・リンク破壊・機能停止は最重大問題として即座に対処する

### 確実性保証規則
- **「はず」「予想」禁止**: 技術的な結果について推測的な表現を使用しない
- **確実な確認**: 修正後は実際の動作を確認し、確実に動作することを保証する
- **結果責任**: 「はずです」「と思います」等の曖昧な表現ではなく、確実な結果を提供する
- **検証必須**: 変更を実装した場合は必ず動作検証を行い、問題があれば完全に修正する

### 言語使用規則（厳格遵守）
- **日本語必須**: 全ての回答・説明・コメントを日本語で行う
- **英語使用禁止**: 技術用語・エラーメッセージ・コード説明も含めて英語での回答は完全禁止
- **一貫性維持**: 会話の途中で言語が変わることを絶対に避ける
- **例外なし**: いかなる状況でも日本語以外での回答は許可しない