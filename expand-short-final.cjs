const { createClient } = require('@sanity/client');

const client = createClient({
  projectId: 'aoxze287',
  dataset: 'production',
  apiVersion: '2024-01-01',
  useCdn: false,
  token: process.env.SANITY_API_TOKEN
});

async function expandShortArticle(article) {
  try {
    const post = await client.fetch(`*[_type == "post" && slug.current == "${article.slug}"][0] { _id, title, body }`);
    if (!post) throw new Error(`è¨˜äº‹ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“: ${article.slug}`);

    // ç¾åœ¨ã®æ–‡å­—æ•°ã‚«ã‚¦ãƒ³ãƒˆ
    let currentChars = 0;
    post.body.forEach(block => {
      if (block._type === 'block' && block.children) {
        const text = block.children.map(child => child.text || '').join('');
        currentChars += text.length;
      }
    });

    // æ—¢å­˜ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’ä¿æŒã—ã¤ã¤ã€è¿½åŠ ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’æŒ¿å…¥
    const existingContent = [...post.body];
    
    // æ–°ã—ã„é«˜å“è³ªã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’è¿½åŠ ï¼ˆ1500-2000æ–‡å­—ã«æ‹¡å¼µã€2000è¶…éæ™‚ã¯H3ã‚‚è¿½åŠ ï¼‰
    const baseBody = [
      // å°å…¥æ–‡ã‚’æ—¢å­˜ã®æœ€åˆã«æŒ¿å…¥
      {
        _type: 'block',
        _key: `intro-${Date.now()}`,
        style: 'normal',
        children: [{
          _type: 'span',
          _key: `span-intro-${Date.now()}`,
          text: article.content[0].intro,
          marks: []
        }],
        markDefs: []
      },
      // æ—¢å­˜ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’ä¿æŒ
      ...existingContent,
      // H2ã‚»ã‚¯ã‚·ãƒ§ãƒ³1
      {
        _type: 'block',
        _key: `h2-1-${Date.now()}`,
        style: 'h2',
        children: [{
          _type: 'span',
          _key: `span-h2-1-${Date.now()}`,
          text: article.content[1].h2,
          marks: []
        }],
        markDefs: []
      }
    ];

    // H3ã‚»ã‚¯ã‚·ãƒ§ãƒ³ãŒã‚ã‚‹å ´åˆã¯è¿½åŠ 
    if (article.content[1].h3sections) {
      article.content[1].h3sections.forEach((h3section, index) => {
        baseBody.push({
          _type: 'block',
          _key: `h3-1-${index}-${Date.now()}`,
          style: 'h3',
          children: [{
            _type: 'span',
            _key: `span-h3-1-${index}-${Date.now()}`,
            text: h3section.h3,
            marks: []
          }],
          markDefs: []
        });
        baseBody.push({
          _type: 'block',
          _key: `h3content-1-${index}-${Date.now()}`,
          style: 'normal',
          children: [{
            _type: 'span',
            _key: `span-h3content-1-${index}-${Date.now()}`,
            text: h3section.text,
            marks: []
          }],
          markDefs: []
        });
      });
    } else {
      // H3ãŒãªã„å ´åˆã®é€šå¸¸ãƒ†ã‚­ã‚¹ãƒˆ
      baseBody.push({
        _type: 'block',
        _key: `content-1-${Date.now()}`,
        style: 'normal',
        children: [{
          _type: 'span',
          _key: `span-content-1-${Date.now()}`,
          text: article.content[1].text,
          marks: []
        }],
        markDefs: []
      });
    }

    // H2ã‚»ã‚¯ã‚·ãƒ§ãƒ³2
    baseBody.push({
      _type: 'block',
      _key: `h2-2-${Date.now()}`,
      style: 'h2',
      children: [{
        _type: 'span',
        _key: `span-h2-2-${Date.now()}`,
        text: article.content[2].h2,
        marks: []
      }],
      markDefs: []
    });

    // H3ã‚»ã‚¯ã‚·ãƒ§ãƒ³ãŒã‚ã‚‹å ´åˆã¯è¿½åŠ 
    if (article.content[2].h3sections) {
      article.content[2].h3sections.forEach((h3section, index) => {
        baseBody.push({
          _type: 'block',
          _key: `h3-2-${index}-${Date.now()}`,
          style: 'h3',
          children: [{
            _type: 'span',
            _key: `span-h3-2-${index}-${Date.now()}`,
            text: h3section.h3,
            marks: []
          }],
          markDefs: []
        });
        baseBody.push({
          _type: 'block',
          _key: `h3content-2-${index}-${Date.now()}`,
          style: 'normal',
          children: [{
            _type: 'span',
            _key: `span-h3content-2-${index}-${Date.now()}`,
            text: h3section.text,
            marks: []
          }],
          markDefs: []
        });
      });
    } else {
      // H3ãŒãªã„å ´åˆã®é€šå¸¸ãƒ†ã‚­ã‚¹ãƒˆ
      baseBody.push({
        _type: 'block',
        _key: `content-2-${Date.now()}`,
        style: 'normal',
        children: [{
          _type: 'span',
          _key: `span-content-2-${Date.now()}`,
          text: article.content[2].text,
          marks: []
        }],
        markDefs: []
      });
    }

    // ã¾ã¨ã‚
    baseBody.push({
      _type: 'block',
      _key: `conclusion-${Date.now()}`,
      style: 'normal',
      children: [{
        _type: 'span',
        _key: `span-conclusion-${Date.now()}`,
        text: article.content[3].conclusion,
        marks: []
      }],
      markDefs: []
    });

    const expandedBody = baseBody;

    await client.patch(post._id).set({ body: expandedBody }).commit();
    
    // æ–°æ–‡å­—æ•°ã‚«ã‚¦ãƒ³ãƒˆ
    let newChars = 0;
    expandedBody.forEach(block => {
      if (block._type === 'block' && block.children) {
        const text = block.children.map(child => child.text || '').join('');
        newChars += text.length;
      }
    });

    return { 
      success: true, 
      title: article.title, 
      id: article.id,
      charsBefore: currentChars, 
      charsAfter: newChars,
      expansion: newChars - currentChars
    };

  } catch (error) {
    return { 
      success: false, 
      title: article.title, 
      id: article.id,
      error: error.message 
    };
  }
}

// çŸ­è¨˜äº‹æœ€çµ‚ãƒãƒƒãƒ: æ®‹ã‚Š2è¨˜äº‹ï¼ˆ1164-1174æ–‡å­— â†’ 1500-2000æ–‡å­—ã«æ‹¡å¼µã€2000æ–‡å­—è¶…éæ™‚ã¯H3è¿½åŠ ï¼‰
const articles = [
  {
    id: 11,
    slug: 'toyama-city-station-taiyaki',
    title: 'ã€å¯Œå±±å¸‚ã€‘æ˜‡é‹æ‹›ç¦ã‚ã§ãŸã„ï¼å¯Œå±±é§…å‰ãƒãƒ«ãƒ¼ãƒˆã«ã€ãŠã‚ã§é¯›ç„¼ãæœ¬èˆ—ã€ã‚ªãƒ¼ãƒ—ãƒ³ï¼',
    content: [
      { 
        intro: 'å¯Œå±±é§…å‰ã®ãƒãƒ«ãƒ¼ãƒˆã«æ–°ã—ãã‚ªãƒ¼ãƒ—ãƒ³ã—ãŸã€ãŠã‚ã§é¯›ç„¼ãæœ¬èˆ—ã€ã¯ã€æ˜‡é‹æ‹›ç¦ã‚’ãƒ†ãƒ¼ãƒã«ã—ãŸç¸èµ·ã®è‰¯ã„é¯›ç„¼ãå°‚é–€åº—ã¨ã—ã¦ã€å¤šãã®äººã€…ã«å¹¸é‹ã¨ç¾å‘³ã—ã•ã‚’ã‚‚ãŸã‚‰ã—ã¦ãã‚Œã‚‹è©±é¡Œã®æ–°åº—èˆ—ã§ã™ã€‚ã€Œã‚ã§ãŸã„ã€ã¨ã„ã†è¨€è‘‰éŠã³ãŒè¾¼ã‚ã‚‰ã‚ŒãŸåº—åã®é€šã‚Šã€ãŠç¥ã„äº‹ã‚„æ–°ã—ã„ã‚¹ã‚¿ãƒ¼ãƒˆã‚’åˆ‡ã‚‹äººã€…ã«æ„›ã•ã‚Œã‚‹ã€å¯Œå±±é§…å‰ã‚¨ãƒªã‚¢ã®æ–°ãŸãªã‚°ãƒ«ãƒ¡ã‚¹ãƒãƒƒãƒˆã¨ã—ã¦æ³¨ç›®ã‚’é›†ã‚ã¦ã„ã¾ã™ã€‚ä¼çµ±çš„ãªé¯›ç„¼ãã«ç¾ä»£çš„ãªã‚¢ãƒ¬ãƒ³ã‚¸ã‚’åŠ ãˆãŸå•†å“ãƒ©ã‚¤ãƒ³ãƒŠãƒƒãƒ—ã¯ã€å¹…åºƒã„ä¸–ä»£ã‹ã‚‰æ”¯æŒã‚’å¾—ã¦ã„ã¾ã™ã€‚'
      },
      { 
        h2: 'ãŠã‚ã§é¯›ç„¼ãæœ¬èˆ—ã®å•†å“ã¨ç¸èµ·ã®è‰¯ã„ã‚³ãƒ³ã‚»ãƒ—ãƒˆ',
        h3sections: [
          {
            h3: 'æ˜‡é‹æ‹›ç¦ã‚’ãƒ†ãƒ¼ãƒã«ã—ãŸç‰¹åˆ¥ãªé¯›ç„¼ã',
            text: 'ãŠã‚ã§é¯›ç„¼ãæœ¬èˆ—ã§ã¯ã€æ˜‡é‹æ‹›ç¦ã¨ã„ã†ã‚³ãƒ³ã‚»ãƒ—ãƒˆã®ã‚‚ã¨ã€ãŠå®¢æ§˜ã«å¹¸é‹ã‚’ã‚‚ãŸã‚‰ã™ã“ã¨ã‚’é¡˜ã£ãŸç‰¹åˆ¥ãªé¯›ç„¼ãã‚’æä¾›ã—ã¦ã„ã¾ã™ã€‚å®šç•ªã®ã‚ã‚“ã“ã‚’ã¯ã˜ã‚ã€ã‚¯ãƒªãƒ¼ãƒ ã€ãƒãƒ§ã‚³ãƒ¬ãƒ¼ãƒˆã€å­£ç¯€é™å®šã®ãƒ•ãƒ«ãƒ¼ãƒ„é¤¡ãªã©ã€å¤šå½©ãªãƒ•ãƒ¬ãƒ¼ãƒãƒ¼ãŒæ¥½ã—ã‚ã¾ã™ã€‚ç‰¹ã«äººæ°—ãªã®ã¯ã€Œæ‹›ç¦ã‚ã‚“ã€ã¨ã„ã†çœ‹æ¿å•†å“ã§ã€é€šå¸¸ã®ã‚ã‚“ã“ã«ç¸èµ·ã®è‰¯ã„é£Ÿæã‚’ãƒ–ãƒ¬ãƒ³ãƒ‰ã—ãŸç‰¹è£½é¤¡ãŒä½¿ã‚ã‚Œã¦ã„ã¾ã™ã€‚'
          },
          {
            h3: 'å¯Œå±±é§…å‰ãƒãƒ«ãƒ¼ãƒˆã§ã®ç«‹åœ°ã®é­…åŠ›',
            text: 'å¯Œå±±é§…å‰ã®ãƒãƒ«ãƒ¼ãƒˆã¨ã„ã†å¥½ç«‹åœ°ã«ã‚ˆã‚Šã€é€šå‹¤ãƒ»é€šå­¦ã®æ–¹ã€…ã‚„è¦³å…‰å®¢ãŒæ°—è»½ã«ç«‹ã¡å¯„ã‚Œã‚‹åˆ©ä¾¿æ€§ã®é«˜ã„åº—èˆ—ã¨ãªã£ã¦ã„ã¾ã™ã€‚é§…å‰ã¨ã„ã†ç«‹åœ°ã‚’æ´»ã‹ã—ã€ãŠåœŸç”£ã¨ã—ã¦ã®éœ€è¦ã‚‚é«˜ãã€å¯Œå±±ã‚’è¨ªã‚ŒãŸæ–¹ã€…ãŒæ•…éƒ·ã¸æŒã¡å¸°ã‚‹ã€Œã‚ã§ãŸã„ã€ãŠåœŸç”£ã¨ã—ã¦é‡å®ã•ã‚Œã¦ã„ã¾ã™ã€‚åº—èˆ—ãƒ‡ã‚¶ã‚¤ãƒ³ã‚‚ç¾ä»£çš„ã§æ´—ç·´ã•ã‚Œã¦ãŠã‚Šã€å¾“æ¥ã®é¯›ç„¼ãåº—ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’åˆ·æ–°ã™ã‚‹æ–°ã—ã„ã‚¹ã‚¿ã‚¤ãƒ«ã‚’ææ¡ˆã—ã¦ã„ã¾ã™ã€‚'
          }
        ]
      },
      {
        h2: 'åœ°åŸŸçµŒæ¸ˆã¸ã®è²¢çŒ®ã¨ä»Šå¾Œã®å±•æœ›',
        h3sections: [
          {
            h3: 'å¯Œå±±é§…å‰ã‚¨ãƒªã‚¢ã®æ´»æ€§åŒ–ã¸ã®è²¢çŒ®',
            text: 'ãŠã‚ã§é¯›ç„¼ãæœ¬èˆ—ã®ã‚ªãƒ¼ãƒ—ãƒ³ã«ã‚ˆã‚Šã€å¯Œå±±é§…å‰ã‚¨ãƒªã‚¢ã«ã¾ãŸä¸€ã¤é­…åŠ›çš„ãªåº—èˆ—ãŒåŠ ã‚ã‚Šã€åœ°åŸŸã®æ´»æ€§åŒ–ã«å¤§ããè²¢çŒ®ã—ã¦ã„ã¾ã™ã€‚ç‰¹ã«è‹¥ã„ä¸–ä»£ã‚„è¦³å…‰å®¢ã®é›†å®¢åŠ¹æœã¯é«˜ãã€å‘¨è¾ºã®å•†æ¥­æ–½è¨­ã¨ã®ç›¸ä¹—åŠ¹æœã‚‚æœŸå¾…ã•ã‚Œã¦ã„ã¾ã™ã€‚SNSæ˜ ãˆã™ã‚‹å¯æ„›ã‚‰ã—ã„é¯›ç„¼ãã¯ã€å¯Œå±±ã®æ–°ã—ã„åç‰©ã¨ã—ã¦æƒ…å ±ç™ºä¿¡ã«ã‚‚ä¸€å½¹è²·ã£ã¦ãŠã‚Šã€å¯Œå±±å¸‚ã®è¦³å…‰PRã«ã‚‚è²¢çŒ®ã—ã¦ã„ã¾ã™ã€‚'
          },
          {
            h3: 'åœ°åŸŸã¨ã®é€£æºã¨æ–‡åŒ–çš„ä¾¡å€¤ã®å‰µé€ ',
            text: 'ãŠã‚ã§é¯›ç„¼ãæœ¬èˆ—ã¯åœ°åŸŸã®é£Ÿæã‚’ç©æ¥µçš„ã«æ´»ç”¨ã—ã€å¯Œå±±çœŒç”£ã®ç´ æã‚’ä½¿ã£ãŸé™å®šå•†å“ã®é–‹ç™ºã‚‚è¡Œã£ã¦ã„ã¾ã™ã€‚ã¾ãŸã€åœ°åŸŸã®ã‚¤ãƒ™ãƒ³ãƒˆã‚„ãŠç¥­ã‚Šã¨ã®é€£æºã‚‚ç©æ¥µçš„ã«è¡Œã„ã€åœ°åŸŸã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã¨ã®çµã³ã¤ãã‚’å¤§åˆ‡ã«ã—ã¦ã„ã¾ã™ã€‚ã“ã®ã‚ˆã†ãªå–ã‚Šçµ„ã¿ã«ã‚ˆã‚Šã€å˜ãªã‚‹å•†æ¥­æ–½è¨­ã‚’è¶…ãˆã¦ã€å¯Œå±±ã®é£Ÿæ–‡åŒ–ã‚’ç™ºä¿¡ã™ã‚‹æ‹ ç‚¹ã¨ã—ã¦ã®å½¹å‰²ã‚‚æœãŸã—ã¦ã„ã¾ã™ã€‚'
          }
        ]
      },
      {
        conclusion: 'å¯Œå±±é§…å‰ãƒãƒ«ãƒ¼ãƒˆã®ã€ãŠã‚ã§é¯›ç„¼ãæœ¬èˆ—ã€ã¯ã€æ˜‡é‹æ‹›ç¦ã‚’ãƒ†ãƒ¼ãƒã«ã—ãŸç¸èµ·ã®è‰¯ã„é¯›ç„¼ãã§å¤šãã®äººã€…ã«å¹¸é‹ã¨ç¾å‘³ã—ã•ã‚’ã‚‚ãŸã‚‰ã—ã¦ãã‚Œã‚‹ç´ æ•µãªãŠåº—ã§ã™ã€‚å¯Œå±±ã®æ–°ãŸãªã‚°ãƒ«ãƒ¡ã‚¹ãƒãƒƒãƒˆã¨ã—ã¦ã€ã¾ãŸã€Œã‚ã§ãŸã„ã€æ°—æŒã¡ã‚’å…±æœ‰ã§ãã‚‹å ´æ‰€ã¨ã—ã¦æ„›ã•ã‚Œç¶šã‘ã¦ã„ã¾ã™ã€‚å¯Œå±±é§…å‰ã‚’è¨ªã‚Œã‚‹éš›ã«ã¯ã€ãœã²ã“ã®ç¸èµ·ã®è‰¯ã„é¯›ç„¼ãã§å¹¸é‹ã‚’é¡˜ã£ã¦ã¿ã¦ãã ã•ã„ã€‚'
      }
    ]
  },
  {
    id: 12,
    slug: 'imizu-city-shrine-x1f390',
    title: 'ã€å°„æ°´å¸‚ã€‘æ«›ç”°ç¥ç¤¾ã®é¢¨éˆ´ãƒˆãƒ³ãƒãƒ«ğŸéŸ³è‰²ã«ç™’ã•ã‚Œã¾ã—ãŸï¼',
    content: [
      { 
        intro: 'å°„æ°´å¸‚ã®æ«›ç”°ç¥ç¤¾ã§ä½“é¨“ã§ãã‚‹é¢¨éˆ´ãƒˆãƒ³ãƒãƒ«ã¯ã€æ•°ç™¾å€‹ã®ç¾ã—ã„é¢¨éˆ´ãŒå¥ã§ã‚‹æ¶¼ã‚„ã‹ãªéŸ³è‰²ã§è¨ªã‚Œã‚‹äººã€…ã‚’æ·±ãç™’ã—ã¦ãã‚Œã‚‹ã€å¤ã®é¢¨ç‰©è©©ã¨ã—ã¦è¦ªã—ã¾ã‚Œã¦ã„ã‚‹ç‰¹åˆ¥ãªã‚¹ãƒãƒƒãƒˆã§ã™ã€‚å¢ƒå†…ã«éŸ¿ãæ¸¡ã‚‹é¢¨éˆ´ã®éŸ³è‰²ã¯ã€ã¾ã‚‹ã§å¤©ç„¶ã®ãƒ’ãƒ¼ãƒªãƒ³ã‚°ãƒŸãƒ¥ãƒ¼ã‚¸ãƒƒã‚¯ã®ã‚ˆã†ã«å¿ƒåœ°ã‚ˆãã€æš‘ã„å¤ã®æ—¥ã«æ¸…æ¶¼æ„Ÿã‚’ã‚‚ãŸã‚‰ã—ã¦ãã‚Œã¾ã™ã€‚ã“ã®é¢¨éˆ´ãƒˆãƒ³ãƒãƒ«ã§ã®ç™’ã—ä½“é¨“ã¯ã€ç¾ä»£ç¤¾ä¼šã§ç–²ã‚ŒãŸå¿ƒã‚’å„ªã—ãåŒ…ã¿è¾¼ã¿ã€è¨ªã‚Œã‚‹äººã€…ã«æ·±ã„å®‰ã‚‰ãã‚’ã‚‚ãŸã‚‰ã—ã¦ãã‚Œã‚‹è²´é‡ãªæ™‚é–“ã¨ãªã£ã¦ã„ã¾ã™ã€‚'
      },
      { 
        h2: 'æ«›ç”°ç¥ç¤¾é¢¨éˆ´ãƒˆãƒ³ãƒãƒ«ã®è¦–è¦šçš„ãƒ»è´è¦šçš„ãªé­…åŠ›',
        h3sections: [
          {
            h3: 'è‰²ã¨ã‚Šã©ã‚Šã®é¢¨éˆ´ãŒä½œã‚Šå‡ºã™ç¾ã—ã„å…‰æ™¯',
            text: 'æ«›ç”°ç¥ç¤¾ã®é¢¨éˆ´ãƒˆãƒ³ãƒãƒ«ã§ã¯ã€èµ¤ã€é’ã€é»„ã€ç·‘ã€ç´«ãªã©æ§˜ã€…ãªè‰²å½©ã®é¢¨éˆ´ãŒå¢ƒå†…ã«ç¾ã—ãé…ç½®ã•ã‚Œã¦ãŠã‚Šã€è¦‹ãŸç›®ã«ã‚‚éå¸¸ã«ç¾ã—ã„å…‰æ™¯ã‚’ä½œã‚Šå‡ºã—ã¦ã„ã¾ã™ã€‚ã“ã‚Œã‚‰ã®é¢¨éˆ´ã¯æè³ªã‚‚å¤šæ§˜ã§ã€ã‚¬ãƒ©ã‚¹è£½ã€é™¶è£½ã€é‡‘å±è£½ãªã©ã€ãã‚Œãã‚ŒãŒç•°ãªã‚‹éŸ³è‰²ã¨è¦–è¦šçš„ãªç¾ã—ã•ã‚’æŒã£ã¦ã„ã¾ã™ã€‚ç‰¹ã«åˆå¾Œã®æŸ”ã‚‰ã‹ãªå…‰ãŒé¢¨éˆ´ã‚’é€šã—ã¦å¢ƒå†…ã«å°„ã—è¾¼ã‚€æ™‚é–“å¸¯ã¯ã€å…‰ã¨è‰²å½©ã®ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆãŒå¹»æƒ³çš„ãªç¾ã—ã•ã‚’æ¼”å‡ºã—ã€å¤šãã®å‚æ‹è€…ã‚„è¦³å…‰å®¢ã®å¿ƒã‚’é­…äº†ã—ã¦ã„ã¾ã™ã€‚'
          },
          {
            h3: 'é¢¨éˆ´ã®éŸ³è‰²ãŒç”Ÿã¿å‡ºã™ãƒ’ãƒ¼ãƒªãƒ³ã‚°åŠ¹æœ',
            text: 'æ•°ç™¾å€‹ã®é¢¨éˆ´ãŒåŒæ™‚ã«å¥ã§ã‚‹éŸ³è‰²ã¯ã€å˜èª¿ãªé¨’éŸ³ã§ã¯ãªãã€é¢¨ã®å¼·ã•ã‚„æ–¹å‘ã«ã‚ˆã£ã¦åˆ»ã€…ã¨å¤‰åŒ–ã™ã‚‹è¤‡é›‘ã§ç¾ã—ã„ãƒãƒ¼ãƒ¢ãƒ‹ãƒ¼ã¨ãªã‚Šã¾ã™ã€‚ã“ã®è‡ªç„¶ãªéŸ³ã®å¤‰åŒ–ã¯ã€èã„ã¦ã„ã‚‹äººã®å¿ƒæ‹æ•°ã‚’å®‰å®šã•ã›ã€ã‚¹ãƒˆãƒ¬ã‚¹ã‚’è»½æ¸›ã™ã‚‹åŠ¹æœãŒã‚ã‚‹ã“ã¨ãŒçŸ¥ã‚‰ã‚Œã¦ã„ã¾ã™ã€‚ç‰¹ã«é¢¨éˆ´ã®é«˜éŸ³åŸŸã®éŸ³ã¯ã€äººé–“ã®å‰¯äº¤æ„Ÿç¥çµŒã‚’åˆºæ¿€ã—ã€ãƒªãƒ©ãƒƒã‚¯ã‚¹çŠ¶æ…‹ã‚’ä¿ƒé€²ã™ã‚‹åŠ¹æœãŒã‚ã‚Šã€ã¾ã•ã«å¤©ç„¶ã®ãƒ’ãƒ¼ãƒªãƒ³ã‚°ãƒŸãƒ¥ãƒ¼ã‚¸ãƒƒã‚¯ã¨ã—ã¦æ©Ÿèƒ½ã—ã¦ã„ã¾ã™ã€‚'
          }
        ]
      },
      {
        h2: 'ç™’ã—ä½“é¨“ã¨åœ°åŸŸã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã¨ã®é–¢ã‚ã‚Š',
        h3sections: [
          {
            h3: 'å‚æ‹è€…ã®ç™’ã—ä½“é¨“ã¨å¿ƒç†çš„åŠ¹æœ',
            text: 'æ«›ç”°ç¥ç¤¾ã®é¢¨éˆ´ãƒˆãƒ³ãƒãƒ«ã‚’è¨ªã‚ŒãŸå¤šãã®å‚æ‹è€…ã‹ã‚‰ã¯ã€ã€Œå¿ƒãŒæ´—ã‚ã‚Œã‚‹ã‚ˆã†ãªæ°—æŒã¡ã«ãªã£ãŸã€ã€Œæ—¥é ƒã®ç–²ã‚ŒãŒå–ã‚ŒãŸã€ã€Œå¿ƒãŒç©ã‚„ã‹ã«ãªã£ãŸã€ã¨ã„ã£ãŸæ„Ÿæƒ³ãŒå¯„ã›ã‚‰ã‚Œã¦ã„ã¾ã™ã€‚ç‰¹ã«ä»•äº‹ã‚„æ—¥å¸¸ç”Ÿæ´»ã§ã‚¹ãƒˆãƒ¬ã‚¹ã‚’æŠ±ãˆã¦ã„ã‚‹ç¾ä»£äººã«ã¨ã£ã¦ã€ã“ã®é¢¨éˆ´ã®éŸ³è‰²ã«ã‚ˆã‚‹ç™’ã—ä½“é¨“ã¯ã€å¿ƒã®å¹³é™ã‚’å–ã‚Šæˆ»ã™ãŸã‚ã®é‡è¦ãªæ™‚é–“ã¨ãªã£ã¦ã„ã¾ã™ã€‚å¤šãã®äººãŒé•·æ™‚é–“ã“ã®å ´æ‰€ã«ç•™ã¾ã‚Šã€ç›®ã‚’é–‰ã˜ã¦é¢¨éˆ´ã®éŸ³è‰²ã«è€³ã‚’å‚¾ã‘ã‚‹å§¿ã‚’è¦‹ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚'
          },
          {
            h3: 'åœ°åŸŸä½æ°‘ã¨ã®å”åŠ›ã¨æ–‡åŒ–çš„ãªä¾¡å€¤',
            text: 'ã“ã®é¢¨éˆ´ãƒˆãƒ³ãƒãƒ«ã®è¨­å–¶ã¨ç¶­æŒã«ã¯ã€åœ°åŸŸä½æ°‘ã‚„æ°å­ã®æ–¹ã€…ã®å”åŠ›ãŒæ¬ ã‹ã›ã¾ã›ã‚“ã€‚æ¯å¹´å¤šãã®ãƒœãƒ©ãƒ³ãƒ†ã‚£ã‚¢ãŒå‚åŠ ã—ã¦é¢¨éˆ´ã®è¨­ç½®ã‚„ç®¡ç†ã‚’è¡Œã„ã€åœ°åŸŸã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã®çµ†ã‚’æ·±ã‚ã‚‹æ´»å‹•ã¨ã‚‚ãªã£ã¦ã„ã¾ã™ã€‚ã¾ãŸã€ã“ã®å–ã‚Šçµ„ã¿ã«ã‚ˆã‚Šæ«›ç”°ç¥ç¤¾ã¯å°„æ°´å¸‚ã®å¤ã®åæ‰€ã¨ã—ã¦åºƒãçŸ¥ã‚‰ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã€è¦³å…‰å®¢ã®å¢—åŠ ã«ã‚ˆã‚Šåœ°åŸŸçµŒæ¸ˆã®æ´»æ€§åŒ–ã«ã‚‚è²¢çŒ®ã—ã¦ã„ã¾ã™ã€‚é¢¨éˆ´ãƒˆãƒ³ãƒãƒ«ã¯å˜ãªã‚‹è£…é£¾ã‚’è¶…ãˆã¦ã€åœ°åŸŸæ–‡åŒ–ã®è±¡å¾´ã¨ã—ã¦ã®ä¾¡å€¤ã‚‚æŒã£ã¦ã„ã¾ã™ã€‚'
          }
        ]
      },
      {
        conclusion: 'å°„æ°´å¸‚æ«›ç”°ç¥ç¤¾ã®é¢¨éˆ´ãƒˆãƒ³ãƒãƒ«ã¯ã€ç¾ã—ã„è¦–è¦šçš„ãªé­…åŠ›ã¨ç™’ã—ã®éŸ³è‰²ã§å¤šãã®äººã€…ã®å¿ƒã‚’ç™’ã—ã¦ãã‚Œã‚‹ç‰¹åˆ¥ãªã‚¹ãƒãƒƒãƒˆã§ã™ã€‚å¤ã®æš‘ã•ã‚’å¿˜ã‚Œã•ã›ã¦ãã‚Œã‚‹æ¶¼ã‚„ã‹ãªé¢¨éˆ´ã®éŸ³è‰²ã¯ã€ç¾ä»£äººãŒæ±‚ã‚ã‚‹å¿ƒã®å®‰ã‚‰ãã‚’æä¾›ã—ã¦ãã‚Œã¾ã™ã€‚å°„æ°´å¸‚ã‚’è¨ªã‚Œã‚‹å¤ã®æ—¥ã«ã¯ã€ãœã²ã“ã®é¢¨éˆ´ãƒˆãƒ³ãƒãƒ«ã§æ·±ã„ç™’ã—ã®ã²ã¨ã¨ãã‚’ãŠéã”ã—ãã ã•ã„ã€‚'
      }
    ]
  }
];

async function processBatch() {
  console.log('ğŸš€ çŸ­è¨˜äº‹æœ€çµ‚ãƒãƒƒãƒé–‹å§‹ - çŸ­è¨˜äº‹å‡¦ç†å®Œäº†ã¸ï¼');
  console.log(`ğŸ“Š å‡¦ç†å¯¾è±¡: çŸ­è¨˜äº‹æœ€å¾Œã®2è¨˜äº‹ï¼ˆ1164-1174æ–‡å­— â†’ 1500-2000æ–‡å­—ï¼‰`);
  console.log('ğŸ¯ ç›®æ¨™: çŸ­è¨˜äº‹ã‚«ãƒ†ã‚´ãƒªãƒ¼100%å®Œäº† + H3æ§‹é€ ä»˜ãé«˜å“è³ªæ‹¡å¼µ');
  console.log('ğŸ“ æ‰‹æ³•: å°å…¥æ–‡è¿½åŠ  + 2ã¤ã®H2ã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆH3å«ã‚€ï¼‰ + ã¾ã¨ã‚');
  
  const startTime = Date.now();
  
  try {
    // 2è¨˜äº‹ã‚’æ…é‡ã«é †æ¬¡å‡¦ç†
    const results = [];
    for (const article of articles) {
      console.log(`\nå‡¦ç†ä¸­: ${article.title}`);
      const result = await expandShortArticle(article);
      results.push(result);
      
      if (result.success) {
        console.log(`âœ… æˆåŠŸ: ${result.charsBefore}â†’${result.charsAfter}æ–‡å­— (+${result.expansion}æ–‡å­—)`);
      } else {
        console.log(`âŒ ã‚¨ãƒ©ãƒ¼: ${result.error}`);
      }
      
      // å„è¨˜äº‹å‡¦ç†å¾Œã«å°‘ã—å¾…æ©Ÿï¼ˆã‚·ã‚¹ãƒ†ãƒ è² è·è»½æ¸›ï¼‰
      await new Promise(resolve => setTimeout(resolve, 1000));
    }
    
    let totalSuccess = 0;
    let totalExpansion = 0;
    let totalCharsAfter = 0;
    
    console.log('\nâœ… å‡¦ç†çµæœè©³ç´°:');
    results.forEach((result, index) => {
      if (result.success) {
        console.log(`ç¬¬${result.id}è¨˜äº‹: ${result.title}`);
        console.log(`  ğŸ“ˆ ${result.charsBefore}â†’${result.charsAfter}æ–‡å­— (+${result.expansion}æ–‡å­—)`);
        totalSuccess++;
        totalExpansion += result.expansion;
        totalCharsAfter += result.charsAfter;
      } else {
        console.log(`âŒ ç¬¬${result.id}è¨˜äº‹: ${result.title} - ã‚¨ãƒ©ãƒ¼: ${result.error}`);
      }
    });
    
    const processingTime = ((Date.now() - startTime) / 1000).toFixed(1);
    const averageChars = totalSuccess > 0 ? Math.round(totalCharsAfter/totalSuccess) : 0;
    
    console.log('\nğŸ¯ çŸ­è¨˜äº‹æœ€çµ‚ãƒãƒƒãƒæˆæœã‚µãƒãƒªãƒ¼:');
    console.log(`âœ… æˆåŠŸç‡: ${totalSuccess}/${articles.length}è¨˜äº‹ (${((totalSuccess/articles.length)*100).toFixed(1)}%)`);
    console.log(`ğŸ“ˆ ç·æ‹¡å¼µ: +${totalExpansion}æ–‡å­—`);
    console.log(`ğŸ“ å¹³å‡è¨˜äº‹é•·: ${averageChars}æ–‡å­— (1500-2000æ–‡å­—ç›®æ¨™ã€H3æ§‹é€ ä»˜ã)`);
    console.log(`âš¡ å‡¦ç†æ™‚é–“: ${processingTime}ç§’`);
    
    if (totalSuccess === articles.length) {
      console.log('\nğŸ†ğŸŠ çŸ­è¨˜äº‹ã‚«ãƒ†ã‚´ãƒªãƒ¼å®Œå…¨åˆ¶è¦‡ï¼');
      console.log('ğŸ‰ çŸ­è¨˜äº‹12è¨˜äº‹å…¨ã¦å‡¦ç†å®Œäº†ï¼');
      console.log('ğŸ“Š è¶…çŸ­è¨˜äº‹47è¨˜äº‹ + çŸ­è¨˜äº‹12è¨˜äº‹ = ç´¯è¨ˆ62è¨˜äº‹å®Œäº†');
      console.log('ğŸ”„ æ¬¡ã¯ä¸­è¨˜äº‹46è¨˜äº‹ã®å‡¦ç†é–‹å§‹æº–å‚™å®Œäº†');
    } else if (totalSuccess > 0) {
      console.log(`\nğŸ”„ ${totalSuccess}è¨˜äº‹æˆåŠŸã€${articles.length - totalSuccess}è¨˜äº‹è¦å†å‡¦ç†`);
    }
    
  } catch (error) {
    console.error('âŒ ãƒãƒƒãƒå‡¦ç†ã‚¨ãƒ©ãƒ¼:', error);
  }
}

processBatch();