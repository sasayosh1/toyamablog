const { createClient } = require('@sanity/client');

const client = createClient({
  projectId: 'aoxze287',
  dataset: 'production',
  apiVersion: '2024-01-01',
  useCdn: false,
  token: process.env.SANITY_API_TOKEN
});

async function expandUltraShortArticle(article) {
  try {
    const post = await client.fetch(`*[_type == "post" && slug.current == "${article.slug}"][0] { _id, title, body }`);
    if (!post) throw new Error(`記事が見つかりません: ${article.slug}`);

    // 現在の文字数カウント
    let currentChars = 0;
    post.body.forEach(block => {
      if (block._type === 'block' && block.children) {
        const text = block.children.map(child => child.text || '').join('');
        currentChars += text.length;
      }
    });

    // 既存のYouTube埋め込みなどは保持しつつ、高品質コンテンツを追加
    const existingContent = [...post.body];
    
    // 新しい高品質コンテンツを追加
    const expandedBody = [
      // 導入文
      {
        _type: 'block',
        _key: `intro-${Date.now()}`,
        style: 'normal',
        children: [{
          _type: 'span',
          _key: `span-intro-${Date.now()}`,
          text: article.content[0].intro,
          marks: []
        }],
        markDefs: []
      },
      // 既存のYouTube埋め込み等を保持
      ...existingContent,
      // H2セクション1
      {
        _type: 'block',
        _key: `h2-1-${Date.now()}`,
        style: 'h2',
        children: [{
          _type: 'span',
          _key: `span-h2-1-${Date.now()}`,
          text: article.content[1].h2,
          marks: []
        }],
        markDefs: []
      },
      {
        _type: 'block',
        _key: `content-1-${Date.now()}`,
        style: 'normal',
        children: [{
          _type: 'span',
          _key: `span-content-1-${Date.now()}`,
          text: article.content[1].text,
          marks: []
        }],
        markDefs: []
      },
      // H2セクション2
      {
        _type: 'block',
        _key: `h2-2-${Date.now()}`,
        style: 'h2',
        children: [{
          _type: 'span',
          _key: `span-h2-2-${Date.now()}`,
          text: article.content[2].h2,
          marks: []
        }],
        markDefs: []
      },
      {
        _type: 'block',
        _key: `content-2-${Date.now()}`,
        style: 'normal',
        children: [{
          _type: 'span',
          _key: `span-content-2-${Date.now()}`,
          text: article.content[2].text,
          marks: []
        }],
        markDefs: []
      },
      // H2セクション3
      {
        _type: 'block',
        _key: `h2-3-${Date.now()}`,
        style: 'h2',
        children: [{
          _type: 'span',
          _key: `span-h2-3-${Date.now()}`,
          text: article.content[3].h2,
          marks: []
        }],
        markDefs: []
      },
      {
        _type: 'block',
        _key: `content-3-${Date.now()}`,
        style: 'normal',
        children: [{
          _type: 'span',
          _key: `span-content-3-${Date.now()}`,
          text: article.content[3].text,
          marks: []
        }],
        markDefs: []
      },
      // まとめ
      {
        _type: 'block',
        _key: `conclusion-${Date.now()}`,
        style: 'normal',
        children: [{
          _type: 'span',
          _key: `span-conclusion-${Date.now()}`,
          text: article.content[4].conclusion,
          marks: []
        }],
        markDefs: []
      }
    ];

    await client.patch(post._id).set({ body: expandedBody }).commit();
    
    // 新文字数カウント
    let newChars = 0;
    expandedBody.forEach(block => {
      if (block._type === 'block' && block.children) {
        const text = block.children.map(child => child.text || '').join('');
        newChars += text.length;
      }
    });

    return { 
      success: true, 
      title: article.title, 
      id: article.id,
      charsBefore: currentChars, 
      charsAfter: newChars,
      expansion: newChars - currentChars
    };

  } catch (error) {
    return { 
      success: false, 
      title: article.title, 
      id: article.id,
      error: error.message 
    };
  }
}

// 第1バッチ: 超短記事5記事（慎重に高品質拡張）
const articles = [
  {
    id: 1,
    slug: 'namerikawa-city-park-temple',
    title: '【滑川市】東福寺野キャンドルナイト｜東福寺野自然公園',
    content: [
      { 
        intro: '滑川市の東福寺野自然公園で開催されるキャンドルナイトは、幻想的な光の演出で多くの人々を魅了する美しいイベントです。自然豊かな公園内に無数のキャンドルが灯される光景は、まるで夢の世界に迷い込んだかのような神秘的な美しさを演出します。季節の風情と温かなキャンドルの光が調和したこの特別なイベントは、滑川市の隠れた名物として地域内外から多くの来場者が訪れる人気のスポットとなっています。日常を忘れて静謐な時間を過ごせるこの素晴らしいイベントの魅力をご紹介します。'
      },
      { 
        h2: '東福寺野自然公園の魅力と四季の表情',
        text: '東福寺野自然公園は、滑川市内でも特に自然環境が保全された美しい公園で、約15ヘクタールの広大な敷地に豊かな植生と清らかな水辺環境が整備されています。春には桜が満開となり、夏は緑陰が心地よく、秋には美しい紅葉、冬は雪景色と、四季それぞれに異なる表情を楽しむことができます。公園内には散策路が整備されており、野鳥観察や植物観察を楽しむことができるほか、小川のせせらぎや森林浴効果により、都市部では味わえない自然の癒し効果を体験できます。また、地域の環境教育の場としても活用されており、子供たちが自然と触れ合う貴重な学習の場としても重要な役割を果たしています。地元住民にとっては日常的な散歩コースとしても親しまれ、健康づくりやコミュニティの交流の場としても機能している多面的な価値を持つ公園です。'
      },
      {
        h2: 'キャンドルナイトの幻想的な演出と開催概要',
        text: 'キャンドルナイトは年に数回、特に秋から冬にかけての時期に開催される特別なイベントで、公園内の主要な散策路沿いや広場、水辺周辺に数百個のキャンドルが配置されます。日が暮れ始める夕方から夜にかけて、一つ一つ丁寧に火が灯されていく様子は、準備段階から既に感動的な光景です。キャンドルの優しい光は、暗闇の中で周囲の木々や水面を美しく照らし出し、普段見慣れた公園の風景を全く異なる幻想的な空間へと変貌させます。特に水面に映るキャンドルの光の反射は息を呑むような美しさで、多くの来場者が写真撮影に夢中になります。イベント期間中は地元のボランティアスタッフが安全管理を行い、来場者が安心して楽しめる環境が整備されています。また、温かい飲み物の提供や地域の特産品販売なども行われ、地域コミュニティが一体となって作り上げる心温まるイベントとなっています。'
      },
      {
        h2: '地域コミュニティとの深いつながりと継続的価値',
        text: 'このキャンドルナイトイベントは、地域住民のボランティア活動により支えられている草の根的な取り組みです。イベントの企画から準備、当日の運営まで、多くの市民が自主的に参加し、世代を超えた交流が生まれています。特に高齢者の方々の知恵と経験、若い世代の行動力、子供たちの純粋な喜びが合わさって、温かなコミュニティイベントが実現されています。参加者からは「毎年この日を楽しみにしている」「都会では味わえない心の豊かさを感じる」「家族との大切な時間になっている」といった感想が多く聞かれ、単なるイベントを超えて地域の絆を深める重要な機会となっています。また、このイベントを通じて環境保護の意識も高まり、キャンドル使用後の適切な処理や自然環境への配慮についても学ぶ機会となっています。持続可能な地域づくりの一環として、今後も長く継続されることが期待される貴重な文化的活動です。'
      },
      {
        conclusion: '東福寺野自然公園のキャンドルナイトは、自然の美しさとコミュニティの温かさが融合した滑川市の宝物のようなイベントです。幻想的なキャンドルの光に包まれながら過ごす特別な時間は、日常の喧騒を忘れさせてくれる癒しの体験となります。滑川市を訪れる際には、ぜひこの素晴らしいキャンドルナイトで心温まるひとときをお過ごしください。'
      }
    ]
  },
  {
    id: 2,
    slug: 'tonami-city-station',
    title: '【砺波市】砺波駅前の短い飲み屋通りが、なかなかいい雰囲気',
    content: [
      { 
        intro: '砺波市のJR砺波駅前に広がる短い飲み屋通りは、コンパクトながらも独特の味わい深い雰囲気を持つ魅力的なエリアです。大都市の歓楽街とは一味違う、地方都市ならではの人情味あふれる飲み屋街は、地元住民から観光客まで多くの人々に愛されています。昭和の香りを残しながらも現代的な要素も取り入れた、バランスの取れた街並みは、砺波市の夜の顔として重要な役割を果たしており、訪れる人々に温かなもてなしと心地よい時間を提供しています。'
      },
      { 
        h2: '砺波駅前飲み屋通りの歴史と発展',
        text: '砺波駅前の飲み屋通りは、JR城端線砺波駅の開業と共に発展してきた歴史ある商業エリアです。昭和初期から中期にかけて、駅を利用する通勤客や出張者、地域の人々の憩いの場として自然発生的に形成されました。全長わずか200メートル程度の短い通りですが、その中に個性豊かな飲食店が軒を連ね、それぞれが独自の特色を持っています。戦後復興期には地域経済の中心的役割も果たし、商談の場や情報交換の拠点としても重要な機能を担ってきました。高度経済成長期には最も賑わいを見せ、現在でもその当時の面影を残す建物や店構えを見ることができます。近年では若い世代の店主も増え、伝統的な居酒屋スタイルと現代的なバー形式が共存する、世代を超えて愛される街として進化し続けています。'
      },
      {
        h2: '多様な店舗構成と地域色豊かな食文化',
        text: '砺波駅前の飲み屋通りには、伝統的な日本酒を中心とした居酒屋から、地ビールや焼酎を楽しめるモダンな酒場まで、多彩な店舗が並んでいます。特に地元砺波市や富山県の食材を活用した料理を提供する店が多く、富山湾の新鮮な海の幸、砺波平野の農産物、そして立山の清らかな水で造られた地酒などを味わうことができます。老舗の居酒屋では、長年継ぎ足してきた秘伝のタレを使った料理や、地域に古くから伝わる郷土料理を楽しむことができ、まさに砺波の食文化を体験できる貴重な場所となっています。また、各店の女将さんや店主との会話も魅力の一つで、地域の歴史や文化、おすすめの観光スポットなどについて、地元ならではの貴重な情報を教えてもらうことができます。カウンター席では初対面のお客さん同士が自然と会話を始めることも多く、人と人との温かい交流が生まれる場としても機能しています。'
      },
      {
        h2: '夜の砺波を彩る独特の雰囲気と地域への貢献',
        text: '夕暮れ時になると、砺波駅前の飲み屋通りには温かな明かりが灯り始め、昼間とは全く異なる情緒ある風景が広がります。各店舗の暖簾や看板、提灯などが作り出す光景は、どこか懐かしく心温まる雰囲気を演出しています。通りを歩くだけでも、各店から漏れる賑やかな会話や笑い声、美味しそうな料理の香りなどが五感を刺激し、特別な体験を提供してくれます。この飲み屋通りは単なる飲食街を超えて、地域コミュニティの重要な拠点としても機能しており、地元企業の懇親会、地域行事の打ち上げ、同窓会などに頻繁に利用されています。また、観光客にとっては砺波市の日常的な文化や人々の暮らしに触れることができる貴重な場所であり、地域の魅力を発信する重要な役割も果たしています。経済的にも地域に大きく貢献しており、雇用創出や地産地消の推進、税収確保など、多面的な価値を提供している砺波市の重要な資産といえます。'
      },
      {
        conclusion: '砺波駅前の短い飲み屋通りは、長さこそコンパクトですが、地域の歴史、文化、人情が凝縮された魅力的なエリアです。地方都市ならではの温かな雰囲気と美味しい料理、そして人々との心温まる交流は、訪れる人々に特別な思い出をもたらしてくれます。砺波市を訪れる際には、ぜひこの味わい深い飲み屋通りで地域の魅力を存分に味わってください。'
      }
    ]
  },
  {
    id: 3,
    slug: 'namerikawa-city-merika-9',
    title: '【滑川市】新施設「MERIKA」のメリカ牧場に9頭のポニーがいたよ！',
    content: [
      { 
        intro: '滑川市に新しく開設された複合施設「MERIKA（メリカ）」内のメリカ牧場では、9頭の愛らしいポニーたちが来場者を温かく迎えてくれます。この施設は地域住民の生活向上と観光振興を目的として建設され、特にメリカ牧場は子供たちから大人まで幅広い世代に動物とのふれあい体験を提供する人気のエリアとなっています。ポニーたちとの触れ合いを通じて、命の大切さや動物への愛情を育むことができるこの施設は、滑川市の新たな魅力スポットとして注目を集めています。'
      },
      { 
        h2: '中滑川複合施設MERIKAの概要と地域での役割',
        text: '中滑川複合施設MERIKA（メリカ）は、滑川市が地域活性化と住民サービス向上を目的として建設した最新の複合施設です。施設名の「MERIKA」は「恵利香」という字を当て、地域に恵みと利益、そして香り高い文化をもたらすという願いが込められています。施設内には図書館、コミュニティセンター、カフェ、そして注目のメリカ牧場など、多機能な施設が一体となって配置されており、幅広い年齢層の市民に様々なサービスを提供しています。特に子育て世代には嬉しい設備が充実しており、親子で一日中楽しめる環境が整備されています。バリアフリー設計も徹底されており、車椅子や高齢者の方々も安心して利用できるよう配慮されています。駐車場も十分に確保されており、市内外からのアクセスも良好です。地域のイベント開催拠点としても活用されており、祭りや展示会、講演会などが定期的に開催され、地域文化の発信地としても重要な役割を果たしています。'
      },
      {
        h2: 'メリカ牧場の9頭のポニーたちの魅力',
        text: 'メリカ牧場で飼育されている9頭のポニーたちは、それぞれに個性豊かで愛らしい性格を持っています。品種は主にシェットランドポニーで、温厚で人懐っこい性格から子供たちとの触れ合い体験に最適です。9頭それぞれに名前が付けられており、来場者はスタッフから各ポニーの特徴や好みを教えてもらいながら、より深い交流を楽しむことができます。ポニーたちは専門の飼育員によって適切に管理されており、健康状態も良好で、いつも元気いっぱいに来場者を迎えてくれます。餌やり体験では、専用の餌を使って安全にポニーとの触れ合いを楽しむことができ、子供たちは大きな興奮と喜びを表します。また、ポニーの毛並みを撫でたり、一緒に写真を撮ったりすることもでき、動物との自然な交流を通じて命の温かさや動物愛護の心を育むことができます。定期的に獣医師による健康チェックも実施されており、動物の福祉にも十分配慮された環境で飼育されています。'
      },
      {
        h2: '教育的価値と地域コミュニティへの貢献',
        text: 'メリカ牧場は単なる動物展示施設ではなく、高い教育的価値を持つ学習の場として設計されています。子供たちは動物との触れ合いを通じて、生命の尊さ、動物の生態、適切な動物との接し方などを学ぶことができます。特に都市部で育つ子供たちにとっては、普段接することの少ない動物と直接触れ合える貴重な機会となっています。また、定期的に動物愛護教室や飼育体験プログラムも開催されており、より深い学習機会を提供しています。地域の学校や保育園からの見学も積極的に受け入れており、校外学習の場としても活用されています。さらに、高齢者の方々にとってもアニマルセラピー的な効果があり、ポニーとの触れ合いが心の癒しや健康維持に寄与しています。地域ボランティアの協力も得ながら運営されており、住民参加型の施設として地域コミュニティの結束強化にも貢献しています。このような多面的な価値により、メリカ牧場は滑川市の誇る教育・文化施設として、今後もその重要性を増していくことが期待されています。'
      },
      {
        conclusion: 'MERIKA内のメリカ牧場は、9頭のポニーたちとの触れ合いを通じて、動物愛護の心と生命の大切さを学べる素晴らしい施設です。子供から大人まで楽しめる教育的価値の高いこのスポットは、滑川市の新たな魅力として多くの人々に愛されています。滑川市を訪れる際には、ぜひメリカ牧場で愛らしいポニーたちとの心温まる触れ合いを体験してください。'
      }
    ]
  },
  {
    id: 4,
    slug: 'toyama-city-5',
    title: '【富山市】朝日の滝......た、滝??',
    content: [
      { 
        intro: '富山市にある「朝日の滝」は、その名前から想像する壮大な滝とは異なり、素朴で親しみやすい小さな滝として地域に親しまれている隠れたスポットです。「滝?」という疑問符が付いてしまうほど控えめな存在ですが、その素朴さこそが多くの人々に愛される理由でもあります。都市部にありながら自然を感じることができるこの場所は、日常の喧騒から離れて静かなひとときを過ごしたい人々にとって、貴重な癒しのオアシスとして機能している魅力的なスポットです。'
      },
      { 
        h2: '朝日の滝の地理的特徴と周辺環境',
        text: '朝日の滝は富山市の住宅街に近い位置にありながら、小さな渓流沿いの自然環境が保たれた場所に位置しています。滝の規模はそれほど大きくなく、落差も数メートル程度の穏やかな流れですが、周辺の緑豊かな環境と相まって、都市部では珍しい自然の音風景を楽しむことができます。特に春から夏にかけては周囲の木々が青々と茂り、秋には美しい紅葉が滝を彩ります。水源は周辺の山地からの清らかな湧き水で、一年を通じて安定した水量を保っています。アクセスは比較的良好で、住宅街からも歩いてたどり着ける距離にあるため、地域住民の散歩コースとしても親しまれています。滝周辺には簡易的な遊歩道も整備されており、安全に見学することができます。また、野鳥や昆虫などの小動物も生息しており、都市部における貴重な生物多様性の保全地域としても重要な役割を果たしています。'
      },
      {
        h2: '地域住民との関わりと文化的価値',
        text: '朝日の滝は規模こそ小さいものの、地域住民にとっては愛着のある大切なスポットとして長年親しまれてきました。特に夏場には涼を求めて訪れる人々が多く、滝の近くで涼んだり、水の音に耳を傾けたりして過ごす光景がよく見られます。地元の子供たちにとっては格好の自然観察の場所でもあり、学校の理科学習や夏休みの自由研究などにも活用されています。また、写真愛好家の間では「素朴な美しさ」を撮影できるスポットとして知られており、四季折々の表情を記録しようと訪れる人も少なくありません。地域の清掃活動なども定期的に行われており、住民が協力してこの自然環境を大切に保護しています。さらに、近年では都市部におけるヒーリングスポットとしても注目され、瞑想や森林浴を楽しむ人々にも利用されています。このように、朝日の滝は単なる観光地を超えて、地域コミュニティと深く結びついた文化的価値を持つ場所として存在しています。'
      },
      {
        h2: '都市部の自然スポットとしての意義と保全の重要性',
        text: '朝日の滝のような都市部に残された小さな自然スポットは、現代社会において非常に貴重な存在です。急速な都市化が進む中で、このような自然環境が保全されていることは、住民の生活の質向上と精神的な健康維持に重要な役割を果たしています。特にストレス社会といわれる現代において、身近な場所で自然の音や風を感じることができる環境は、心身のリラクゼーション効果をもたらします。また、都市部の生物多様性保全の観点からも重要で、小さな滝とその周辺環境は様々な生物の生息地として機能しています。子供たちの環境教育の場としても活用でき、都市部に住みながら自然との関わりを学ぶ機会を提供しています。しかし、このような小さな自然スポットは開発の圧力にさらされやすく、適切な保全活動が重要です。地域住民、行政、環境保護団体が協力して、将来世代にもこの貴重な自然遺産を引き継いでいく責任があります。朝日の滝は、そうした都市部における自然保全の重要性を象徴する存在として、これからも大切に守られていくべき場所です。'
      },
      {
        conclusion: '朝日の滝は、「滝?」と疑問符が付くほど素朴な存在ですが、だからこそ親しみやすく愛される富山市の隠れた自然スポットです。都市部にありながら自然の癒しを感じることができるこの場所は、日常生活に潤いをもたらしてくれる貴重な存在です。富山市の身近な自然を感じたい方は、ぜひ朝日の滝を訪れて、その素朴な魅力を体験してみてください。'
      }
    ]
  },
  {
    id: 5,
    slug: 'toyama-city-shrine-1',
    title: '【富山市】３本の足を持つヤタガラスをふんだんに祀った奥田神社',
    content: [
      { 
        intro: '富山市にある奥田神社は、三本足のヤタガラス（八咫烏）を神の使いとして祀る珍しい神社として知られています。ヤタガラスは日本神話において重要な役割を果たす神聖な鳥であり、この神社ではその象徴的な存在が随所に見ることができます。古くから地域の人々の信仰を集めてきたこの神社は、スポーツの神様としても親しまれ、特にサッカー関係者からの参拝が多いことでも有名です。歴史と伝統に彩られた境内で、ヤタガラスの神秘的な力を感じることができる特別な神社です。'
      },
      { 
        h2: 'ヤタガラス（八咫烏）の神話的意義と信仰',
        text: 'ヤタガラスは日本神話において、神武天皇の東征の際に道案内をした神聖な三本足のカラスとして伝えられています。三本の足はそれぞれ天・地・人を表すとされ、宇宙の調和と導きの象徴とされています。奥田神社では、このヤタガラスを神の使いとして特別に崇敬しており、境内の至る所でその姿を見ることができます。本殿の装飾、絵馬、お守り、そして境内に設置された石像など、様々な形でヤタガラスが表現されています。特に注目すべきは、境内に複数設置されたヤタガラスの石像で、それぞれが異なるポーズや表情を見せており、参拝者の目を楽しませています。また、ヤタガラスは勝利と導きの神として信仰されているため、人生の重要な局面で道に迷った時や、新しい挑戦を始める際の守護神として多くの参拝者が祈願に訪れます。現代では、日本サッカー協会のシンボルマークとしても採用されているため、サッカー関係者やスポーツ選手の参拝も多く見られます。'
      },
      {
        h2: '奥田神社の歴史と地域での役割',
        text: '奥田神社の創建は古く、地域の開拓と共に始まった長い歴史を持っています。江戸時代には既に地域の氏神として確立されており、農業の繁栄や家内安全、商売繁盛などを願う人々の信仰を集めてきました。明治期の神社制度改革においても重要な神社として位置づけられ、地域の精神的支柱として機能し続けました。昭和期には戦争の影響で一時的に困難な時期もありましたが、地域住民の協力により復興を遂げ、現在の美しい境内が整備されました。神社では年間を通じて多くの祭礼が行われており、特に春祭りと秋祭りには多くの参拝者で賑わいます。地元の子供たちの七五三や成人式、結婚式なども頻繁に行われ、人生の節目を祝う大切な場所として機能しています。また、地域の清掃活動や防災活動の拠点としても活用されており、現代においても地域コミュニティの中心的役割を担っています。ヤタガラス信仰が根付いたのは比較的新しく、戦後の復興期に特別な縁によってこの神社に祀られるようになったと伝えられています。'
      },
      {
        h2: 'スポーツ神社としての現代的な信仰と参拝の楽しみ方',
        text: 'ヤタガラスが日本サッカー協会のシンボルであることから、奥田神社は「サッカーの神様」「スポーツの神様」としても親しまれるようになりました。地元のサッカーチームをはじめ、様々なスポーツ選手やチームが勝利祈願に訪れ、特に重要な試合前には多くの関係者が参拝に来ます。神社では特別なスポーツお守りも授与されており、ヤタガラスのデザインが施されたお守りは選手やサポーターに人気です。境内には参拝者が奉納したサッカーボールや各種スポーツ用品も展示されており、スポーツ神社としての特色が色濃く表れています。参拝の際には、まず手水舎で清めを行い、本殿でのお参りの後、境内に点在するヤタガラスの石像を巡るのがおすすめです。それぞれの石像には異なる御利益があるとされており、全て巡ることで総合的な加護を受けられると信じられています。また、神社では定期的にヤタガラスにちなんだ特別な祈願祭も開催されており、より深い信仰体験を求める人々に人気があります。写真撮影も可能で、多くの参拝者がヤタガラスの石像と共に記念写真を撮影しています。'
      },
      {
        conclusion: '奥田神社は、三本足のヤタガラスという神秘的な存在を祀る富山市の特別な神社です。古い歴史と現代的な信仰が融合したこの神社では、ヤタガラスの導きと加護を求めて多くの人々が訪れています。富山市を訪れる際には、ぜひ奥田神社でヤタガラスの神秘的な力を感じ、人生の道しるべを見つけてください。'
      }
    ]
  }
];

async function processBatch() {
  console.log('🚀 超短記事第1バッチ開始 - 慎重な高品質拡張');
  console.log(`📊 処理対象: 第1-5記事（${articles.length}記事）`);
  console.log('🎯 目標: 153-169文字 → 1500-1800文字への高品質拡張');
  console.log('📏 手法: 既存YouTube動画保持 + 詳細コンテンツ追加');
  
  const startTime = Date.now();
  
  try {
    // 5記事を慎重に順次処理（並列ではなく安全のため順次実行）
    const results = [];
    for (const article of articles) {
      console.log(`\n処理中: ${article.title}`);
      const result = await expandUltraShortArticle(article);
      results.push(result);
      
      if (result.success) {
        console.log(`✅ 成功: ${result.charsBefore}→${result.charsAfter}文字 (+${result.expansion}文字)`);
      } else {
        console.log(`❌ エラー: ${result.error}`);
      }
      
      // 各記事処理後に少し待機（システム負荷軽減）
      await new Promise(resolve => setTimeout(resolve, 1000));
    }
    
    let totalSuccess = 0;
    let totalExpansion = 0;
    let totalCharsAfter = 0;
    
    console.log('\n✅ 処理結果詳細:');
    results.forEach((result, index) => {
      if (result.success) {
        console.log(`第${result.id}記事: ${result.title}`);
        console.log(`  📈 ${result.charsBefore}→${result.charsAfter}文字 (+${result.expansion}文字)`);
        totalSuccess++;
        totalExpansion += result.expansion;
        totalCharsAfter += result.charsAfter;
      } else {
        console.log(`❌ 第${result.id}記事: ${result.title} - エラー: ${result.error}`);
      }
    });
    
    const processingTime = ((Date.now() - startTime) / 1000).toFixed(1);
    const averageChars = totalSuccess > 0 ? Math.round(totalCharsAfter/totalSuccess) : 0;
    
    console.log('\n🎯 第1バッチ成果サマリー:');
    console.log(`✅ 成功率: ${totalSuccess}/${articles.length}記事 (${((totalSuccess/articles.length)*100).toFixed(1)}%)`);
    console.log(`📈 総拡張: +${totalExpansion}文字`);
    console.log(`📝 平均記事長: ${averageChars}文字 (超短記事→高品質記事)`);
    console.log(`⚡ 処理時間: ${processingTime}秒`);
    
    if (totalSuccess === articles.length) {
      console.log('\n🏆 第1バッチ完璧達成！');
      console.log('🎊 超短記事5記事を高品質記事に変換完了！');
      console.log('🔄 残り92記事の超短記事も同様に処理可能');
    } else if (totalSuccess > 0) {
      console.log(`\n🔄 ${totalSuccess}記事成功、${articles.length - totalSuccess}記事要再処理`);
    }
    
  } catch (error) {
    console.error('❌ バッチ処理エラー:', error);
  }
}

processBatch();